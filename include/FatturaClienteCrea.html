
<style>
    .sw-theme-arrows {
        border-radius: 5px;
        border: 1px solid #ddd;
    }

    .sw-main {
        /*position: relative;*/
        display: block;
        margin: 0;
        padding: 0;
    }

    .sw-theme-arrows > ul.step-anchor {
        list-style: none;
    }

    .sw-theme-arrows > ul.step-anchor {
        display: block;
        border: 0;
        border-bottom-width: 0px;
        border-bottom-style: none;
        border-bottom-color: currentcolor;
        border-bottom: 1px solid #ddd;
        padding: 0px;
        background: #f5f5f5;
        border-radius: 5px;
        border-bottom-right-radius: 5px;
        border-bottom-left-radius: 5px;
        border-bottom-left-radius: 0;
        border-bottom-right-radius: 0;
        list-style: none;
        overflow: hidden;
        margin: -1px -1px 0 -1px -1px;
    }

        .sw-theme-arrows > ul.step-anchor > li.done > a {
            border-color: #5cb85c !important;
            color: #fff !important;
            background: #5cb85c !important;
        }


        .sw-theme-arrows > ul.step-anchor > li > a,
        .sw-theme-arrows > ul.step-anchor > li > a:hover {
            color: #bbb;
            text-decoration: none;
            padding: 10px 0 10px 45px;
            padding-left: 45px;
            position: relative;
            display: block;
            border: 0 !important;
            border-top-color: currentcolor;
            border-right-color: currentcolor;
            border-bottom-color: currentcolor;
            border-left-color: currentcolor;
            border-radius: 0;
            outline-style: none;
            background: #f5f5f5;
        }

        .sw-theme-arrows > ul.step-anchor > li:first-child > a {
            padding-left: 15px;
        }

        .sw-theme-arrows > ul.step-anchor > li > a::before {
            content: " ";
            display: block;
            width: 0;
            height: 0;
            border-top: 50px solid transparent;
            border-bottom: 50px solid transparent;
            border-left: 30px solid #ddd;
            position: absolute;
            top: 50%;
            margin-top: -50px;
            margin-left: 1px;
            left: 100%;
            z-index: 1;
        }

        .sw-theme-arrows > ul.step-anchor > li.done > a::after {
            border-left: 30px solid #5cb85c; /*verde*/
        }

        .sw-theme-arrows > ul.step-anchor > li > a::after {
            content: " ";
            display: block;
            width: 0;
            height: 0;
            border-top: 50px solid transparent;
            border-bottom: 50px solid transparent;
            border-left: 30px solid #f5f5f5;
            position: absolute;
            top: 50%;
            margin-top: -50px;
            left: 100%;
            z-index: 2;
        }

        .sw-theme-arrows > ul.step-anchor > li.active > a {
            border-color: #007bff !important; /*#5bc0de !important;*/
            color: #fff !important;
            background: #007bff !important; /*#5bc0de !important;*/
        }

        .sw-theme-arrows > ul.step-anchor > li > a:hover {
            color: #bbb;
            text-decoration: none;
            outline-style: none;
            background: #f5f5f5;
            border-color: #f5f5f5;
        }

        .sw-theme-arrows > ul.step-anchor > li.active > a::after {
            border-left: 30px solid #007bff !important; /*#5bc0de=azzurro*/
        }

        .sw-theme-arrows > ul.step-anchor > li > a::after {
            content: " ";
            display: block;
            width: 0;
            height: 0;
            border-top: 50px solid transparent;
            border-bottom: 50px solid transparent;
            border-left: 30px solid #f5f5f5;
            position: absolute;
            top: 50%;
            margin-top: -50px;
            left: 100%;
            z-index: 2;
        }

    ::after, ::before {
        -webkit-box-sizing: border-box;
        -moz-box-sizing: border-box;
        box-sizing: border-box;
    }

    .sw-theme-arrows > ul.step-anchor > li.active > a {
        color: #fff !important;
    }

    .sw-theme-arrows > ul.step-anchor > li {
        float: left;
        margin-bottom: -1px;
        min-width: 100px; /* larghezza uguale per tutti gli step */
    }

    .myStep {
        padding: 0 10px;
    }
</style>

<div class="container">

    <div class="row">
        <div class="col-12 col-sm-12 col-md-12 col-lg-12">
            <div class="spacerh30"></div>
        </div>
    </div>

    <div class="row">
        <div class="col-12 col-sm-12 col-md-12 col-lg-12">

            <div class="sw-main sw-theme-arrows">

                <ul class="step-anchor">
                    <!--li class="done" | class="active"-->
                    <li id="step-0-button"><a href="#" class="preventDefaultOnMe">Iniziamo<br /><small>descrizione</small></a></li>
                    <li id="step-1-button"><a href="#" class="preventDefaultOnMe">Step 1<br /><small>tipo</small></a></li>
                    <li id="step-2-button"><a href="#" class="preventDefaultOnMe">Step 2<br /><small>data</small></a></li>
                    <li id="step-3-button"><a href="#" class="preventDefaultOnMe">Step 3<br /><small>cliente</small></a></li>
                    <li id="step-4-button"><a href="#" class="preventDefaultOnMe">Step 4<br /><small>righe</small></a></li>
                    <li id="step-5-button"><a href="#" class="preventDefaultOnMe">Step 5<br /><small>accessorie</small></a></li>
                    <li id="step-6-button"><a href="#" class="preventDefaultOnMe">Step 6<br /><small>opzioni</small></a></li>
                    <li id="step-7-button"><a href="#" class="preventDefaultOnMe">Fine<br /><small>azioni</small></a></li>
                </ul>

                <div id="mySteps">

                    <div class="myStep" id="step-0-content" aria-labelledby="step-0-button">

                        <!-- ################## start CONTENUTO STEP 0 ################## -->

                        <div class="row">
                            <div class="col-12 col-sm-8 col-md-8 col-lg-8 offset-sm-2 offset-md-2 offset-lg-2">
                                <h3>Procedura guidata per creazione fattura elettronica</h3>
                                <hr />
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-12 col-sm-3 col-md-3 col-lg-3 offset-md-2 offset-md-2 offset-lg-2">
                                <div style="text-align:center;">
                                    <img src="images/introWzrdcreaFatturaCliv2.jpg" class="img-fluid" alt="intro creazione fattura">
                                </div>
                            </div>
                            <div class="col-12 col-sm-5 col-md-5 col-lg-5">
                                <p>
                                    <span>
                                        Questa procedura ti guida nella creazione della fattura; i passaggi richiesti sono:
                                        <br>
                                    </span>
                                </p>
                                <p>
                                    <ul>
                                        <li style="list-style-type: disc !important;">tipo di documento (fattura, nota di credito, ecc...)</li>
                                        <li style="list-style-type: disc !important;">data documento</li>
                                        <li style="list-style-type: disc !important;">soggetto a cui intestare la fattura</li>
                                        <li style="list-style-type: disc !important;">prodotti/servizi da includere in fattura</li>
                                        <li style="list-style-type: disc !important;">campi addizionali</li>
                                    </ul>
                                </p>
                                <p>
                                    <span>
                                        <br>
                                        La procedura richiede circa 3~5 minuti; al termine potrai visualizzare il documento, inviarlo al SDI oppure scaricarlo in formato XML e PDF.
                                    </span>
                                </p>

                            </div>
                        </div>

                        <div class="row">
                            <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                                <div class="spacerh20"></div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                                <div class="clearfix">
                                    <button id="GoToStep1-button" type="button" class="btn btn-primary btn-lg float-right">avanti&nbsp;&gt;</button>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                                <div class="spacerh20"></div>
                            </div>
                        </div>
                        <!-- ################## end CONTENUTO STEP 0 ################## -->

                    </div>

                    <div class="myStep" id="step-1-content" aria-labelledby="step-1-button">

                        <!-- ################## start CONTENUTO STEP 1 ################## -->
                        <div class="row">
                            <div class="col-12 col-sm-8 col-md-8 col-lg-8 offset-sm-2 offset-md-2 offset-lg-2">

                                <h3>Tipologia documento</h3>
                                <hr />
                                <p>
                                    Seleziona la tipologia del documento che andrai a generare. Nei passaggi successivi potrai scegliere tra la numerazione automatica oppure manuale; nel primo caso dovrai indicare la data di fatturazione per generare automaticamente il numero di fattura sequenziale; vengono inoltre effettuati
                                    controlli di coerenza affinchè la data di emissione della fattura non sia antecedente a quella di una fattura precedente; potrai anche sceglere un Sezionale per una numerazione distinta
                                </p>
                                <table class="table table-striped" id="tblRadioTipiDocumento">
                                    <tbody>
                                        <tr>
                                            <td>
                                                <div class="form-check">
                                                    <label class="form-check-label">
                                                        <input name="radioTipiDocumento" id="tipoDocumento_0" value="00000000-0000-0000-0000-000000000001" type="radio" class="form-check-input validateFormOnClick">
                                                        <strong>[TD01] fattura</strong>
                                                    </label>
                                                </div>
                                                <div>
                                                    <span>
                                                        Genera una fattura elettronica standard.
                                                    </span>
                                                </div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>
                                                <div class="form-check">
                                                    <label class="form-check-label">
                                                        <input name="radioTipiDocumento" id="tipoDocumento_1" value="00000000-0000-0000-0000-000000000002" type="radio" class="form-check-input validateFormOnClick">
                                                        <strong>[TD02] acconto/anticipo su fattura</strong>
                                                    </label>
                                                </div>
                                                <div>
                                                    <span>
                                                        Genera una fattura di acconto/anticipo.
                                                    </span>
                                                </div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>
                                                <div class="form-check">
                                                    <label class="form-check-label">
                                                        <input name="radioTipiDocumento" id="tipoDocumento_2" value="00000000-0000-0000-0000-000000000003" type="radio" class="form-check-input validateFormOnClick">
                                                        <strong>[TD03] acconto/anticipo su parcella</strong>
                                                    </label>
                                                </div>
                                                <div>
                                                    <span>
                                                        Se sei professionista seleziona questa tipologia per generare una parcella di acconto/anticipo.
                                                    </span>
                                                </div>

                                            </td>
                                        </tr>
                                        <tr>
                                            <td>
                                                <div class="form-check">
                                                    <label class="form-check-label">
                                                        <input name="radioTipiDocumento" id="tipoDocumento_3" value="00000000-0000-0000-0000-000000000004" type="radio" class="form-check-input validateFormOnClick">
                                                        <strong>[TD04] nota di credito</strong>
                                                    </label>
                                                </div>
                                                <div>
                                                    <span>
                                                        Genera una Nota di credito (elettronica); dovrai indicare se a storno parziale oppure totale di una fattura emessa indicandone data e numero.
                                                    </span>
                                                </div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>
                                                <div class="form-check">
                                                    <label class="form-check-label">
                                                        <input name="radioTipiDocumento" id="tipoDocumento_4" value="00000000-0000-0000-0000-000000000006" type="radio" class="form-check-input validateFormOnClick">
                                                        <strong>[TD06] parcella</strong>
                                                    </label>
                                                </div>
                                                <div>
                                                    <span>
                                                        Se sei professionista seleziona questa tipologia per generare una parcella.
                                                    </span>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                                <div class="spacerh20"></div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-12 col-sm-12 col-md-12 col-lg-12">

                                <div class="clearfix">
                                    <button id="BackToStep0-button" type="button" class="btn btn-primary btn-lg float-left">&lt;&nbsp;indietro</button>
                                    <button id="GoToStep2-button" type="button" class="btn btn-primary btn-lg float-right">avanti&nbsp;&gt;</button>
                                </div>

                            </div>
                        </div>

                        <div class="row">
                            <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                                <div class="spacerh20"></div>
                            </div>
                        </div>
                        <!-- ################## end CONTENUTO STEP 1 ################## -->

                    </div>

                    <div class="myStep" id="step-2-content" aria-labelledby="step-2-button">
                        <!-- ################## start CONTENUTO STEP 2 ################## -->
                        <div class="row">
                            <div class="col-12 col-sm-10 col-md-8 col-lg-8 offset-sm-1 offset-md-2 offset-lg-2">

                                <h3>Data e Numero del documento</h3>
                                <hr />
                                <div class="row">
                                    <div class="col-12 col-sm-11 col-md-10 col-lg-8 offset-md-1 offset-lg-2">
                                        <div class="card">
                                            <div class="card-header">Data e numero documento</div> <!--bg-primary text-white-->
                                            <div class="card-body">

                                                <div class="row">
                                                    <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                                                        <span>DATA DOCUMENTO</span>
                                                    </div>
                                                </div>

                                                <div class="row">
                                                    <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                                                        <input name="txtDataDocumento" class="form-control" id="txtDataDocumento" type="text" maxlength="10" placeholder="data documento">
                                                    </div>
                                                </div>

                                                <div class="row">
                                                    <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                                                        <small>(gg/mm/aaaa)</small>
                                                    </div>
                                                </div>

                                                <div class="row">
                                                    <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                                                        <div class="spacerh10"></div>
                                                        <hr />
                                                    </div>
                                                </div>

                                                <div class="row">
                                                    <div class="col-xm-12 col-sm-12 col-md-12 col-lg-12">

                                                        <div class="form-check">
                                                            <label class="form-check-label">
                                                                <input name="radioNumerazioneDocumento" id="radioNumerazioneDocumento_automatica" value="a" type="radio" class="form-check-input">
                                                                <span>numerazione automatica</span>
                                                            </label>
                                                        </div>

                                                        <div class="form-check">
                                                            <label class="form-check-label">
                                                                <input name="radioNumerazioneDocumento" id="radioNumerazioneDocumento_manuale" value="m" type="radio" class="form-check-input">
                                                                <span>numerazione manuale</span>
                                                            </label>
                                                        </div>

                                                    </div>
                                                </div>

                                                <div class="collapse" id="collapsableNumeroDocumento">
                                                    <div class="row">
                                                        <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                                                            <span>NUMERO DOCUMENTO</span>
                                                        </div>
                                                    </div>
                                                    <div class="row">
                                                        <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                                                            <input class="form-control" id="txtNumeroDocumento" type="text" maxlength="4" placeholder="numero documento">
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="row">
                                                    <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                                                        <div class="spacerh10"></div>
                                                        <hr />
                                                    </div>
                                                </div>

                                                <div class="row">
                                                    <div class="col-xm-12 col-sm-12 col-md-12 col-lg-12">

                                                        <div class="form-check">
                                                            <label class="form-check-label">
                                                                <input name="radioSezionale" value="n" type="radio" class="form-check-input">
                                                                <span>non voglio usare un Sezionale<br />(numerazione es. 1/2019)</span>
                                                            </label>
                                                        </div>

                                                        <div class="form-check">
                                                            <label class="form-check-label">
                                                                <input name="radioSezionale" value="s" type="radio" class="form-check-input">
                                                                <span>voglio usare un Sezionale<br />(numerazione es. 1/2019/PA)</span>
                                                            </label>
                                                        </div>

                                                    </div>
                                                </div>

                                                <div class="collapse" id="collapsableSezionale">
                                                    <div class="row">
                                                        <div class="col-xm-12 col-sm-12 col-md-12 col-lg-12">
                                                            <span>SEZIONALE</span>
                                                        </div>
                                                    </div>
                                                    <div class="row">
                                                        <div class="col-xm-12 col-sm-12 col-md-12 col-lg-12">
                                                            <select class="form-control" id="ddlSezionale"></select>
                                                        </div>
                                                    </div>
                                                </div>

                                            </div>
                                            <!--<div class="card-footer">Footer</div>-->
                                        </div>

                                        <div class="row">
                                            <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                                                <div class="spacerh30"></div>
                                            </div>
                                        </div>

                                    </div>
                                </div>

                            </div>
                        </div>

                        <div class="row">
                            <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                                <div class="spacerh20"></div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-12 col-sm-12 col-md-12 col-lg-12">

                                <div class="clearfix">
                                    <button id="BackToStep1-button" type="button" class="btn btn-primary btn-lg float-left">&lt;&nbsp;indietro</button>
                                    <button id="GoToStep3-button" type="button" class="btn btn-primary btn-lg float-right">avanti&nbsp;&gt;</button>
                                </div>

                            </div>
                        </div>

                        <div class="row">
                            <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                                <div class="spacerh20"></div>
                            </div>
                        </div>
                        <!-- ################## end CONTENUTO STEP 2 ################## -->
                    </div>

                    <div class="myStep" id="step-3-content" aria-labelledby="step-3-button">
                        <!-- ################## start CONTENUTO STEP 3 ################## -->
                        <div class="row">
                            <div class="col-12 col-sm-8 col-md-8 col-lg-8 offset-sm-2 offset-md-2 offset-lg-2">

                                <h3>Selezione Cliente</h3>
                                <hr />

                                <div>
                                    <!--  ####### selezione tipo cliente: Privato o PA ###### -->
                                    <ul class="nav nav-tabs" id="tabSelezioneCliente" role="tablist">
                                        <li class="nav-item">
                                            <a class="nav-link active" id="tabSelezioneClienteDitta" data-toggle="tab" href="#boxSelezioneClienteDitta" role="tab" aria-controls="boxSelezioneClienteDitta" aria-selected="true">Ditta o Privato</a>
                                        </li>
                                        <li class="nav-item">
                                            <a class="nav-link" id="tabSelezioneClientePA" data-toggle="tab" href="#boxSelezioneClientePA" role="tab" aria-controls="boxSelezioneClientePA" aria-selected="false">Ente P.A.</a>
                                        </li>
                                    </ul>

                                    <div class="row">
                                        <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                                            <div class="spacerh20"></div>
                                        </div>
                                    </div>

                                    <div class="tab-content" id="myTabContentSelezioneCliente">
                                        <div class="tab-pane fade show active" id="boxSelezioneClienteDitta" role="tabpanel" aria-labelledby="tabSelezioneClienteDitta">

                                            <div class="row">
                                                <div class="col-12 col-sm-5 col-md-5 col-lg-5 offset-sm-1 offset-md-1 offset-lg-1">
                                                    <!--<p class="text-center"><span><i class="far fa-address-card fa-4x"></i></span></p>-->
                                                    <p class="text-justify"><span style="float:left;margin-right:15px;"><i class="far fa-address-card fa-3x"></i></span>Seleziona la Ditta o il Privato dal tuo Archivio Clienti a cui intestare il documento</p>

                                                </div>
                                                <div class="col-12 col-sm-5 col-md-5 col-lg-5">
                                                    <!--<p class="text-center"><span><i class="far fa-address-card fa-4x"></i> <i class="fas fa-plus-circle fa-2x"></i> </span></p>-->
                                                    <p class="text-justify"><span style="float:left;margin-right:15px;"><i class="far fa-address-card fa-3x"></i><i class="fas fa-plus-circle"></i></span>Crea una nuova anagrafica di una Ditta o Privato nel tuo Archivio Clienti (funzione Quick Insert)</p>
                                                </div>
                                            </div>

                                            <div class="row">
                                                <div class="col-12 col-sm-5 col-md-5 col-lg-5 offset-sm-1 offset-md-1 offset-lg-1">

                                                    <button type="button" class="btn btn-primary btn-block" id="btnOpenModalArchivioClienti">Seleziona Cliente</button>

                                                </div>
                                                <div class="col-12 col-sm-5 col-md-5 col-lg-5">

                                                    <button type="button" class="btn btn-warning btn-block" id="btnOpenModalNuovoCliente">Crea Cliente</button>

                                                </div>
                                            </div>

                                        </div>
                                        <div class="tab-pane fade" id="boxSelezioneClientePA" role="tabpanel" aria-labelledby="tabSelezioneClientePA">

                                            <div class="row">
                                                <div class="col-12 col-sm-5 col-md-5 col-lg-5 offset-sm-1 offset-md-1 offset-lg-1">
                                                    <!--<p class="text-center"><span><i class="far fa-address-card fa-4x"></i></span></p>-->
                                                    <p class="text-justify">
                                                        <span style="float:left;margin-right:15px;"><i class="far fa-address-card fa-3x"></i></span>Seleziona l'Ente P.A. a cui intestare il documento
                                                    </p>
                                                    <button type="button" class="btn btn-primary btn-block" id="btnOpenModalElencoPA">Seleziona Ente PA</button>
                                                </div>
                                            </div>

                                        </div>

                                    </div>

                                    <div class="row">
                                        <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                                            <div class="spacerh20"></div>
                                        </div>
                                    </div>

                                    <div class="row">
                                        <div class="col-12 col-sm-10 col-md-10 col-lg-10 offset-sm-1 offset-md-1 offset-lg-1">
                                            <div class="card" id="boxDatiClienteSelected">
                                                <div class="card-header">
                                                    <h5>Cliente</h5>
                                                </div>
                                                <div class="card-body">
                                                    <span id="txtDatiClienteSelectedRiga1"></span>
                                                    <br />
                                                    <span id="txtDatiClienteSelectedRiga2"></span>
                                                    <br />
                                                    <span id="txtDatiClienteSelectedRiga3"></span>
                                                    <br />
                                                    <span id="txtDatiClienteSelectedRiga4"></span>
                                                    <br />
                                                    <span id="txtDatiClienteSelectedRiga5"></span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                                <div class="spacerh20"></div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-12 col-sm-12 col-md-12 col-lg-12">

                                <div class="clearfix">
                                    <button id="BackToStep2-button" type="button" class="btn btn-primary btn-lg float-left">&lt;&nbsp;indietro</button>
                                    <button id="GoToStep4-button" type="button" class="btn btn-primary btn-lg float-right">avanti&nbsp;&gt;</button>
                                </div>

                            </div>
                        </div>

                        <div class="row">
                            <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                                <div class="spacerh20"></div>
                            </div>
                        </div>
                        <!-- ################## end CONTENUTO STEP 3 ################## -->
                    </div>

                    <div class="myStep" id="step-4-content" aria-labelledby="step-4-button">
                        <!-- ################## start CONTENUTO STEP 4 ################## -->
                        <div class="row">
                            <div class="col-12 col-sm-8 col-md-8 col-lg-8 offset-sm-2 offset-md-2 offset-lg-2">

                                <h3>Righe Fattura</h3>
                                <hr />

                                <div class="row">
                                    <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                                        <p class="lead text-center"><strong>aggiungi riga</strong></p>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col">
                                        <!--<p class="text-center"><span><i class="far fa-address-card fa-5x"></i></span></p>-->
                                        <p class="text-justify"><i class="fas fa-cube fa-2x" style="float:left;padding-right:5px;"></i> Seleziona un articolo/servizio da inserire in fattura tra quelli presenti nel tuo archivio (anagrafica articoli)</p>
                                    </div>
                                    <div class="col">
                                        <!--<p class="text-center"><span><i class="far fa-address-card fa-5x"></i> <i class="fas fa-plus-circle fa-2x"></i> </span></p>-->
                                        <p class="text-justify"><i class="far fa-file-alt fa-2x" style="float:left;padding-right:5px;"></i> Inserisci testo libero, usa questa opzione anche per le Note di credito per descrivere lo storno.</p>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col">
                                        <button type="button" class="btn btn-primary btn-block" id="btnOpenModalArchivioArticoli">ARTICOLO/SERVIZIO</button>
                                    </div>
                                    <div class="col">
                                        <button type="button" class="btn btn-primary btn-block" id="btnOpenModalTestoLibero">TESTO LIBERO</button>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                                        <div class="spacerh20"></div>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                                        <p class="lead text-center"><strong>oppure includi documento</strong></p>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col">
                                        <!--<p class="text-center"><span><i class="far fa-address-card fa-5x"></i></span></p>-->
                                        <p class="text-justify"><i class="far fa-copy fa-2x" style="float:left;padding-right:5px;"></i> Includi in fattura uno o piu' DDT rilasciati al Cliente selezionato</p>
                                    </div>
                                    <div class="col">
                                        <!--<p class="text-center"><span><i class="far fa-address-card fa-5x"></i> <i class="fas fa-plus-circle fa-2x"></i> </span></p>-->
                                        <p class="text-justify"><i class="far fa-copy fa-2x" style="float:left;padding-right:5px;"></i> Includi in fattura un Preventivo rilasciato al Cliente selezionato</p>
                                    </div>
                                    <div class="col">
                                        <p class="text-justify"><i class="far fa-copy fa-2x" style="float:left;padding-right:5px;"></i> Includi in fattura un Ordine dal Cliente selezionato</p>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col">
                                        <button type="button" class="btn btn-primary btn-block" id="btnOpenModalArchivioDDT">DDT</button>
                                    </div>
                                    <div class="col">
                                        <button type="button" class="btn btn-primary btn-block" id="btnOpenModalArchivioPreventivi">PREVENTIVO</button>
                                    </div>
                                    <div class="col">
                                        <button type="button" class="btn btn-primary btn-block" id="btnOpenModalArchivioOrdini">ORDINE</button>
                                    </div>
                                </div>

                            </div>
                        </div>

                        <div class="row">
                            <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                                <div class="spacerh20"></div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                                <div class="spacerh20"></div>
                            </div>
                        </div>


                        <div class="row">
                            <div class="col-12 col-sm-12 col-md-12 col-lg-12">

                                <table class="table table-striped table-sm" id="tblRigheFattura">
                                    <thead>
                                        <tr>
                                            <th style="width: 12%;">Codice</th>
                                            <th style="width: 12%;">U.d.M.</th>
                                            <th style="width: 8%;">Q.t&agrave;</th>
                                            <th style="width: 12%;">Prezzo &euro;</th>
                                            <th style="width: 12%;">IVA</th>
                                            <th style="width: 40%;">Descrizione</th>
                                            <th></th>
                                        </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>

                            </div>
                        </div>

                        <div class="row">
                            <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                                <div class="spacerh20"></div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                                <div class="spacerh20"></div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-12 col-sm-12 col-md-12 col-lg-12">

                                <div class="clearfix">
                                    <button id="BackToStep3-button" type="button" class="btn btn-primary btn-lg float-left">&lt;&nbsp;indietro</button>
                                    <button id="GoToStep5-button" type="button" class="btn btn-primary btn-lg float-right">avanti&nbsp;&gt;</button>
                                </div>

                            </div>
                        </div>

                        <div class="row">
                            <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                                <div class="spacerh20"></div>
                            </div>
                        </div>
                        <!-- ################## end CONTENUTO STEP 4 ################## -->
                    </div>

                    <div class="myStep" id="step-5-content" aria-labelledby="step-5-button">
                        <!-- ################## start CONTENUTO STEP 5 ################## -->
                        <div class="row">
                            <div class="col-12 col-sm-8 col-md-8 col-lg-8 offset-sm-2 offset-md-2 offset-lg-2">

                                <div class="row">
                                    <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                                        <h3>Informazioni Accessorie</h3>
                                        <hr />
                                        <p class="text-justify">
                                            Seleziona la tipologia e le condizioni di pagamento tra quelle codificate e la banca d'appoggio tra quelle gia' presenti in archivio (puoi aggiungere voci nella procedura di Setup).
                                            Opzionalmente puoi aggiungere la ritenuta e le spese anticipate (art.15).
                                        </p>
                                    </div>
                                </div>
                                <!-- @@@@@@@@@ start info accessorie @@@@@@@@@@@@ -->

                                <div class="card border-primary mb-3">
                                    <div class="card-header">TIPOLOGIA PAGAMENTO</div>
                                    <div class="card-body">

                                        <div class="row">
                                            <div class="col-xm-12 col-sm-5 col-md-5 col-lg-5 text-right">
                                                <label>tipologia pagamento</label>
                                            </div>
                                            <div class="col-xm-12 col-sm-7 col-md-7 col-lg-7">

                                                <select id="ddlTipoPagamento" class="form-control">
                                                    <!--
                                                       <option selected="selected" value="-1">&lt;-- seleziona --&gt;</option>
                                                    <option value="TP01">[TP01] pagamento a rate</option>
                                                    <option value="TP02">[TP02] pagamento completo</option>
                                                    <option value="TP03">[TP03] anticipo</option>
                                                        -->
                                                </select>

                                            </div>
                                        </div>

                                        <div class="row">
                                            <div class="col-xm-12 col-sm-5 col-md-5 col-lg-5 text-right">
                                                <label>data scadenza pagamento<br />(opzionale)</label>
                                            </div>
                                            <div class="col-xm-12 col-sm-7 col-md-7 col-lg-7">
                                                <input type="text" maxlength="10" id="txtTipoPagamento_DataScadenzaPagamento" class="form-control">
                                            </div>
                                        </div>

                                    </div>
                                </div>

                                <div class="card border-primary mb-3">
                                    <div class="card-header"><!--CONDIZIONI DI PAGAMENTO-->MODALITA' DI PAGAMENTO</div>
                                    <div class="card-body">

                                        <div class="row">
                                            <div class="col-xm-12 col-sm-5 col-md-5 col-lg-5 text-right">
                                                <label>
                                                    <!--condizione pagamento-->modalità pagamento
                                                </label>
                                            </div>
                                            <div class="col-xm-12 col-sm-7 col-md-7 col-lg-7">

                                                <select id="ddlCondizioniPagamento" class="form-control">
                                                    <!--[MP05] bonifico-->
                                                </select>

                                            </div>
                                        </div>

                                    </div>
                                </div>


                                <div class="card border-primary mb-3">
                                    <div class="card-header">BANCA D'APPOGGIO</div>
                                    <div class="card-body">

                                        <div class="row">
                                            <div class="col-xm-12 col-sm-5 col-md-5 col-lg-5 text-right">
                                                <label>banca</label>
                                            </div>
                                            <div class="col-xm-12 col-sm-7 col-md-7 col-lg-7">
                                                <select id="ddlCoordinateBancarie" class="form-control"></select>
                                            </div>
                                        </div>

                                        <div class="row">
                                            <div class="col-xm-12 col-sm-5 col-md-5 col-lg-5 text-right">
                                                <label>intestatario c/c</label>
                                            </div>
                                            <div class="col-xm-12 col-sm-7 col-md-7 col-lg-7">
                                                <input type="text" id="txtBancaIntestazioneCC" class="form-control" disabled>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-xm-12 col-sm-5 col-md-5 col-lg-5 text-right">
                                                <label>IBAN</label>
                                            </div>
                                            <div class="col-xm-12 col-sm-7 col-md-7 col-lg-7">
                                                <input type="text" id="txtBancaIBAN" class="form-control" disabled>
                                            </div>
                                        </div>
                                    </div>
                                </div>


                                <div class="card border-primary mb-3">
                                    <div class="card-header">RITENUTA D'ACCONTO</div>
                                    <div class="card-body">

                                        <div class="row">
                                            <div class="col-xm-12 col-sm-12 col-md-12 col-lg-12">

                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" value="" id="chkRitenuta">
                                                    <label class="form-check-label" for="chkRitenuta">
                                                        inserisci Ritenuta d'Acconto
                                                    </label>
                                                </div>

                                            </div>
                                        </div>

                                        <div class="collapse" id="collapsableRitenuta">

                                            <div class="row">
                                                <div class="col-xm-12 col-sm-5 col-md-5 col-lg-5 text-right">
                                                    <label>contributo previdenziale&nbsp;%</label>
                                                </div>
                                                <div class="col-xm-12 col-sm-7 col-md-7 col-lg-7">
                                                    <input type="text" id="txtPercContributoPrevidenzialeProfessionisti" class="form-control">
                                                </div>

                                            </div>

                                            <div class="row">

                                                <div class="col-xm-12 col-sm-5 col-md-5 col-lg-5 text-right">
                                                    <label>aliquota iva su contr.previd.</label>
                                                </div>

                                                <div class="col-xm-12 col-sm-7 col-md-7 col-lg-7">
                                                    <select id="ddlAliquoteIVAsuContributoPrevidenzialeProfessionisti" class="form-control"></select>
                                                    <!--<input type="hidden" id="txtPercIVAsuContributoPrevidenzialeProfessionisti">-->
                                                </div>
                                            </div>

                                            <div class="row">
                                                <div class="col-xm-12 col-sm-5 col-md-5 col-lg-5 text-right">
                                                    <label>ritenuta acconto&nbsp;%</label>
                                                </div>
                                                <div class="col-xm-12 col-sm-7 col-md-7 col-lg-7">
                                                    <input type="text" id="txtPercRitenutaAccontoProfessionisti" class="form-control">
                                                </div>
                                            </div>

                                        </div><!--/collapsable-->
                                    </div>
                                </div>


                                <div class="card border-primary mb-3">
                                    <div class="card-header">SPESE ANTICIPATE ART.15 DPR 633/72 (PROFESSIONISTI)</div>
                                    <div class="card-body">

                                        <div class="row">
                                            <div class="col-xm-12 col-sm-12 col-md-12 col-lg-12">

                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" value="" id="chkSpeseAnticipateArt15">
                                                    <label class="form-check-label" for="chkSpeseAnticipateArt15">
                                                        inserisci Spese Anticipate Art.15
                                                    </label>
                                                </div>

                                                <div class="row">
                                                    <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                                                        <div class="spacerh20"></div>
                                                    </div>
                                                </div>

                                            </div>
                                        </div>

                                        <div class="collapse" id="collapsableSpeseAnticipateArt15">

                                            <div class="row">
                                                <div class="col-xm-12 col-sm-5 col-md-5 col-lg-5 text-right">
                                                    <label>importo spese anticipate:&nbsp;€</label>
                                                </div>
                                                <div class="col-xm-12 col-sm-7 col-md-7 col-lg-7">
                                                    <input type="text" id="txtImportoSpeseAnticipoProfessionistiART15" class="form-control">
                                                </div>
                                            </div>

                                        </div><!--/collapsable-->
                                    </div>
                                </div>
                                <!-- @@@@@@@@@@ fine form info accessorie @@@@@@@@@@@@ -->

                            </div>
                        </div>


                        <div class="row">
                            <div class="col-12 col-sm-12 col-md-12 col-lg-12">

                                <div class="clearfix">
                                    <button id="BackToStep4-button" type="button" class="btn btn-primary btn-lg float-left">&lt;&nbsp;indietro</button>
                                    <button id="GoToStep6-button" type="button" class="btn btn-primary btn-lg float-right">avanti&nbsp;&gt;</button>
                                </div>

                            </div>
                        </div>

                        <div class="row">
                            <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                                <div class="spacerh20"></div>
                            </div>
                        </div>

                        <!-- ################## end CONTENUTO STEP 5 ################## -->
                    </div>


                    <div class="myStep" id="step-6-content" aria-labelledby="step-6-button">
                        <!-- ################## start CONTENUTO STEP 6 ################## -->
                        <div class="row">
                            <div class="col-12 col-sm-8 col-md-8 col-lg-8 offset-sm-2 offset-md-2 offset-lg-2">

                                <div class="row">
                                    <div class="col-xm-12 col-sm-12 col-md-12 col-lg-12">
                                        <h3>Dati opzionali</h3>
                                        <hr />
                                        <p>In questa sezione inserire SOLO i campi concordati con il proprio cliente; ad esempio, se si dispone del codice CUP oppure del codice CIG, inserirlo una sola volta nella sezione ordine di Acquisto a meno di diversa indicazione.</p>
                                    </div>
                                </div>

                                <!-- ########## inizio opzionali ########## -->

                                <div class="row">
                                    <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                                        <div class="spacerh20"></div>
                                    </div>
                                </div>


                                <div class="card border-success mb-3">
                                    <div class="card-header">ESIGIBILITA' IVA</div>
                                    <div class="card-body">

                                        <!-- ###### ESIGIBILITA' IVA ########-->
                                        <div class="row">
                                            <div class="col-xm-6 col-sm-6 col-md-6 col-lg-6">

                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" value="" id="chkEsigibilitaIVA">
                                                    <label class="form-check-label" for="chkEsigibilitaIVA">
                                                        Specifica modalità esigibilità IVA (Immediata, Differita, Split Payment)
                                                    </label>
                                                </div>

                                            </div>
                                            <div class="col-xm-6 col-sm-6 col-md-6 col-lg-6">

                                                <div class="collapse" id="collapsableEsigibilitaIVA">
                                                    <label>Esigibilt&agrave; IVA</label>
                                                    <select id="ddlEsigibilitaIVA" class="form-control">
                                                        <!--<option value="I">[I] Immediata</option>
                                                        <option value="D">[D] Differita</option>
                                                        <option selected="selected" value="S">[S] Split Payment</option>-->
                                                    </select>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="row">
                                            <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                                                <div class="spacerh10"></div>
                                            </div>
                                        </div>
                                        <!-- ###### /ESIGIBILITA' IVA ########-->


                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-xm-12 col-sm-12 col-md-12 col-lg-12">
                                        <div style="height: 20px;">
                                        </div>
                                    </div>
                                </div>

                                <div class="card border-success mb-3">
                                    <div class="card-header">ORDINE DI ACQUISTO</div>
                                    <div class="card-body">

                                        <!--<div class="row">
                                        <div class="col-xm-12 col-sm-12 col-md-12 col-lg-12">-->
                                        <!-- ###### Ordine di acquisto ########-->

                                        <div class="row">
                                            <div class="col-xm-6 col-sm-6 col-md-6 col-lg-6">

                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" value="" id="chkDatiOrdineAcquisto_visualizzaIdDocumento">
                                                    <label class="form-check-label" for="chkDatiOrdineAcquisto_visualizzaIdDocumento">
                                                        inserisci il Numero d'Ordine
                                                    </label>
                                                </div>

                                            </div>
                                            <div class="col-xm-6 col-sm-6 col-md-6 col-lg-6">

                                                <div class="collapse" id="collapsableDatiOrdineAcquisto_visualizzaIdDocumento">
                                                    <label>Numero d'Ordine</label>
                                                    <input type="text" id="txtDatiOrdineAcquisto_IdDocumento" class="form-control">
                                                </div><!-- /collapsable -->

                                            </div>
                                        </div>

                                        <div class="row">
                                            <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                                                <div class="spacerh10"></div>
                                            </div>
                                        </div>

                                        <div class="row">
                                            <div class="col-xm-6 col-sm-6 col-md-6 col-lg-6">

                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" value="" id="chkDatiOrdineAcquisto_visualizzaData">
                                                    <label class="form-check-label" for="chkDatiOrdineAcquisto_visualizzaData">
                                                        inserisci la Data Ordine
                                                    </label>
                                                </div>

                                            </div>
                                            <div class="col-xm-6 col-sm-6 col-md-6 col-lg-6">

                                                <div class="collapse" id="collapsableDatiOrdineAcquisto_visualizzaData">
                                                    <label>Data Ordine</label>
                                                    <input type="text" id="txtDatiOrdineAcquisto_Data" class="form-control">
                                                </div>
                                            </div>
                                        </div>

                                        <div class="row">
                                            <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                                                <div class="spacerh10"></div>
                                            </div>
                                        </div>

                                        <div class="row">
                                            <div class="col-xm-6 col-sm-6 col-md-6 col-lg-6">

                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" value="" id="chkDatiOrdineAcquisto_visualizzaCodiceCUP">
                                                    <label class="form-check-label" for="chkDatiOrdineAcquisto_visualizzaCodiceCUP">
                                                        inserisci il Codice CUP
                                                    </label>
                                                </div>

                                            </div>
                                            <div class="col-xm-6 col-sm-6 col-md-6 col-lg-6">
                                                <div class="collapse" id="collapsableDatiOrdineAcquisto_visualizzaCodiceCUP">
                                                    <label>Codice CUP</label>
                                                    <input type="text" id="txtDatiOrdineAcquisto_CodiceCUP" class="form-control">
                                                </div>
                                            </div>
                                        </div>

                                        <div class="row">
                                            <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                                                <div class="spacerh10"></div>
                                            </div>
                                        </div>

                                        <div class="row">
                                            <div class="col-xm-6 col-sm-6 col-md-6 col-lg-6">

                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" value="" id="chkDatiOrdineAcquisto_visualizzaCodiceCIG">
                                                    <label class="form-check-label" for="chkDatiOrdineAcquisto_visualizzaCodiceCIG">
                                                        inserisci il Codice CIG
                                                    </label>
                                                </div>

                                            </div>
                                            <div class="col-xm-6 col-sm-6 col-md-6 col-lg-6">
                                                <div class="collapse" id="collapsableDatiOrdineAcquisto_visualizzaCodiceCIG">
                                                    <label>Codice CIG</label>
                                                    <input type="text" id="txtDatiOrdineAcquisto_CodiceCIG" class="form-control">
                                                </div>
                                            </div>
                                        </div>

                                        <div class="row">
                                            <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                                                <div class="spacerh10"></div>
                                            </div>
                                        </div>

                                        <div class="row">
                                            <div class="col-xm-6 col-sm-6 col-md-6 col-lg-6">

                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" value="" id="chkDatiOrdineAcquisto_visualizzaCodiceCommessaConvenzione">
                                                    <label class="form-check-label" for="chkDatiOrdineAcquisto_visualizzaCodiceCommessaConvenzione">
                                                        inserisci il Codice Commessa/Convenzione
                                                    </label>
                                                </div>

                                            </div>
                                            <div class="col-xm-6 col-sm-6 col-md-6 col-lg-6">
                                                <div class="collapse" id="collapsableDatiOrdineAcquisto_visualizzaCodiceCommessaConvenzione">
                                                    <label>Codice Commessa/Convenzione</label>
                                                    <input type="text" id="txtDatiOrdineAcquisto_CodiceCommessaConvenzione" class="form-control">
                                                </div>
                                            </div>
                                        </div>

                                        <div class="row">
                                            <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                                                <div class="spacerh10"></div>
                                            </div>
                                        </div>

                                        <!-- ###### /Ordine di acquisto ########-->
                                        <!--</div>
                                        </div>-->

                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-xm-12 col-sm-12 col-md-12 col-lg-12">
                                        <div style="height: 20px;">
                                        </div>
                                    </div>
                                </div>

                                <div class="card border-success mb-3">
                                    <div class="card-header">DATI CONTRATTO</div>
                                    <div class="card-body">

                                        <div class="row">

                                            <div class="col-xm-12 col-sm-12 col-md-12 col-lg-12">
                                                <!-- ###### DatiContratto ########-->

                                                <div class="row">
                                                    <div class="col-xm-6 col-sm-6 col-md-6 col-lg-6">

                                                        <div class="form-check">
                                                            <input class="form-check-input" type="checkbox" value="" id="chkDatiContratto_visualizzaIdDocumento">
                                                            <label class="form-check-label" for="chkDatiContratto_visualizzaIdDocumento">
                                                                inserisci il Num. Contratto
                                                            </label>
                                                        </div>

                                                    </div>
                                                    <div class="col-xm-6 col-sm-6 col-md-6 col-lg-6">
                                                        <div class="collapse" id="collapsableDatiContratto_visualizzaIdDocumento">
                                                            <label>Numero Contratto</label>
                                                            <input type="text" id="txtDatiContratto_IdDocumento" class="form-control">
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="row">
                                                    <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                                                        <div class="spacerh10"></div>
                                                    </div>
                                                </div>

                                                <div class="row">
                                                    <div class="col-xm-6 col-sm-6 col-md-6 col-lg-6">

                                                        <div class="form-check">
                                                            <input class="form-check-input" type="checkbox" value="" id="chkDatiContratto_visualizzaData">
                                                            <label class="form-check-label" for="chkDatiContratto_visualizzaData">
                                                                inserisci la Data Contratto
                                                            </label>
                                                        </div>

                                                    </div>
                                                    <div class="col-xm-6 col-sm-6 col-md-6 col-lg-6">
                                                        <div class="collapse" id="collapsableDatiContratto_visualizzaData">
                                                            <label>Data Contratto</label>
                                                            <input type="text" id="txtDatiContratto_Data" class="form-control">
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="row">
                                                    <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                                                        <div class="spacerh10"></div>
                                                    </div>
                                                </div>

                                                <div class="row">
                                                    <div class="col-xm-6 col-sm-6 col-md-6 col-lg-6">

                                                        <div class="form-check">
                                                            <input class="form-check-input" type="checkbox" value="" id="chkDatiContratto_visualizzaCodiceCUP">
                                                            <label class="form-check-label" for="chkDatiContratto_visualizzaCodiceCUP">
                                                                inserisci il Codice CUP
                                                            </label>
                                                        </div>

                                                    </div>
                                                    <div class="col-xm-6 col-sm-6 col-md-6 col-lg-6">
                                                        <div class="collapse" id="collapsableDatiContratto_visualizzaCodiceCUP">
                                                            <label>Codice CUP</label>
                                                            <input type="text" id="txtDatiContratto_CodiceCUP" class="form-control">
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="row">
                                                    <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                                                        <div class="spacerh10"></div>
                                                    </div>
                                                </div>

                                                <div class="row">
                                                    <div class="col-xm-6 col-sm-6 col-md-6 col-lg-6">

                                                        <div class="form-check">
                                                            <input class="form-check-input" type="checkbox" value="" id="chkDatiContratto_visualizzaCodiceCIG">
                                                            <label class="form-check-label" for="chkDatiContratto_visualizzaCodiceCIG">
                                                                inserisci il Codice CIG
                                                            </label>
                                                        </div>

                                                    </div>
                                                    <div class="col-xm-6 col-sm-6 col-md-6 col-lg-6">
                                                        <div class="collapse" id="collapsableDatiContratto_visualizzaCodiceCIG">
                                                            <label>Codice CIG</label>
                                                            <input type="text" id="txtDatiContratto_CodiceCIG" class="form-control">
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="row">
                                                    <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                                                        <div class="spacerh10"></div>
                                                    </div>
                                                </div>

                                                <div class="row">
                                                    <div class="col-xm-6 col-sm-6 col-md-6 col-lg-6">

                                                        <div class="form-check">
                                                            <input class="form-check-input" type="checkbox" value="" id="chkDatiContratto_visualizzaCodiceCommessaConvenzione">
                                                            <label class="form-check-label" for="chkDatiContratto_visualizzaCodiceCommessaConvenzione">
                                                                inserisci il Codice Commessa/Convenzione
                                                            </label>
                                                        </div>

                                                    </div>
                                                    <div class="col-xm-6 col-sm-6 col-md-6 col-lg-6">
                                                        <div class="collapse" id="collapsableDatiContratto_visualizzaCodiceCommessaConvenzione">
                                                            <label>Codice Commessa/Convenzione</label>
                                                            <input type="text" id="txtDatiContratto_CodiceCommessaConvenzione" class="form-control">
                                                        </div>
                                                    </div>
                                                </div>
                                                <!-- ###### /DatiContratto ########-->
                                            </div>

                                        </div>

                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                                        <div class="spacerh20"></div>
                                    </div>
                                </div>

                                <div class="card border-success mb-3">
                                    <div class="card-header">SAL</div>
                                    <div class="card-body">

                                        <div class="row">

                                            <div class="col-xm-12 col-sm-12 col-md-12 col-lg-12">
                                                <!-- ###### SAL ########-->

                                                <div class="row">
                                                    <div class="col-xm-6 col-sm-6 col-md-6 col-lg-6">

                                                        <div class="form-check">
                                                            <input class="form-check-input" type="checkbox" value="" id="chkDatiSAL_visualizzaRiferimentoFase">
                                                            <label class="form-check-label" for="chkDatiSAL_visualizzaRiferimentoFase">
                                                                inserisci il SAL
                                                            </label>
                                                        </div>

                                                    </div>
                                                    <div class="col-xm-6 col-sm-6 col-md-6 col-lg-6">
                                                        <div class="collapse" id="collapsableDatiSAL_visualizzaRiferimentoFase">
                                                            <!--Inserisci solo valori numerici (es: 1, 2, 3, ...)-->
                                                            <label>numero della fase del SAL (solo valore numerico)</label>
                                                            <input type="text" id="txtDatiSAL_RiferimentoFase" class="form-control">
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="row">
                                                    <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                                                        <div class="spacerh10"></div>
                                                    </div>
                                                </div>
                                                <!-- ###### /SAL ########-->
                                            </div>

                                        </div>

                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                                        <div class="spacerh20"></div>
                                    </div>
                                </div>

                                <div class="card border-success mb-3">
                                    <div class="card-header">ALTRE INFORMAZIONI OPZIONALI</div>
                                    <div class="card-body">

                                        <div class="row">

                                            <div class="col-xm-12 col-sm-12 col-md-12 col-lg-12">

                                                <!-- ###### Riferimento Normativo ########-->
                                                <div class="row">
                                                    <div class="col-xm-6 col-sm-6 col-md-6 col-lg-6">

                                                        <div class="form-check">
                                                            <input class="form-check-input" type="checkbox" value="" id="chkVisualizzaRiferimentoNormativo">
                                                            <label class="form-check-label" for="chkVisualizzaRiferimentoNormativo">
                                                                Inserisci il Riferimento Normativo
                                                            </label>
                                                        </div>

                                                    </div>
                                                    <div class="col-xm-6 col-sm-6 col-md-6 col-lg-6">
                                                        <div class="collapse" id="collapsableVisualizzaRiferimentoNormativo">
                                                            <label>Riferimento Normativo</label>
                                                            <input type="text" id="txtVisualizzaRiferimentoNormativo" class="form-control">
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                                                        <div class="spacerh10"></div>
                                                    </div>
                                                </div>
                                                <!-- ###### /Riferimento Normativo ########-->
                                                <!-- ###### Riferimento Amministrazione ########-->
                                                <div class="row">
                                                    <div class="col-xm-6 col-sm-6 col-md-6 col-lg-6">

                                                        <div class="form-check">
                                                            <input class="form-check-input" type="checkbox" value="" id="chkVisualizzaRiferimentoAmministrazione">
                                                            <label class="form-check-label" for="chkVisualizzaRiferimentoAmministrazione">
                                                                Inserisci il Riferimento Amministrazione (es. per sede INPS)
                                                            </label>
                                                        </div>

                                                    </div>
                                                    <div class="col-xm-6 col-sm-6 col-md-6 col-lg-6">
                                                        <div class="collapse" id="collapsableVisualizzaRiferimentoAmministrazione">
                                                            <label>Riferimento Amministrazione</label>
                                                            <input type="text" id="txtVisualizzaRiferimentoAmministrazione" class="form-control">
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                                                        <div class="spacerh10"></div>
                                                    </div>
                                                </div>
                                                <!-- ###### /Riferimento Amministrazione ########-->
                                                <!-- ###### Bollo ########-->
                                                <div class="row">
                                                    <div class="col-xm-6 col-sm-6 col-md-6 col-lg-6">

                                                        <div class="form-check">
                                                            <input class="form-check-input" type="checkbox" value="" id="chkVisualizzaCampiBolloFE">
                                                            <label class="form-check-label" for="chkVisualizzaCampiBolloFE">
                                                                Bollo virtuale
                                                                <br />
                                                                <small>Il bollo da 2 euro è dovuto per le fatture il cui importo non è soggetto a Iva, ma solo se superiore a 77,47 euro.</small>
                                                            </label>
                                                        </div>


                                                    </div>
                                                    <div class="col-xm-6 col-sm-6 col-md-6 col-lg-6">

                                                        <div class="collapse" id="collapsableVisualizzaCampiBolloFE">

                                                            <div class="row">
                                                                <div class="col-xm-12 col-sm-12 col-md-12 col-lg-12">
                                                                    <label>Importo Bollo</label>
                                                                    <input type="text" id="txtImportoBolloFE" class="form-control">
                                                                    <small>Inserisci valore con 2 decimali (es: 2,00)</small>
                                                                </div>
                                                            </div>
                                                            <div class="row">
                                                                <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                                                                    <div class="spacerh10"></div>
                                                                </div>
                                                            </div>
                                                            <div class="row">
                                                                <div class="col-xm-12 col-sm-12 col-md-12 col-lg-12">
                                                                    <div class="form-check">
                                                                        <input class="form-check-input" type="checkbox" value="" id="chkIncludiBolloInTotaleFE">
                                                                        <label class="form-check-label" for="chkIncludiBolloInTotaleFE">
                                                                            E' da addebitare alla PA? (includi importo bollo in Totale Fattura)
                                                                        </label>
                                                                    </div>
                                                                </div>
                                                            </div>

                                                        </div><!--/collapsable-->

                                                    </div>
                                                </div>

                                                <div class="row">
                                                    <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                                                        <div class="spacerh10"></div>
                                                    </div>
                                                </div>

                                                <!-- ###### /Bollo ########-->
                                                <!-- ###### Denominazione oppure Cognome-Nome ########-->
                                                <div class="row">
                                                    <div class="col-xm-6 col-sm-6 col-md-6 col-lg-6">

                                                        <div class="form-check">
                                                            <input class="form-check-input" type="checkbox" value="" id="chkVisualizzaCognomeNome">
                                                            <label class="form-check-label" for="chkVisualizzaCognomeNome">
                                                                Visualizza Cognome Nome al posto di Denominazione ditta (solo per professionisti)
                                                            </label>
                                                        </div>

                                                    </div>
                                                    <div class="col-xm-6 col-sm-6 col-md-6 col-lg-6">

                                                        <div class="collapse" id="collapsableVisualizzaCognomeNome">

                                                            <label>Cognome</label>
                                                            <input type="text" id="txtVisualizzaCognomeNome_Cognome" class="form-control">
                                                            <label>Nome</label>
                                                            <input type="text" id="txtVisualizzaCognomeNome_Nome" class="form-control">
                                                        </div>
                                                    </div>
                                                </div>

                                                <div class="row">
                                                    <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                                                        <div class="spacerh20"></div>
                                                    </div>
                                                </div>

                                                <!-- ###### /Denominazione oppure Cognome-Nome ########-->

                                                <div class="row">
                                                    <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                                                        <div class="spacerh10"></div>
                                                    </div>
                                                </div>

                                            </div>

                                        </div>


                                    </div>
                                </div>


                                <div class="row">
                                    <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                                        <div class="spacerh20"></div>
                                    </div>
                                </div>

                                <div class="card border-success mb-3">
                                    <div class="card-header">ALLEGATI OPZIONALI</div>
                                    <div class="card-body">

                                        <div class="row">
                                            <div class="col-xm-12 col-sm-12 col-md-12 col-lg-12">
                                                <div>
                                                    <span>Allega documenti alla Fattura Elettronica (verranno inclusi nel documento .XML).</span>
                                                </div>
                                                <div>
                                                    <button id="btnOpenPopupUploadAllegatiFEPA" type="button" onclick="openPopupAllegatiFEFn();" class="btn btn-secondary">Carica allegati</button>
                                                </div>

                                            </div>
                                        </div>

                                    </div>
                                </div>
                                <!-- ########## fine opzionali ########### -->

                            </div>
                        </div>

                        <div class="row">
                            <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                                <div class="spacerh20"></div>
                                <div class="spacerh20"></div>
                            </div>
                        </div>

                        <div class="row">

                            <div class="col-4 col-sm-4 col-md-4 col-lg-4">
                                <div class="clearfix">
                                    <button id="BackToStep5-button" type="button" class="btn btn-primary btn-lg float-left">&lt;&nbsp;indietro</button>
                                </div>
                            </div>

                            <div class="col-4 col-sm-4 col-md-4 col-lg-4">
                                <p class="text-center">
                                    <button id="btnVisualizzaRiepilogoDocumento" type="button" class="btn btn-success btn-lg btn-block"><i class="fas fa-eye"></i> Visualizza Riepilogo</button>
                                </p>
                            </div>

                            <div class="col-4 col-sm-4 col-md-4 col-lg-4">
                                <div class="clearfix">
                                    <button id="GoToStep7-button" type="button" class="btn btn-success btn-lg btn-block"><i class="fas fa-check"></i> Salva</button>
                                </div>
                            </div>

                        </div>

                        <div class="row">
                            <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                                <div class="spacerh20"></div>
                            </div>
                        </div>

                        <!-- ################## end CONTENUTO STEP 6 ################## -->
                    </div>

                    <div class="myStep" id="step-7-content" aria-labelledby="step-7-button">
                        <!-- ################## start CONTENUTO STEP 7 ################## -->
                        <div class="row">
                            <div class="col-12 col-sm-8 col-md-8 col-lg-8 offset-sm-2 offset-md-2 offset-lg-2">

                                <h3>Azioni</h3>
                                <hr />

                                <!-- ######################### VERSIONE XS (.d-block .d-sm-none) Visible only on xs ######################## -->

                                <div class="row">
                                    <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                                        <div class="spacerh20 d-block d-sm-none"></div>
                                    </div>
                                </div>

                                <div class="row d-block d-sm-none">
                                    <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                                        <div class="card">
                                            <div class="card-body">
                                                <p>Visualizza il documento</p>
                                                <button type="button" class="btn btn-success btn-lg btn-block" onclick="doVisualizzaAnteprimaHtmlFn();"><i class="fas fa-eye"></i>&nbsp;Visualizza</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="row d-block d-sm-none">
                                    <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                                        <div class="card">
                                            <div class="card-body">
                                                <p>Stampa documento in formato .Pdf</p>
                                                <button type="button" class="btn btn-success btn-lg btn-block" onclick="doStampaPdfFn();"><i class="fas fa-print"></i>&nbsp;Stampa .PDF</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="row d-block d-sm-none">
                                    <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                                        <div class="card">
                                            <div class="card-body">
                                                <p>Scarica il documento in formato .xml</p>
                                                <button type="button" class="btn btn-success btn-lg btn-block" onclick="doDownloadXmlFn();"><i class="fas fa-download"></i>&nbsp;Download .XML</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="row d-block d-sm-none">
                                    <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                                        <div class="card">
                                            <div class="card-body">
                                                <p>Verifica formale di correttezza prima dell'invio al Cliente</p>
                                                <button type="button" class="btn btn-success btn-lg btn-block" onclick="doVerificaFormaleFn();"><i class="fas fa-check"></i>&nbsp;Verifica documento</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="row d-block d-sm-none">
                                    <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                                        <div class="card">
                                            <div class="card-body">
                                                <p>La Fattura Elettronica verrà inviata al SDI che la inoltrerà alla PEC del tuo cliente; potrai vedere le Notifiche nell'Archivio Fatture.</p>
                                                <button type="button" class="btn btn-success btn-lg btn-block" onclick="openModalInvioSDIFn();"><i class="far fa-share-square"></i>&nbsp;Invia documento al Cliente</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="row d-block d-sm-none">
                                    <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                                        <div class="card">
                                            <div class="card-body">
                                                <p>Modifica il documento; ripeti la procedura per correggere eventuali errori</p>
                                                <button type="button" class="btn btn-success btn-lg btn-block" onclick="doEditFn();"><i class="fas fa-pencil-alt"></i>&nbsp;Modifica documento</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!--
                                <div class="row d-block d-sm-none">
                                    <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                                        <div class="card">
                                            <div class="card-body">
                                                <p>Elimina il documento dall'archivio; non sarà più possibile recuperare il documento eliminato</p>
                                                <button type="button" class="btn btn-success btn-lg btn-block" onclick="doDeleteFn();"><i class="far fa-trash-alt"></i>&nbsp;Elimina documento</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                    -->
                                <!-- ######################### /VERSIONE XS Visible only on xs ######################## -->
                                <!-- ######################### VERSIONE sm md lg xl (Hidden xs) ######################## -->

                                <div class="row d-none d-sm-block">
                                    <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                                        <div class="spacerh20 d-none d-sm-block"></div>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-sm-6 col-md-6 col-lg-6">
                                        <div class="d-none d-sm-block">
                                            <!--<h5>Visualizza</h5>-->
                                            <p class="card-text">Visualizza il contenuto del documento selezionato</p>
                                        </div>
                                    </div>

                                    <div class="col-sm-6 col-md-6 col-lg-6">
                                        <div class="d-none d-sm-block">
                                            <!--<h5>Stampa</h5>-->
                                            <p class="card-text">Stampa documento in formato .Pdf</p>
                                        </div>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-sm-6 col-md-6 col-lg-6">
                                        <div class="d-none d-sm-block">
                                            <button type="button" class="btn btn-success btn-lg btn-block" onclick="doVisualizzaAnteprimaHtmlFn();"><i class="fas fa-eye"></i>&nbsp;Visualizza</button>
                                        </div>
                                    </div>

                                    <div class="col-sm-6 col-md-6 col-lg-6">
                                        <div class="d-none d-sm-block">
                                            <button type="button" class="btn btn-success btn-lg btn-block" onclick="doStampaPdfFn();"><i class="fas fa-print"></i>&nbsp;Stampa .PDF</button>
                                        </div>
                                    </div>
                                </div>

                                <div class="row d-none d-sm-block">
                                    <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                                        <div class="spacerh20 d-none d-sm-block"></div>
                                    </div>
                                </div>
                                <div class="row d-none d-sm-block">
                                    <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                                        <div class="spacerh20 d-none d-sm-block"></div>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-sm-6 col-md-6 col-lg-6">
                                        <div class="d-none d-sm-block">
                                            <!--<h5>Download</h5>-->
                                            <p class="card-text">Scarica il documento in formato .xml</p>
                                        </div>
                                    </div>

                                    <div class="col-sm-6 col-md-6 col-lg-6">
                                        <div class="d-none d-sm-block">
                                            <!--<h5>Verifica</h5>-->
                                            <p class="card-text">Verifica la correttezza formale della fattura elettronica prima dell'invio al Cliente</p>
                                        </div>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-sm-6 col-md-6 col-lg-6">
                                        <div class="d-none d-sm-block">
                                            <button type="button" class="btn btn-success btn-lg btn-block" onclick="doDownloadXmlFn();"><i class="fas fa-download"></i>&nbsp;Download .XML</button>
                                        </div>
                                    </div>

                                    <div class="col-sm-6 col-md-6 col-lg-6">
                                        <div class="d-none d-sm-block">
                                            <button type="button" class="btn btn-success btn-lg btn-block" onclick="doVerificaFormaleFn();"><i class="fas fa-check"></i>&nbsp;Verifica</button>
                                        </div>
                                    </div>
                                </div>

                                <div class="row d-none d-sm-block">
                                    <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                                        <div class="spacerh20 d-none d-sm-block"></div>
                                    </div>
                                </div>
                                <div class="row d-none d-sm-block">
                                    <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                                        <div class="spacerh20 d-none d-sm-block"></div>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-sm-6 col-md-6 col-lg-6">
                                        <div class="d-none d-sm-block">
                                            <!--<h5>Download</h5>-->
                                            <p class="card-text">La Fattura Elettronica verrà inviata al SDI che la inoltrerà la tuo cliente; potrai vedere le Notifiche nell'Archivio Fatture.</p>
                                        </div>
                                    </div>

                                    <div class="col-sm-6 col-md-6 col-lg-6">
                                        <div class="d-none d-sm-block">
                                            <!--<h5>Verifica</h5>-->
                                            <p class="card-text">Modifica il documento; ripeti i passaggi della procedura per correggere eventuali errori</p>
                                        </div>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-sm-6 col-md-6 col-lg-6">
                                        <div class="d-none d-sm-block">
                                            <button type="button" class="btn btn-success btn-lg btn-block" onclick="openModalInvioSDIFn();"><i class="far fa-share-square"></i>&nbsp;Invia documento al Cliente</button>
                                        </div>
                                    </div>

                                    <div class="col-sm-6 col-md-6 col-lg-6">
                                        <div class="d-none d-sm-block">
                                            <button type="button" class="btn btn-success btn-lg btn-block" onclick="doEditFn();"><i class="fas fa-pencil-alt"></i>&nbsp;Modifica documento</button>
                                        </div>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                                        <div class="spacerh20 d-none d-sm-block"></div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                                        <div class="spacerh20 d-none d-sm-block"></div>
                                    </div>
                                </div>

                                <!--
                                        <div class="row">
                                            <div class="col-sm-6 col-md-6 col-lg-6">
                                                <div class="d-none d-sm-block">
                                            <p class="card-text">Elimina il documento dall'archivio; non sarà più possibile recuperare il documento</p>
                                        </div>
                                    </div>

                                    <div class="col-sm-6 col-md-6 col-lg-6">
                                        <div class="d-none d-sm-block">
                                        </div>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-sm-6 col-md-6 col-lg-6">
                                        <div class="d-none d-sm-block">
                                            <button type="button" class="btn btn-success btn-lg btn-block" onclick="doDeleteFn();"><i class="far fa-trash-alt"></i>&nbsp;Elimina documento</button>
                                        </div>
                                    </div>

                                    <div class="col-sm-6 col-md-6 col-lg-6">
                                        <div class="d-none d-sm-block">
                                        </div>
                                    </div>
                                </div>
                                -->
                                <!-- ######################### /VERSIONE sm md lg xl (Hidden xs) ######################## -->


                                <div class="row">
                                    <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                                        <div class="spacerh20"></div>
                                    </div>
                                </div>
                                <!-- fine cards -->

                            </div>
                        </div>
                        <!-- ################## end CONTENUTO STEP 7 ################## -->
                    </div>

                </div><!--/steps-->

            </div>

        </div>
    </div>
</div>

<!--<div class="container">
    <div class="row">
        <div class="col-12 col-sm-12 col-md-12 col-lg-12">

            <div id="smartwizard">
                <ul>
                    <li><a href="#step-1">Iniziamo<br /><small>Step description</small></a></li>
                    <li><a href="#step-2">Step 1<br /><small>Tipologia documento</small></a></li>
                    <li><a href="#step-3">Step 2<br /><small>Data e numero</small></a></li>
                    <li><a href="#step-4">Step 3<br /><small>Cliente</small></a></li>
                </ul>

                <div>
                    <div id="step-1" class="">
                        Step Content
                    </div>
                    <div id="step-2" class="">
                        Step Content
                    </div>
                    <div id="step-3" class="">
                        Step Content
                    </div>
                    <div id="step-4" class="">
                        Step Content
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>-->
<!--/container-->
<!--<div class="container">
    <div class="row">
        <div class="col-12 col-sm-12 col-md-12 col-lg-12">
            <h3>creazione fattura</h3>
            <hr>
            <div id="accordion" role="tablist">
                <div class="card">
                    <div class="card-header" role="tab" id="headingOne">
                        <h5 class="mb-0">
                            <span id="accordionStep_01_titleCheck"></span>
                            <a data-toggle="collapse" href="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                                Tipologia documento
                            </a>
                        </h5>
                    </div>
                    <div id="collapseOne" class="collapse" role="tabpanel" aria-labelledby="headingOne" data-parent="#accordion">
                        <div class="card-body">

                        </div>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header" role="tab" id="headingTwo">
                        <h5 class="mb-0">
                            <span id="accordionStep_02_titleCheck"></span>
                            <a class="collapsed" data-toggle="collapse" href="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                                Data documento
                            </a>
                        </h5>
                    </div>
                    <div id="collapseTwo" class="collapse" role="tabpanel" aria-labelledby="headingTwo" data-parent="#accordion">
                        <div class="card-body">

                        </div>
                    </div>

                </div>
                <div class="card">
                    <div class="card-header" role="tab" id="headingThree">
                        <h5 class="mb-0">
                            <a class="collapsed" data-toggle="collapse" href="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                                Collapsible Group Item #3
                            </a>
                        </h5>
                    </div>
                    <div id="collapseThree" class="collapse" role="tabpanel" aria-labelledby="headingThree" data-parent="#accordion">
                        <div class="card-body">
                            Anim pariatur cliche reprehenderit, enim eiusmod high life accusamus terry richardson ad squid. 3 wolf moon officia aute,
                            non cupidatat skateboard dolor brunch. Food truck quinoa nesciunt laborum eiusmod. Brunch 3 wolf moon tempor,
                            sunt aliqua put a bird on it squid single-origin coffee nulla assumenda shoreditch et. Nihil anim keffiyeh
                            helvetica, craft beer labore wes anderson cred nesciunt sapiente ea proident. Ad vegan excepteur butcher
                            vice lomo. Leggings occaecat craft beer farm-to-table, raw denim aesthetic synth nesciunt you probably
                            haven't heard of them accusamus labore sustainable VHS.
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>-->
<!-- Modal Archivio Clienti -->
<div class="modal fade" id="myModalArchivioClienti" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">

            <div class="modal-header">
                <h5 class="modal-title">Archivio Clienti</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>

            <div class="modal-body">
                <!-- ######## inizio ######## -->
                <div class="container">

                    <div class="row">
                        <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                            <!--<label for="txtSearchArchivioClienti">--><strong>Cerca</strong><!--</label>-->
                            <small><br />ragione sociale o p.iva o c.f. o nome abituale anche parziale</small>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-12 col-sm-6 col-md-6 col-lg-6">
                            <div class="input-group mb-3">
                                <input id="txtSearchArchivioClienti" type="text" class="form-control" placeholder="ragione sociale o p.iva o c.f. o nome abituale" aria-label="ragione sociale o p.iva o c.f. o nome abituale" aria-describedby="basic-addon2">
                                <div class="input-group-append">
                                    <button class="btn btn-outline-secondary" type="button" id="btnStartSearchArchivioClienti">trova</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                            <table class="table table-striped table-sm" id="tblArchivioClienti">
                                <!--<thead>
                                    <tr>
                                        <th scope="col" style="width:90%;">Ragione sociale</th>
                                        <th scope="col"></th>
                                    </tr>
                                </thead>-->
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <!-- ######## fine  ######## -->
            </div>


            <div class="modal-footer">
                <div class="container">

                    <div class="row">
                        <div class="col-12 col-sm-12 col-md-12 col-lg-12">

                            <nav aria-label="page navigation Archivio Clienti">
                                <ul class="pagination justify-content-center">
                                    <li class="page-item disabled">
                                        <a class="page-link preventDefaultOnMe" href="#" tabindex="-1" id="btnPagingGoToFirst_ArchivioClienti">&lt;&lt;</a>
                                    </li>
                                    <li class="page-item disabled">
                                        <a class="page-link preventDefaultOnMe" href="#" id="btnPagingGoBack_ArchivioClienti">&lt;</a>
                                    </li>
                                    <li class="page-item disabled" style="padding-left:6px;padding-right:6px;padding-top:3px;"><span>pag. <span id="txtCurrentPageIndex_ArchivioClienti"></span> di <span id="txtPageCount_ArchivioClienti"></span></span></li><!---->
                                    <li class="page-item">
                                        <a class="page-link preventDefaultOnMe" href="#" id="btnPagingGoForward_ArchivioClienti">&gt;</a>
                                    </li>
                                    <li class="page-item">
                                        <a class="page-link preventDefaultOnMe" href="#" id="btnPagingGoToLast_ArchivioClienti">&gt;&gt;</a>
                                    </li>
                                </ul>
                            </nav>

                        </div>
                    </div>

                </div>
            </div>


        </div>
    </div>
</div>

<!-- Modal Elenco PA -->
<div class="modal fade" id="myModalElencoPA" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">

            <div class="modal-header">
                <h5 class="modal-title">Archivio Clienti</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>

            <div class="modal-body">
                <!-- ######## inizio ######## -->
                <div class="container">

                    <div class="row">
                        <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                            <!--<label for="txtSearchElencoPA">--><strong>Cerca</strong><!--</label>-->
                            <small><br />Codice Univoco o parola chiave nel nome Ente anche parziale</small>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-12 col-sm-6 col-md-6 col-lg-6">
                            <div class="input-group mb-3">
                                <input id="txtSearchElencoPA" type="text" class="form-control" placeholder="Codice Univoco Ente o nome anche parziale" aria-label="Codice Univoco o parola chiave nel nome Ente anche parziale" aria-describedby="basic-addon2">
                                <div class="input-group-append">
                                    <button class="btn btn-outline-secondary" type="button" id="btnStartSearchElencoPA">trova</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                            <table class="table table-striped table-sm" id="tblElencoPA">
                                <!--<thead>
                                    <tr>
                                        <th scope="col" style="width:90%;">Ragione sociale</th>
                                        <th scope="col"></th>
                                    </tr>
                                </thead>-->
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <!-- ######## fine  ######## -->
            </div>


            <div class="modal-footer">
                <div class="container">

                    <div class="row">
                        <div class="col-12 col-sm-12 col-md-12 col-lg-12">

                            <nav aria-label="page navigation Archivio Clienti">
                                <ul class="pagination justify-content-center">
                                    <li class="page-item disabled">
                                        <a class="page-link preventDefaultOnMe" href="#" tabindex="-1" id="btnPagingGoToFirst_ElencoPA">&lt;&lt;</a>
                                    </li>
                                    <li class="page-item disabled">
                                        <a class="page-link preventDefaultOnMe" href="#" id="btnPagingGoBack_ElencoPA">&lt;</a>
                                    </li>
                                    <li class="page-item disabled" style="padding-left:6px;padding-right:6px;padding-top:3px;"><span>pag. <span id="txtCurrentPageIndex_ElencoPA"></span> di <span id="txtPageCount_ElencoPA"></span></span></li><!---->
                                    <li class="page-item">
                                        <a class="page-link preventDefaultOnMe" href="#" id="btnPagingGoForward_ElencoPA">&gt;</a>
                                    </li>
                                    <li class="page-item">
                                        <a class="page-link preventDefaultOnMe" href="#" id="btnPagingGoToLast_ElencoPA">&gt;&gt;</a>
                                    </li>
                                </ul>
                            </nav>

                        </div>
                    </div>

                </div>
            </div>


        </div>
    </div>
</div>

<!-- Modal Quick Insert Anagrafica Cliente -->
<div class="modal fade" id="myModalQuickInsertAnagraficaCliente" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Nuova Anagrafica Cliente</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <!-- ######## inizio form  ######## -->
                <div class="container">

                    <div class="row">
                        <div class="col-xm-12 col-sm-6 col-md-6 col-lg-6">
                            <span>Ragione Sociale o Nominativo</span>
                        </div>
                        <div class="col-xm-12 col-sm-6 col-md-6 col-lg-6">
                            <span>Nome Abituale (opzionale)</span>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-xm-12 col-sm-6 col-md-6 col-lg-6">
                            <input class="form-control" id="txtQuickInsertSoggetto_RagioneSociale" type="text" maxlength="250" placeholder="ragione sociale o nominativo">
                        </div>
                        <div class="col-xm-12 col-sm-6 col-md-6 col-lg-6">
                            <input class="form-control" id="txtQuickInsertSoggetto_NomeAbituale" type="text" maxlength="250" placeholder="nome abituale opzionale">
                            <small>il Nome Abituale viene usato solo per la ricerca interna</small>
                        </div>
                    </div>

                    <!--<div class="row">
                        <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                            <div class="spacerh10"></div>
                        </div>
                    </div>-->

                    <div class="row">
                        <div class="col-xm-12 col-sm-6 col-md-6 col-lg-6">
                            <span>P.Iva</span>
                        </div>
                        <div class="col-xm-12 col-sm-6 col-md-6 col-lg-6">
                            <span>Cod.Fiscale</span>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-xm-12 col-sm-6 col-md-6 col-lg-6">
                            <input class="form-control" id="txtQuickInsertSoggetto_PIVA" type="text" maxlength="20" placeholder="p.iva">
                        </div>
                        <div class="col-xm-12 col-sm-6 col-md-6 col-lg-6">
                            <input class="form-control" id="txtQuickInsertSoggetto_CF" type="text" maxlength="20" placeholder="cod. fiscale">
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                            <div class="spacerh10"></div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-xm-12 col-sm-6 col-md-6 col-lg-6">
                            <span>Indirizzo</span>
                        </div>
                        <div class="col-xm-12 col-sm-6 col-md-6 col-lg-6">
                            <span>Localita'</span>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-xm-12 col-sm-6 col-md-6 col-lg-6">
                            <input class="form-control" id="txtQuickInsertSoggetto_Indirizzo" type="text" maxlength="250" placeholder="indirizzo">
                        </div>
                        <div class="col-xm-12 col-sm-6 col-md-6 col-lg-6">
                            <input class="form-control" id="txtQuickInsertSoggetto_Localita" type="text" maxlength="250" placeholder="Localita">
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                            <div class="spacerh10"></div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-xm-12 col-sm-3 col-md-3 col-lg-3">
                            <span>CAP</span>
                        </div>
                        <div class="col-xm-12 col-sm-3 col-md-3 col-lg-3">
                            <span>Provincia (Sigla)</span>
                        </div>
                        <div class="col-xm-12 col-sm-6 col-md-6 col-lg-6">
                            <span>PEC (a cui inviare la fattura)</span>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-xm-12 col-sm-3 col-md-3 col-lg-3">
                            <input class="form-control" id="txtQuickInsertSoggetto_CAP" type="text" maxlength="6" placeholder="cap">
                        </div>
                        <div class="col-xm-12 col-sm-3 col-md-3 col-lg-3">
                            <input class="form-control" id="txtQuickInsertSoggetto_SiglaProvincia" type="text" maxlength="2" placeholder="sigla provincia">
                        </div>

                        <div class="col-xm-12 col-sm-6 col-md-6 col-lg-6">
                            <input class="form-control" id="txtQuickInsertSoggetto_PEC" type="text" maxlength="250" placeholder="pec">
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                            <div class="spacerh10"></div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                            <div class="spacerh10"></div>
                            <div id="boxMessageQuickInsertSoggetto" style="color:red;"></div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                            <button id="btnSaveQuickInsertSoggetto" type="button" class="btn btn-success btn-lg">SALVA</button>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                            <div class="spacerh20"></div>
                        </div>
                    </div>


                </div>
                <!--/container-->
                <!-- ######## fine form  ######## -->
            </div>
            <!--<div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Chiudi</button>
            </div>-->
        </div>
    </div>
</div>

<!-- Modal Archivio Articoli -->
<div class="modal fade" id="myModalArchivioArticoli" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">

            <div class="modal-header">
                <h5 class="modal-title">Archivio Articoli/Servizi</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>

            <div class="modal-body">
                <!-- ######## inizio ######## -->
                <div class="container">

                    <div class="row">
                        <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                            <!--<label for="txtSearchArchivioArticoli">--><strong>Cerca</strong><!--</label>-->
                            <small><br />codice articolo o descrizione anche parziale</small>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-12 col-sm-6 col-md-6 col-lg-6">
                            <div class="input-group mb-3">
                                <input id="txtSearchArchivioArticoli" type="text" class="form-control" placeholder="codice articolo o descrizione anche parziale" aria-label="codice o descrizione anche parziale" aria-describedby="basic-addon2">
                                <div class="input-group-append">
                                    <button class="btn btn-outline-secondary" type="button" id="btnStartSearchArchivioArticoli">trova</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                            <table class="table table-striped table-sm" id="tblArchivioArticoli">
                                <!--<thead>
                                    <tr>
                                        <th scope="col" style="width:90%;">Ragione sociale</th>
                                        <th scope="col"></th>
                                    </tr>
                                </thead>-->
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <!-- ######## fine  ######## -->
            </div>


            <div class="modal-footer">
                <div class="container">

                    <div class="row">
                        <div class="col-12 col-sm-12 col-md-12 col-lg-12">

                            <nav aria-label="page navigation Archivio Articoli">
                                <ul class="pagination justify-content-center">
                                    <li class="page-item disabled">
                                        <a class="page-link preventDefaultOnMe" href="#" tabindex="-1" id="btnPagingGoToFirst_ArchivioArticoli">&lt;&lt;</a>
                                    </li>
                                    <li class="page-item disabled">
                                        <a class="page-link preventDefaultOnMe" href="#" id="btnPagingGoBack_ArchivioArticoli">&lt;</a>
                                    </li>
                                    <li class="page-item disabled" style="padding-left:6px;padding-right:6px;padding-top:3px;"><span>pag. <span id="txtCurrentPageIndex_ArchivioArticoli"></span> di <span id="txtPageCount_ArchivioArticoli"></span></span></li><!---->
                                    <li class="page-item">
                                        <a class="page-link preventDefaultOnMe" href="#" id="btnPagingGoForward_ArchivioArticoli">&gt;</a>
                                    </li>
                                    <li class="page-item">
                                        <a class="page-link preventDefaultOnMe" href="#" id="btnPagingGoToLast_ArchivioArticoli">&gt;&gt;</a>
                                    </li>
                                </ul>
                            </nav>

                        </div>
                    </div>

                </div>
            </div>


        </div>
    </div>
</div>

<!-- Modal Inserisci riga con testo libero -->
<div class="modal fade" id="myModalTestoLibero" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">

            <div class="modal-header">
                <h5 class="modal-title">Inserisci riga con testo libero</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>

            <div class="modal-body">
                <!-- ######## inizio ######## -->
                <div class="container">

                    <div class="row">
                        <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                            <div class="spacerh10"></div>
                        </div>
                    </div>

                    <!-- ########### FORM TESTO LIBERO ######## -->
                    <div class="row">
                        <div class="col-xm-12 col-sm-12 col-md-12 col-lg-12">
                            <label>Descrizione</label>
                            <textarea rows="4" id="txtTestoLiberoDescrizioneInFattura" class="form-control"></textarea><!--cols="20"-->
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-xm-6 col-sm-6 col-md-6 col-lg-6">
                            <label>Importo unitario €</label>
                            <input type="text" id="txtTestoLiberoImportoUnitario" class="form-control text-right" />
                        </div>
                        <div class="col-xm-6 col-sm-6 col-md-6 col-lg-6">
                            <label>IVA</label>
                            <select id="ddlTestoLiberoAliquoteIVA" class="form-control"></select>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-xm-6 col-sm-6 col-md-6 col-lg-6">
                            <label>Quantit&agrave;</label>
                            <input type="text" value="1" id="txtTestoLiberoQuantita" class="form-control text-right" />
                        </div>
                        <div class="col-xm-6 col-sm-6 col-md-6 col-lg-6">
                            <label>Unit&agrave; di Misura</label>
                            <select id="ddlTestoLiberoUDM" class="form-control"></select>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                            <div class="spacerh10"></div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                            <button id="btnTestoLiberoInsert" type="button" class="btn btn-success btn-lg">Aggiungi riga</button>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                            <div class="spacerh20"></div>
                        </div>
                    </div>
                    <!-- ########### /FORM TESTO LIBERO ######## -->


                </div>
                <!-- ######## fine  ######## -->
            </div>

        </div>
    </div>
</div>

<!-- Modal Archivio DDT -->
<div class="modal fade" id="myModalArchivioDDT" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">

            <div class="modal-header">
                <h5 class="modal-title">Archivio DDT</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>

            <div class="modal-body">
                <!-- ######## inizio ######## -->
                <div class="container">

                    <!--
                            <div class="row">
                                <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                                    <strong>Cerca</strong></label>
                        <small><br />descrizione anche parziale</small>
                    </div>
                        </div>

                        <div class="row">
                            <div class="col-12 col-sm-6 col-md-6 col-lg-6">
                                <div class="input-group mb-3">
                                    <input id="txtSearchArchivioDDT" type="text" class="form-control" placeholder="numero o descrizione anche parziale" aria-label="codice o descrizione anche parziale" aria-describedby="basic-addon2">
                                    <div class="input-group-append">
                                        <button class="btn btn-outline-secondary" type="button" id="btnStartSearchArchivioArticoli">trova</button>
                                    </div>
                                </div>
                            </div>
                        </div>-->

                    <div class="row">
                        <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                            <table class="table table-striped table-sm" id="tblArchivioDDT">
                                <!--<thead>
                                    <tr>
                                        <th scope="col" style="width:90%;">ddt</th>
                                        <th scope="col"></th>
                                    </tr>
                                </thead>-->
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <!-- ######## fine  ######## -->
            </div>

            <div class="modal-footer">
                <div class="container">

                    <div class="row">
                        <div class="col-12 col-sm-12 col-md-12 col-lg-12">

                            <nav aria-label="page navigation Archivio DDT">
                                <ul class="pagination justify-content-center">
                                    <li class="page-item disabled">
                                        <a class="page-link preventDefaultOnMe" href="#" tabindex="-1" id="btnPagingGoToFirst_ArchivioDDT">&lt;&lt;</a>
                                    </li>
                                    <li class="page-item disabled">
                                        <a class="page-link preventDefaultOnMe" href="#" id="btnPagingGoBack_ArchivioDDT">&lt;</a>
                                    </li>
                                    <li class="page-item disabled" style="padding-left:6px;padding-right:6px;padding-top:3px;"><span>pag. <span id="txtCurrentPageIndex_ArchivioDDT"></span> di <span id="txtPageCount_ArchivioDDT"></span></span></li><!---->
                                    <li class="page-item">
                                        <a class="page-link preventDefaultOnMe" href="#" id="btnPagingGoForward_ArchivioDDT">&gt;</a>
                                    </li>
                                    <li class="page-item">
                                        <a class="page-link preventDefaultOnMe" href="#" id="btnPagingGoToLast_ArchivioDDT">&gt;&gt;</a>
                                    </li>
                                </ul>
                            </nav>

                        </div>
                    </div>

                </div>
            </div>


        </div>
    </div>
</div>


<!-- Modal Riepilogo Documento -->
<div class="modal fade" id="myModalRiepilogoDocumento" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">

            <div class="modal-header">
                <h5 class="modal-title">Riepilogo</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>

            <div class="modal-body">
                <!-- ######## inizio ######## -->
                <div class="container">

                    <div class="row">
                        <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                            <h4 id="RiepilogoDocumento_Header"></h4>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-12 col-sm-6 col-md-6 col-lg-6">
                            <div class="card">
                                <div class="card-header">
                                    <h4>Data e Numero</h4>
                                </div>
                                <div class="card-body">
                                    <div id="RiepilogoDocumento_DataNumero"></div>
                                </div>
                            </div>
                        </div>
                        <div class="col-12 col-sm-6 col-md-6 col-lg-6">
                            <div class="card">
                                <div class="card-header">
                                    <h4>Cliente</h4>
                                </div>
                                <div class="card-body">
                                    <div id="RiepilogoDocumento_Cliente"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                            <div class="spacerh20"></div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                            <div class="card">
                                <div class="card-header">
                                    <h4>Pagamento</h4>
                                </div>
                                <div class="card-body">
                                    <h4>Pagamento</h4>
                                    <div id="RiepilogoDocumento_ModalitaPagamento"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                            <div class="spacerh20"></div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                            <div class="card">
                                <div class="card-header">
                                    <h4>Righe</h4>
                                </div>
                                <div class="card-body">
                                    <table class="table table-striped table-sm" id="RiepilogoDocumento_Righe">
                                        <thead><tr><td>codice</td><td>descrizione</td><td>udm</td><td>qta</td><td>importo unit.</td><td>iva</td></tr></thead>
                                        <tbody></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                            <div class="spacerh20"></div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                            <div class="card">
                                <div class="card-header">
                                    <h4>Altre informazioni</h4>
                                </div>
                                <div class="card-body">
                                    <h4>Altre informazioni</h4>
                                    <div id="RiepilogoDocumento_Altro"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                            <div class="spacerh20"></div>
                        </div>
                    </div>

                </div>
                <!-- ######## fine  ######## -->
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Chiudi</button>
            </div>

        </div>
    </div>
</div>


<!-- Modal Invio a SDI -->
<div class="modal fade" id="myModalInvioSDI" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">

            <div class="modal-header">
                <h5 class="modal-title">Invia il Documento al Cliente (attraverso SDI)</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>

            <div class="modal-body">
                <!-- ######## inizio ######## -->
                <div class="container">

                    <div class="row">
                        <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                            <h4>Invia il Documento al Cliente</h4>
                            <div>
                                <p>Il Documento verrà inviato al Sistema Di Interscambio che provvederà ad inoltrarlo al tuo cliente sulla sua casella PEC oppure attraverso il canale che questi ha indicato per la ricezione delle fatture elettroniche.</p>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                            <div class="spacerh20"></div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                            <div id="boxMessageInvioSDI"></div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                            <div class="spacerh10"></div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                            <button type="button" class="btn btn-success btn-lg btn-block" onclick="doInvioSDIFn();"><i class="far fa-share-square"></i>&nbsp;Invia documento a Cliente</button>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                            <div class="spacerh20"></div>
                        </div>
                    </div>

                </div>
                <!-- ######## fine  ######## -->
            </div>

            <div class="modal-footer">
            </div>

        </div>
    </div>
</div>


<script src="js/FatturaCliCommon.js"></script>
<script type="text/javascript">

    var myObjFattura = new Entities.FatturaCli;
    var myObjCliente = new Entities.Soggetto;

    $('#txtDataDocumento').datepicker({
        uiLibrary: 'bootstrap4',
        iconsLibrary: 'fontawesome',
        format: 'dd/mm/yyyy'
    });
    $('#txtTipoPagamento_DataScadenzaPagamento').datepicker({
        uiLibrary: 'bootstrap4',
        iconsLibrary: 'fontawesome',
        format: 'dd/mm/yyyy'
    });
    $('#txtDatiOrdineAcquisto_Data').datepicker({
        uiLibrary: 'bootstrap4',
        iconsLibrary: 'fontawesome',
        format: 'dd/mm/yyyy'
    });
    $('#txtDatiContratto_Data').datepicker({
        uiLibrary: 'bootstrap4',
        iconsLibrary: 'fontawesome',
        format: 'dd/mm/yyyy'
    });

    // Serve per verificare se la fattura in edit è già stata caricata
    // viene caricata cliccando su step 1 (oppure un successivo step)
    var isDoneCaricamentoIniziale_Step0;

    $(document).ready(function () {
        PageLoad();
    });

    function PageLoad() {

        isDoneCaricamentoIniziale_Step0 = false;

        // ******************************
        // START NAVIGAZIONE STEPS
        // ******************************
        $("#step-0-button").addClass("active");

        $("#step-1-content").hide();
        $("#step-2-content").hide();
        $("#step-3-content").hide();
        $("#step-4-content").hide();
        $("#step-5-content").hide();
        $("#step-6-content").hide();
        $("#step-7-content").hide();
        $("#step-0-content").show("fast");

        //if (isUserLoggedIn()) {
        //    // ****************************************************
        //    // AVVIA POPOLAMENTO DI TUTTE LE COLLECTIONS ACCESSORIE
        //    // ****************************************************
        //    PopolaCollections();
        //};
    };

    function validateFormFn(stepNum) {

        var risposta = { "isValid": true, "descrizione": "tutto ok", "isLoggedIn": true };

        // Primo controllo: Login?
        if (!isUserLoggedIn()) {
            //$('#myModalLogin').modal("show");
            risposta.isLoggedIn = false;
            risposta.isValid = false;
            risposta.descrizione = "per procedere seleziona un tipo di documento";
            return risposta;
        };

        switch (stepNum) {

            case 1:
                // step 1: tipo documento

                //è stato caricato il documento default?
                if (isDoneCaricamentoIniziale_Step0 == false) {
                    risposta.isLoggedIn = true;
                    risposta.isValid = false;
                    risposta.descrizione = "per procedere verifica i dati nel passaggio 1";
                    return risposta;
                };

                // controllo: è stato selezionata una voce del radio?
                if (!$("input[name='radioTipiDocumento']:checked").val()) {
                    risposta.isLoggedIn = true;
                    risposta.isValid = false;
                    risposta.descrizione = "per procedere seleziona un tipo di documento";
                    return risposta;
                };
                break;

            case 2:
                // step 2: data documento
                if (moment($("#txtDataDocumento").val(), "DD/MM/YYYY").isValid() == false) {
                    risposta.isLoggedIn = true;
                    risposta.isValid = false;
                    risposta.descrizione = "La Data del documento non sembra corretta (inserire una data in formato gg/mm/aaaa)";
                    return risposta;
                };



                if ($("input[name='radioNumerazioneDocumento']:checked").val() == "m") {

                    //numerazione manuale
                    var NumDoc = $("#txtNumeroDocumento").val();

                    if (NumDoc == "") {
                        risposta.isLoggedIn = true;
                        risposta.isValid = false;
                        risposta.descrizione = "Inserisci un Numero documento oppure seleziona Numerazione Automatica";
                        return risposta;
                    }

                    if (!$.isNumeric(NumDoc)) {
                        risposta.isLoggedIn = true;
                        risposta.isValid = false;
                        risposta.descrizione = "Inserisci un Numero documento (1-9999)";
                        return risposta;
                    }

                    // è un intero?
                    if (Math.floor(NumDoc) != NumDoc) {
                        risposta.isLoggedIn = true;
                        risposta.isValid = false;
                        risposta.descrizione = "Inserisci un Numero documento (1-9999)";
                        return risposta;
                    }

                    if (!(NumDoc >= 1 & NumDoc <= 9999)) {
                        risposta.isLoggedIn = true;
                        risposta.isValid = false;
                        risposta.descrizione = "Inserisci un Numero documento (1-9999).";
                        return risposta;
                    }
                }

                break;
            case 3:

                // step 3: selezionato il cliente?
                //alert("myObjFattura.uidsoggetto=" + myObjFattura.uidsoggetto);
                if (myObjFattura.uidsoggetto == "" | myObjFattura.uidsoggetto == EmptyUid) {
                    risposta.isLoggedIn = true;
                    risposta.isValid = false;
                    risposta.descrizione = "Seleziona un cliente: Ditta, Privato o Ente PA";
                    return risposta;
                };

                break;
            case 4:

                // C'e' almeno una riga fattura?
                if (myObjFattura.righe.length == 0) {
                    risposta.isLoggedIn = true;
                    risposta.isValid = false;
                    risposta.descrizione = "inserisci almeno una riga in fattura selezionando un Articolo/Servizio oppure un Testo libero oppure includendo un Documento";
                    return risposta;
                };

                // I DATI INSERITI SONO COERENTI?
                $.each(myObjFattura.righe, function (i, objRiga) {

                    if (!$.isNumeric(objRiga.quantita)) {
                        risposta.isLoggedIn = true;
                        risposta.isValid = false;
                        risposta.descrizione = "campo Quantita non valido";
                        return risposta;
                    };

                    if (!$.isNumeric(objRiga.importounitario)) {
                        risposta.isLoggedIn = true;
                        risposta.isValid = false;
                        risposta.descrizione = "campo Prezzo non valido";
                        return risposta;
                    };

                    if (objRiga.descrizioneinfattura == "") {
                        risposta.isLoggedIn = true;
                        risposta.isValid = false;
                        risposta.descrizione = "campo Descrizione vuoto";
                        return risposta;
                    };
                });

                break;
            case 5:

                // Tipologia di Pagamento?
                if ($("#ddlTipoPagamento").val() == EmptyUid) {
                    risposta.isLoggedIn = true;
                    risposta.isValid = false;
                    risposta.descrizione = "seleziona una Tipologia di Pagamento";
                    return risposta;
                };

                //Data scadenza OPZIONALE; se inserita deve essere valida
                if ($("#txtTipoPagamento_DataScadenzaPagamento").val() != "") {
                    if (moment($("#txtTipoPagamento_DataScadenzaPagamento").val(), "DD/MM/YYYY").isValid() == false) {
                        risposta.isLoggedIn = true;
                        risposta.isValid = false;
                        risposta.descrizione = "La Data scadenza non sembra corretta (inserire una data in formato gg/mm/aaaa)";
                        return risposta;
                    };
                };

                // ddlCondizioniPagamento?
                if ($("#ddlCondizioniPagamento").val() == EmptyUid) {
                    risposta.isLoggedIn = true;
                    risposta.isValid = false;
                    risposta.descrizione = "seleziona una Condizione di Pagamento";
                    return risposta;
                };

                //AMMETTE SOLO CHE IL CAMPO IBAN sia vuoto oppure "-" oppure "NO";
                if ($("#txtBancaIBAN").val() != "" & $("#txtBancaIBAN").val().length > 4) {
                    if ($("#txtBancaIBAN").val().length != 27) {
                        risposta.isLoggedIn = true;
                        risposta.isValid = false;
                        risposta.descrizione = "Puoi lasciare vuoto questo campo nella definizione delle tue coordinate bancarie; se è presente il codice IBAN deve essere composto da 27 caratteri alfanumerici es. IT00A0000000000000000000000";
                        return risposta;
                    }
                };

                var _PercContributoPrevidenziale = numberEngFormat($("#txtPercContributoPrevidenzialeProfessionisti").val());
                if (_PercContributoPrevidenziale != "") {
                    if (!$.isNumeric(_PercContributoPrevidenziale)) {
                        risposta.isLoggedIn = true;
                        risposta.isValid = false;
                        risposta.descrizione = "la Perc.Contributo Previdenziale deve essere un numero 0-100";
                        return risposta;
                    };
                    if (!(_PercContributoPrevidenziale >= 0 & _PercContributoPrevidenziale <= 100)) {
                        risposta.isLoggedIn = true;
                        risposta.isValid = false;
                        risposta.descrizione = "la Perc.Contributo Previdenziale deve essere un numero 0-100.";
                        return risposta;
                    };
                };


                // ddl Aliquota IVA su Contributo Previdenziale Professionisti
                if ($("#ddlAliquoteIVAsuContributoPrevidenzialeProfessionisti").val() == EmptyUid) {
                    risposta.isLoggedIn = true;
                    risposta.isValid = false;
                    risposta.descrizione = "seleziona una aliquota iva sul contributo previdenziale";
                    return risposta;
                };

                var _PercRitenutaAccontoProfessionisti = numberEngFormat($("#txtPercRitenutaAccontoProfessionisti").val());
                if (_PercRitenutaAccontoProfessionisti != "") {

                    if (!$.isNumeric(_PercRitenutaAccontoProfessionisti)) {
                        risposta.isLoggedIn = true;
                        risposta.isValid = false;
                        risposta.descrizione = "la Perc. della Ritenuta Acconto deve essere un numero 0-100";
                        return risposta;
                    };

                    if (!(_PercRitenutaAccontoProfessionisti >= 0 & _PercRitenutaAccontoProfessionisti <= 100)) {
                        risposta.isLoggedIn = true;
                        risposta.isValid = false;
                        risposta.descrizione = "la Perc. della Ritenuta Acconto deve essere un numero 0-100.";
                        return risposta;
                    };

                };

                var _ImportoSpeseAnticipoProfessionistiART15 = numberEngFormat($("#txtImportoSpeseAnticipoProfessionistiART15").val());
                if (_ImportoSpeseAnticipoProfessionistiART15 != "") {
                    if (!$.isNumeric(_ImportoSpeseAnticipoProfessionistiART15)) {
                        risposta.isLoggedIn = true;
                        risposta.isValid = false;
                        risposta.descrizione = "importo Spese Anticipate Art.15 non valido";
                        return risposta;
                    };
                };

                break;

            case 6:

                if ($("#txtDatiOrdineAcquisto_Data").val() != "") {
                    if (moment($("#txtDatiOrdineAcquisto_Data").val(), "DD/MM/YYYY").isValid() == false) {
                        risposta.isLoggedIn = true;
                        risposta.isValid = false;
                        risposta.descrizione = "La Data nei Dati Ordine Acquisto non sembra corretta; inserisci una data in formato gg/mm/aaaa oppure lascia vuoto";
                        return risposta;
                    };
                };

                if ($("#txtDatiContratto_Data").val() != "") {
                    if (moment($("#txtDatiContratto_Data").val(), "DD/MM/YYYY").isValid() == false) {
                        risposta.isLoggedIn = true;
                        risposta.isValid = false;
                        risposta.descrizione = "La Data nei Dati Contratto non sembra corretta; inserisci una data in formato gg/mm/aaaa oppure lascia vuoto";
                        return risposta;
                    };
                };

                if ($("#txtImportoBolloFE").val() != "") {
                    if (!$.isNumeric(numberEngFormat($("#txtImportoBolloFE").val()))) {
                        risposta.isLoggedIn = true;
                        risposta.isValid = false;
                        risposta.descrizione = "importo Bollo non valido";
                        return risposta;
                    };
                };

                break;
        }

        //$("#accordionStep_01_titleCheck").css({ 'color': 'green' }).empty().append($.parseHTML(html_icon_ok));
        return risposta;
    };

    $('input[name="radioNumerazioneDocumento"]:radio').change(function () {

        if ($("input[name='radioNumerazioneDocumento']:checked").val() == "m") {
            //numerazione manuale
            $('#collapsableNumeroDocumento').collapse('show');
        }
        if ($("input[name='radioNumerazioneDocumento']:checked").val() == "a") {
            //numerazione automatica
            $('#collapsableNumeroDocumento').collapse('hide');
            $("#txtNumeroDocumento").val("");
        }
    });

    $('input[name="radioSezionale"]:radio').change(function () {

        if ($("input[name='radioSezionale']:checked").val() == "s") {
            //si sezionale
            $('#collapsableSezionale').collapse('show');
        }
        if ($("input[name='radioSezionale']:checked").val() == "n") {
            //no sezionale
            $('#collapsableSezionale').collapse('hide');

            //SETTO VALORE DEFAULT PER SEZIONALE VUOTO --> UID=00000000-0000-0000-0000-000000000001
            $('#ddlSezionale').val('00000000-0000-0000-0000-000000000001');
        }
    });

    $('#chkRitenuta').change(function () {
        if (this.checked) {
            $('#collapsableRitenuta').collapse('show');
        } else {
            $('#collapsableRitenuta').collapse('hide');
            $('#txtPercContributoPrevidenzialeProfessionisti').val("0");
            $('#txtPercRitenutaAccontoProfessionisti').val("0");
        };
        $('#chkRitenuta').val(this.checked);
    });

    $('#chkSpeseAnticipateArt15').change(function () {
        if (this.checked) {
            $('#collapsableSpeseAnticipateArt15').collapse('show');
        } else {
            $('#collapsableSpeseAnticipateArt15').collapse('hide');
            $('#txtImportoSpeseAnticipoProfessionistiART15').val("0");
        }
        $('#chkSpeseAnticipateArt15').val(this.checked);
    });

    // CLICK IN e OUT --> formatta l'importo ITA/ENG
    $('#txtImportoSpeseAnticipoProfessionistiART15').focusin(function () {
        if ($(this).is(":focus")) {
            var numeroITA = $(this).val().replace(/[^0-9-,]/g, ''); // PERMETTE SOLO I CARATTERI 1-9 e ","
            $(this).val(numeroITA);
        };
    }).focusout(function () {
        // *************************
        // PULISCE E FORMATTA input
        // *************************
        // 1.234,56 --> 1234,56
        var strImportoITA = $(this).val().replace(/[^0-9-,]/g, ''); // AMMETTE SOLO I CARATTERI 1-9 e ","; tutto il resto sostituisce con ''
        // 1234,56 --> 1234.56
        var strImportoENG = numberEngFormat(strImportoITA); //.replace(',', '.');

        if (isNaN(parseFloat(strImportoENG))) {
            return
        } else {
            var strImportoITA2 = Number(parseFloat(strImportoENG)).toLocaleString("it-IT", { minimumFractionDigits: 2, maximumFractionDigits: 4 });
            $(this).val(strImportoITA2);
        };
    });

    $('#chkDatiOrdineAcquisto_visualizzaIdDocumento').change(function () {
        if (this.checked) {
            $('#collapsableDatiOrdineAcquisto_visualizzaIdDocumento').collapse('show');
        } else {
            $('#collapsableDatiOrdineAcquisto_visualizzaIdDocumento').collapse('hide');
            $('#txtDatiOrdineAcquisto_IdDocumento').val('');
        }
        $('#chkDatiOrdineAcquisto_visualizzaIdDocumento').val(this.checked);
    });

    $('#chkDatiOrdineAcquisto_visualizzaData').change(function () {
        if (this.checked) {
            $('#collapsableDatiOrdineAcquisto_visualizzaData').collapse('show');
        } else {
            $('#collapsableDatiOrdineAcquisto_visualizzaData').collapse('hide');
            $('#txtDatiOrdineAcquisto_Data').val('');
        }
        $('#chkDatiOrdineAcquisto_visualizzaData').val(this.checked);
    });


    $('#chkDatiOrdineAcquisto_visualizzaCodiceCUP').change(function () {
        if (this.checked) {
            $('#collapsableDatiOrdineAcquisto_visualizzaCodiceCUP').collapse('show');
        } else {
            $('#collapsableDatiOrdineAcquisto_visualizzaCodiceCUP').collapse('hide');
            $('#txtDatiOrdineAcquisto_CodiceCUP').val('');
        }
        $('#chkDatiOrdineAcquisto_visualizzaCodiceCUP').val(this.checked);
    });

    $('#chkDatiOrdineAcquisto_visualizzaCodiceCIG').change(function () {
        if (this.checked) {
            $('#collapsableDatiOrdineAcquisto_visualizzaCodiceCIG').collapse('show');
        } else {
            $('#collapsableDatiOrdineAcquisto_visualizzaCodiceCIG').collapse('hide');
            $('#txtDatiOrdineAcquisto_CodiceCIG').val('');
        }
        $('#chkDatiOrdineAcquisto_visualizzaCodiceCIG').val(this.checked);
    });


    $('#chkDatiOrdineAcquisto_visualizzaCodiceCommessaConvenzione').change(function () {
        if (this.checked) {
            $('#collapsableDatiOrdineAcquisto_visualizzaCodiceCommessaConvenzione').collapse('show');
        } else {
            $('#collapsableDatiOrdineAcquisto_visualizzaCodiceCommessaConvenzione').collapse('hide');
            $('#txtDatiOrdineAcquisto_CodiceCommessaConvenzione').val('');
        }
        $('#chkDatiOrdineAcquisto_visualizzaCodiceCommessaConvenzione').val(this.checked);
    });


    $('#chkDatiContratto_visualizzaIdDocumento').change(function () {
        if (this.checked) {
            $('#collapsableDatiContratto_visualizzaIdDocumento').collapse('show');
        } else {
            $('#collapsableDatiContratto_visualizzaIdDocumento').collapse('hide');
            $('#txtDatiContratto_IdDocumento').val('');
        }
        $('#chkDatiContratto_visualizzaIdDocumento').val(this.checked);
    });



    $('#chkDatiContratto_visualizzaData').change(function () {
        if (this.checked) {
            $('#collapsableDatiContratto_visualizzaData').collapse('show');
        } else {
            $('#collapsableDatiContratto_visualizzaData').collapse('hide');
            $('#txtDatiContratto_Data').val('');
        }
        $('#chkDatiContratto_visualizzaData').val(this.checked);
    });



    $('#chkDatiContratto_visualizzaCodiceCUP').change(function () {
        if (this.checked) {
            $('#collapsableDatiContratto_visualizzaCodiceCUP').collapse('show');
        } else {
            $('#collapsableDatiContratto_visualizzaCodiceCUP').collapse('hide');
            $('#txtDatiContratto_CodiceCUP').val('');
        }
        $('#chkDatiContratto_visualizzaCodiceCUP').val(this.checked);
    });



    $('#chkDatiContratto_visualizzaCodiceCIG').change(function () {
        if (this.checked) {
            $('#collapsableDatiContratto_visualizzaCodiceCIG').collapse('show');
        } else {
            $('#collapsableDatiContratto_visualizzaCodiceCIG').collapse('hide');
            $('#txtDatiContratto_CodiceCIG').val('');
        }
        $('#chkDatiContratto_visualizzaCodiceCIG').val(this.checked);
    });



    $('#chkDatiContratto_visualizzaCodiceCommessaConvenzione').change(function () {
        if (this.checked) {
            $('#collapsableDatiContratto_visualizzaCodiceCommessaConvenzione').collapse('show');
        } else {
            $('#collapsableDatiContratto_visualizzaCodiceCommessaConvenzione').collapse('hide');
            $('#txtDatiContratto_CodiceCommessaConvenzione').val('');
        }
        $('#chkDatiContratto_visualizzaCodiceCommessaConvenzione').val(this.checked);
    });



    $('#chkDatiSAL_visualizzaRiferimentoFase').change(function () {
        if (this.checked) {
            $('#collapsableDatiSAL_visualizzaRiferimentoFase').collapse('show');
        } else {
            $('#collapsableDatiSAL_visualizzaRiferimentoFase').collapse('hide');
            $('#txtDatiSAL_RiferimentoFase').val('');
        }
        $('#chkDatiSAL_visualizzaRiferimentoFase').val(this.checked);
    });



    $('#chkEsigibilitaIVA').change(function () {
        if (this.checked) {
            $('#collapsableEsigibilitaIVA').collapse('show');
        } else {
            $('#collapsableEsigibilitaIVA').collapse('hide');
        }
        $('#chkEsigibilitaIVA').val(this.checked);
    });



    $('#chkVisualizzaRiferimentoNormativo').change(function () {
        if (this.checked) {
            $('#collapsableVisualizzaRiferimentoNormativo').collapse('show');
        } else {
            $('#collapsableVisualizzaRiferimentoNormativo').collapse('hide');
            $('#txtVisualizzaRiferimentoNormativo').val('');
        }
        $('#chkVisualizzaRiferimentoNormativo').val(this.checked);
    });


    $('#chkVisualizzaRiferimentoAmministrazione').change(function () {
        if (this.checked) {
            $('#collapsableVisualizzaRiferimentoAmministrazione').collapse('show');
        } else {
            $('#collapsableVisualizzaRiferimentoAmministrazione').collapse('hide');
            $('#txtVisualizzaRiferimentoAmministrazione').val('');
        }
        $('#chkVisualizzaRiferimentoAmministrazione').val(this.checked);
    });


    $('#chkVisualizzaCampiBolloFE').change(function () {
        if (this.checked) {
            $('#collapsableVisualizzaCampiBolloFE').collapse('show');
        } else {
            $('#collapsableVisualizzaCampiBolloFE').collapse('hide');
            $('#txtImportoBolloFE').val('0');
            $('#chkIncludiBolloInTotaleFE').prop('checked', false);
        };
        $('#chkVisualizzaCampiBolloFE').val(this.checked);
    });
    // CLICK IN e OUT --> formatta l'importo ITA/ENG
    $('#txtImportoBolloFE').focusin(function () {
        if ($(this).is(":focus")) {
            var numeroITA = $(this).val().replace(/[^0-9-,]/g, ''); // PERMETTE SOLO I CARATTERI 1-9 e ","
            $(this).val(numeroITA);
        };
    }).focusout(function () {
        // *************************
        // PULISCE E FORMATTA input
        // *************************
        // 1.234,56 --> 1234,56
        var strImportoITA = $(this).val().replace(/[^0-9-,]/g, ''); // AMMETTE SOLO I CARATTERI 1-9 e ","; tutto il resto sostituisce con ''
        // 1234,56 --> 1234.56
        var strImportoENG = numberEngFormat(strImportoITA); //.replace(',', '.');
        if (isNaN(parseFloat(strImportoENG))) {
            return
        } else {
            var strImportoITA2 = Number(parseFloat(strImportoENG)).toLocaleString("it-IT", { minimumFractionDigits: 2, maximumFractionDigits: 4 });
            $(this).val(strImportoITA2);
        };
    });


    $('#chkVisualizzaCognomeNome').change(function () {
        if (this.checked) {
            $('#collapsableVisualizzaCognomeNome').collapse('show');
        } else {
            $('#collapsableVisualizzaCognomeNome').collapse('hide');
            $('#txtVisualizzaCognomeNome_Cognome').val('');
            $('#txtVisualizzaCognomeNome_Nome').val('');
        }
        $('#chkVisualizzaCognomeNome').val(this.checked);
    });




    /* **********************************************
    QUICK INSERT NUOVA ANAGRAFICA CLIENTE
    ************************************************* */
    $("#btnOpenModalNuovoCliente").click(function () {
        $("#boxMessageQuickInsertSoggetto").empty();
        $('#myModalQuickInsertAnagraficaCliente').modal("show");
    });

    $("#btnSaveQuickInsertSoggetto").click(function () {

        if (isValidFormQuickInsertSoggetto() == false) {
            return;
        };
        var RagioneSociale = $("#txtQuickInsertSoggetto_RagioneSociale").val();
        var NomeAbituale = $("#txtQuickInsertSoggetto_NomeAbituale").val();
        var PIVA = $("#txtQuickInsertSoggetto_PIVA").val();
        var CF = $("#txtQuickInsertSoggetto_CF").val();
        var Indirizzo = $("#txtQuickInsertSoggetto_Indirizzo").val();
        var Localita = $("#txtQuickInsertSoggetto_Localita").val();
        var CAP = $("#txtQuickInsertSoggetto_CAP").val();
        var SiglaProvincia = $("#txtQuickInsertSoggetto_SiglaProvincia").val();
        var PEC = $("#txtQuickInsertSoggetto_PEC").val();

        var myObj = {
            "uid": EmptyUid,
            "descrizionereadonly": "",
            "piva": PIVA,
            "cf": CF,
            "ragionesociale": RagioneSociale,
            "sedelegaleindirizzo": Indirizzo,
            "sedelegalecap": CAP,
            "sedelegalelocalita": Localita,
            "sedelegaleprovincia": SiglaProvincia,
            "isannullato": false,
            "sedelegalestato": "",
            "nomeabituale": NomeAbituale,
            "sede2indirizzo": "",
            "sede2cap": "",
            "sede2localita": "",
            "sede2provincia": "",
            "sede2stato": "",
            "telefono1": "",
            "telefono2": "",
            "fax": "",
            "email": "",
            "pec": PEC,
            "note": "",
            "scontostandard": 0,
            "sitoweb": "",
            "livellointeressecrm": 0,
            "codiceunivocoipa": "",
            "ispareadonly": false
        };
        var myObjStringified = JSON.stringify(myObj);

        //var myNewCliente = new Entities.Soggetto;
        //myNewCliente.uid = EmptyUid;
        //myNewCliente.descrizionereadonly = "";
        //myNewCliente.ragionesociale = RagioneSociale;
        //myNewCliente.piva = PIVA;
        //myNewCliente.cf = CF;
        //myNewCliente.sedelegaleindirizzo = Indirizzo;
        //myNewCliente.sedelegalecap = CAP;
        //myNewCliente.sedelegalelocalita = Localita;
        //myNewCliente.sedelegaleprovincia = SiglaProvincia;
        //myNewCliente.sedelegalestato = "";
        //myNewCliente.isannullato = false;
        //myNewCliente.nomeabituale = NomeAbituale;
        //myNewCliente.sede2indirizzo = "";
        //myNewCliente.sede2cap = "";
        //myNewCliente.sede2localita = "";
        //myNewCliente.sede2provincia = "";
        //myNewCliente.sede2stato = "";
        //myNewCliente.telefono1 = "";
        //myNewCliente.telefono2 = "" ;
        //myNewCliente.fax = "";
        //myNewCliente.email = "";
        //myNewCliente.pec = PEC;
        //myNewCliente.note = "";
        //myNewCliente.scontostandard = 0;
        //myNewCliente.sitoweb = "";
        //myNewCliente.livellointeressecrm = 0;
        //myNewCliente.codiceunivocoipa = "";
        //myNewCliente.ispareadonly = "";

        //var myObjStringified = JSON.stringify(myNewCliente);

        $.ajax({
            crossDomain: true,
            type: 'POST',
            contentType: "application/json",
            url: myStorage.ApiUrl + '/Soggetto/insert',
            data: myObjStringified,
            beforeSend: function (xhdr) {
                xhdr.setRequestHeader("Authorization", "Bearer " + myStorage.token); //$("#token").val());
            }
        }).done(function (resp, statusText, xhdr) {

            var myResponse = $.parseJSON(resp);
            var success = myResponse.success; // = true;
            var errormessage = myResponse.errormessage; // = "OK";
            var errorcode = myResponse.errorcode; // = 0;
            var pagecount = myResponse.pagecount;

            if (success == true) {
                var myObj = $.parseJSON(myResponse.obj);
                popolaBoxDatiClienteSelected(myObj.uid);
                $('#myModalQuickInsertAnagraficaCliente').modal("hide");
            } else {
                alert("Login error; Message: " + errormessage + ";errorcode=" + errorcode);
            };

            AjaxMessageStop();

        }).fail(function (xhdr, statusText, errorText) {

            AjaxMessageStop();
            alert("err=" + errorText);
        });

    });

    function isValidFormQuickInsertSoggetto() {

        $("#boxMessageQuickInsertSoggetto").empty();

        if ($("#txtQuickInsertSoggetto_RagioneSociale").val() == "") {
            $("#boxMessageQuickInsertSoggetto").empty().append("inserisci la Ragione Sociale");
            return false;
        };
        //La PIVA se c'e' deve essere di 11 caratteri
        if ($("#txtQuickInsertSoggetto_PIVA").val() != "") {
            if ($("#txtQuickInsertSoggetto_PIVA").val().length != 11) {
                $("#boxMessageQuickInsertSoggetto").empty().append("La P.IVA, se presente, deve essere di 11 caratteri");
                return false;
            };
        };
        //if ($("#txtQuickInsertSoggetto_CF").val();
        //if ($("#txtQuickInsertSoggetto_Indirizzo").val();
        //if ($("#txtQuickInsertSoggetto_Localita").val();
        //if ($("#txtQuickInsertSoggetto_CAP").val();
        //if ($("#txtQuickInsertSoggetto_SiglaProvincia").val();
        if (isEmail($("#txtQuickInsertSoggetto_PEC").val()) == false) {
            $("#boxMessageQuickInsertSoggetto").empty().append("La PEC non sembra corretta");
            return false;
        };

        return true;
    };


    /* *******************************
        ARCHIVIO CLIENTI
    ********************************** */
    $("#btnOpenModalArchivioClienti").click(function () {
        $("#txtSearchArchivioClienti").val("");
        var strSearch = "";
        CurrentPageIndexOfArchivioClienti = 0;
        popolaTblArchivioClienti(CurrentPageIndexOfArchivioClienti, strSearch)
        $('#myModalArchivioClienti').modal("show");
    });
    $("#btnStartSearchArchivioClienti").click(function () {
        var strSearch = $("#txtSearchArchivioClienti").val();
        CurrentPageIndexOfArchivioClienti = 0;
        popolaTblArchivioClienti(CurrentPageIndexOfArchivioClienti, strSearch);
    });

    var CurrentPageIndexOfArchivioClienti = 0;
    var PageCountOfArchivioClienti = 0;
    function popolaTblArchivioClienti(CurrentPageIndex, strSearch) {

        CurrentPageIndexOfArchivioClienti = CurrentPageIndex;

        AjaxMessageStart();

        $.ajax({
            method: 'GET',
            url: myStorage.ApiUrl + '/Soggetto/list/CurrentPageIndex/' + CurrentPageIndex + '/strSearch/' + strSearch,
            beforeSend: function (xhdr) {
                xhdr.setRequestHeader("Authorization", "Bearer " + myStorage.token);
            }
        }).done(function (resp, statusText, xhdr) {

            var myResponse = $.parseJSON(resp);
            var success = myResponse.success; // = true;
            var errormessage = myResponse.errormessage; // = "OK";
            var errorcode = myResponse.errorcode; // = 0;
            var pagecount = myResponse.pagecount;

            if (success == true) {

                var collection = $.parseJSON(myResponse.obj);
                $("#tblArchivioClienti tbody").empty();
                $.each(collection, function (i, obj) {

                    var tr = '<tr>'
                        + '<td style="width:95%;">' + obj.descrizionereadonly + '</td>'
                        + '<td><button type="button" class="btn btn-primary btn-sm selezioneArchivioClienti" data-uid="' + obj.uid + '">seleziona</button></td>'
                        + '</tr>';
                    $("#tblArchivioClienti tbody").append(tr);

                });

                // PAGINAZIONE: STATO DEI BUTTONS
                PageCountOfArchivioClienti = pagecount;
                $("#btnPagingGoToFirst_ArchivioClienti").parent().removeClass("disabled");
                $("#btnPagingGoBack_ArchivioClienti").parent().removeClass("disabled");
                $("#btnPagingGoForward_ArchivioClienti").parent().removeClass("disabled");
                $("#btnPagingGoToLast_ArchivioClienti").parent().removeClass("disabled");
                if (CurrentPageIndexOfArchivioClienti == 0) {
                    $("#btnPagingGoToFirst_ArchivioClienti").parent().addClass("disabled");
                    $("#btnPagingGoBack_ArchivioClienti").parent().addClass("disabled");
                }
                if (CurrentPageIndexOfArchivioClienti == (pagecount - 1)) {
                    $("#btnPagingGoForward_ArchivioClienti").parent().addClass("disabled");
                    $("#btnPagingGoToLast_ArchivioClienti").parent().addClass("disabled");
                }

                $("#txtCurrentPageIndex_ArchivioClienti").text(CurrentPageIndexOfArchivioClienti + 1);
                $("#txtPageCount_ArchivioClienti").text(PageCountOfArchivioClienti);

            } else {
                alert("Login error; Message: " + errormessage + ";errorcode=" + errorcode);
            };

            AjaxMessageStop();

        }).fail(function (xhdr, statusText, errorText) {

            AjaxMessageStop();
            alert("err=" + errorText);

        });
    }

    $("#btnPagingGoToFirst_ArchivioClienti").click(function () {
        CurrentPageIndexOfArchivioClienti = 0;
        var strSearch = $("#txtSearchArchivioClienti").val();
        popolaTblArchivioClienti(CurrentPageIndexOfArchivioClienti, strSearch)
    });
    $("#btnPagingGoBack_ArchivioClienti").click(function () {
        CurrentPageIndexOfArchivioClienti -= 1;
        var strSearch = $("#txtSearchArchivioClienti").val();
        popolaTblArchivioClienti(CurrentPageIndexOfArchivioClienti, strSearch)
    });
    $("#btnPagingGoForward_ArchivioClienti").click(function () {
        CurrentPageIndexOfArchivioClienti += 1;
        if (PageCountOfArchivioClienti > 1) {
            if (CurrentPageIndexOfArchivioClienti >= (PageCountOfArchivioClienti - 1)) {
                CurrentPageIndexOfArchivioClienti = PageCountOfArchivioClienti - 1;
            }
        }
        var strSearch = $("#txtSearchArchivioClienti").val();
        popolaTblArchivioClienti(CurrentPageIndexOfArchivioClienti, strSearch)
    });
    $("#btnPagingGoToLast_ArchivioClienti").click(function () {
        CurrentPageIndexOfArchivioClienti = PageCountOfArchivioClienti - 1;
        var strSearch = $("#txtSearchArchivioClienti").val();
        popolaTblArchivioClienti(CurrentPageIndexOfArchivioClienti, strSearch)
    });


    $("#tblArchivioClienti").on("click", ".selezioneArchivioClienti", function () {
        var uid = $(this).data("uid");
        popolaBoxDatiClienteSelected(uid);
    });


    // SELEZIONA IL CLIENTE
    function popolaBoxDatiClienteSelected(uid) {

        AjaxMessageStart();

        $.ajax({
            method: 'GET',
            url: myStorage.ApiUrl + '/Soggetto/get/' + uid,
            beforeSend: function (xhdr) {
                xhdr.setRequestHeader("Authorization", "Bearer " + myStorage.token); //$("#token").val());
            }
        }).done(function (resp, statusText, xhdr) {

            var myResponse = $.parseJSON(resp);
            var success = myResponse.success; // = true;
            var errormessage = myResponse.errormessage; // = "OK";
            var errorcode = myResponse.errorcode; // = 0;
            var pagecount = myResponse.pagecount;

            if (success == true) {

                var myObj = $.parseJSON(myResponse.obj);
                myObjCliente = myObj;
                myObjFattura.uidsoggetto = myObjCliente.uid;

                $("#txtDatiClienteSelectedRiga1").empty().append(myObjCliente.ragionesociale);
                $("#txtDatiClienteSelectedRiga2").empty().append(myObjCliente.sedelegaleindirizzo);
                $("#txtDatiClienteSelectedRiga3").empty().append(myObjCliente.sedelegalecap + ' ' + myObjCliente.sedelegalelocalita + ' ' + myObjCliente.sedelegaleprovincia);
                $("#txtDatiClienteSelectedRiga4").empty().append('cf: ' + myObjCliente.cf);
                $("#txtDatiClienteSelectedRiga5").empty().append('p.iva: ' + myObjCliente.piva);
                if (myObjCliente.ispareadonly == true) {
                    $("#txtDatiClienteSelectedRiga6").empty().append('codice univoco: ' + myObjCliente.codiceunivocoipa);
                } else {
                    $("#txtDatiClienteSelectedRiga6").empty().append('pec: ' + myObjCliente.pec);
                }
                //VISUALIZZA IL BOX CON I DATI ANAGRAFICI DEL CLIENTE SELEZIONATO
                $("#boxDatiClienteSelected").show();
                //CHIUDE LE MODALI
                $('#myModalArchivioClienti').modal("hide");
                $('#myModalElencoPA').modal("hide");

            } else {
                alert("Login error; Message: " + errormessage + ";errorcode=" + errorcode);
            };

            AjaxMessageStop();

        }).fail(function (xhdr, statusText, errorText) {

            AjaxMessageStop();
            alert("err=" + errorText);

        });

    };



    /* ******************************
     PA
    ********************************* */
    $("#btnOpenModalElencoPA").click(function () {
        $("#txtSearchElencoPA").val("");
        var strSearch = "";
        CurrentPageIndexOfElencoPA = 0;
        popolaTblElencoPA(CurrentPageIndexOfElencoPA, strSearch)
        $('#myModalElencoPA').modal("show");
    });

    $("#btnStartSearchElencoPA").click(function () {
        var strSearch = $("#txtSearchElencoPA").val();
        CurrentPageIndexOfElencoPA = 0;
        popolaTblElencoPA(CurrentPageIndexOfElencoPA, strSearch);
    });

    var CurrentPageIndexOfElencoPA = 0;
    var PageCountOfElencoPA = 0;
    function popolaTblElencoPA(CurrentPageIndex, strSearch) {

        CurrentPageIndexOfElencoPA = CurrentPageIndex;

        AjaxMessageStart();

        $.ajax({
            method: 'GET',
            url: myStorage.ApiUrl + '/CodiceUfficioPA/list/CurrentPageIndex/' + CurrentPageIndex + '/strSearch/' + strSearch,
            beforeSend: function (xhdr) {
                xhdr.setRequestHeader("Authorization", "Bearer " + myStorage.token);
            }
        }).done(function (resp, statusText, xhdr) {

            var myResponse = $.parseJSON(resp);
            var success = myResponse.success; // = true;
            var errormessage = myResponse.errormessage; // = "OK";
            var errorcode = myResponse.errorcode; // = 0;
            var pagecount = myResponse.pagecount;

            if (success == true) {

                var collection = $.parseJSON(myResponse.obj);
                $("#tblElencoPA tbody").empty();
                $.each(collection, function (i, obj) {

                    var tr = '<tr>'
                        + '<td style="width:95%;">' + obj.descrizionereadonly + '</td>'
                        + '<td><button type="button" class="btn btn-primary btn-sm selezioneElencoPA" data-codiceunivocoente="' + obj.codiceufficio + '">seleziona</button></td>'
                        + '</tr>';
                    $("#tblElencoPA tbody").append(tr);

                });

                // PAGINAZIONE: STATO DEI BUTTONS
                PageCountOfElencoPA = pagecount;
                $("#btnPagingGoToFirst_ElencoPA").parent().removeClass("disabled");
                $("#btnPagingGoBack_ElencoPA").parent().removeClass("disabled");
                $("#btnPagingGoForward_ElencoPA").parent().removeClass("disabled");
                $("#btnPagingGoToLast_ElencoPA").parent().removeClass("disabled");
                if (CurrentPageIndexOfElencoPA == 0) {
                    $("#btnPagingGoToFirst_ElencoPA").parent().addClass("disabled");
                    $("#btnPagingGoBack_ElencoPA").parent().addClass("disabled");
                }
                if (CurrentPageIndexOfElencoPA == (pagecount - 1)) {
                    $("#btnPagingGoForward_ElencoPA").parent().addClass("disabled");
                    $("#btnPagingGoToLast_ElencoPA").parent().addClass("disabled");
                }

                $("#txtCurrentPageIndex_ElencoPA").text(CurrentPageIndexOfElencoPA + 1);
                $("#txtPageCount_ElencoPA").text(PageCountOfElencoPA);

            } else {
                alert("Login error; Message: " + errormessage + ";errorcode=" + errorcode);
            };

            AjaxMessageStop();

        }).fail(function (xhdr, statusText, errorText) {

            AjaxMessageStop();
            alert("err=" + errorText);

        });
    }

    $("#btnPagingGoToFirst_ElencoPA").click(function () {
        CurrentPageIndexOfElencoPA = 0;
        var strSearch = $("#txtSearchElencoPA").val();
        popolaTblElencoPA(CurrentPageIndexOfElencoPA, strSearch)
    });
    $("#btnPagingGoBack_ElencoPA").click(function () {
        CurrentPageIndexOfElencoPA -= 1;
        var strSearch = $("#txtSearchElencoPA").val();
        popolaTblElencoPA(CurrentPageIndexOfElencoPA, strSearch)
    });
    $("#btnPagingGoForward_ElencoPA").click(function () {
        CurrentPageIndexOfElencoPA += 1;
        if (PageCountOfElencoPA > 1) {
            if (CurrentPageIndexOfElencoPA >= (PageCountOfElencoPA - 1)) {
                CurrentPageIndexOfElencoPA = PageCountOfElencoPA - 1;
            }
        }
        var strSearch = $("#txtSearchElencoPA").val();
        popolaTblElencoPA(CurrentPageIndexOfElencoPA, strSearch)
    });
    $("#btnPagingGoToLast_ElencoPA").click(function () {
        CurrentPageIndexOfElencoPA = PageCountOfElencoPA - 1;
        var strSearch = $("#txtSearchElencoPA").val();
        popolaTblElencoPA(CurrentPageIndexOfElencoPA, strSearch)
    });


    $("#tblElencoPA").on("click", ".selezioneElencoPA", function () {

        // *************************************************************
        // 1) RICAVO IL SOGGETTO IN BASE AL CODICE UNIVOCO
        //    NOTA: SE NON PRESENTE IN ARCHIVIO CLIENTI VIENE CREATO SUL MOMENTO IN ANAGRAFICA CLIENTI
        //    CON I DATI PRESI DAL DATABASE DELL'AGENZIA ENTRATE
        // *************************************************************

        var codiceunivocoente = $(this).data("codiceunivocoente");

        AjaxMessageStart();

        $.ajax({
            method: 'GET',
            url: myStorage.ApiUrl + '/Soggetto/getByCodiceUnivocoPA/' + codiceunivocoente,
            beforeSend: function (xhdr) {
                xhdr.setRequestHeader("Authorization", "Bearer " + myStorage.token); //$("#token").val());
            }
        }).done(function (resp, statusText, xhdr) {

            var myResponse = $.parseJSON(resp);
            var success = myResponse.success; // = true;
            var errormessage = myResponse.errormessage; // = "OK";
            var errorcode = myResponse.errorcode; // = 0;
            var pagecount = myResponse.pagecount;

            if (success == true) {
                var objSoggetto = $.parseJSON(myResponse.obj);
                // 2) POPOLO I DATI DEL CLIENTE CON IL UID APPENA CREATO
                popolaBoxDatiClienteSelected(objSoggetto.uid);
            } else {
                alert("Login error; Message: " + errormessage + ";errorcode=" + errorcode);
            };

            AjaxMessageStop();

        }).fail(function (xhdr, statusText, errorText) {

            AjaxMessageStop();
            alert("err=" + errorText);

        });

    });




    /* *******************************
        ARCHIVIO ARTICOLI
    ********************************** */
    $("#btnOpenModalArchivioArticoli").click(function () {
        $("#txtSearchArchivioArticoli").val("");
        var strSearch = "";
        CurrentPageIndexOfArchivioArticoli = 0;
        popolaTblArchivioArticoli(CurrentPageIndexOfArchivioArticoli, strSearch)
        $('#myModalArchivioArticoli').modal("show");
    });
    $("#btnStartSearchArchivioArticoli").click(function () {
        var strSearch = $("#txtSearchArchivioArticoli").val();
        CurrentPageIndexOfArchivioArticoli = 0;
        popolaTblArchivioArticoli(CurrentPageIndexOfArchivioArticoli, strSearch);
    });

    var CurrentPageIndexOfArchivioArticoli = 0;
    var PageCountOfArchivioArticoli = 0;
    function popolaTblArchivioArticoli(CurrentPageIndex, strSearch) {

        CurrentPageIndexOfArchivioArticoli = CurrentPageIndex;

        AjaxMessageStart();

        $.ajax({
            method: 'GET',
            url: myStorage.ApiUrl + '/Articolo/list/CurrentPageIndex/' + CurrentPageIndex + '/strSearch/' + strSearch,
            beforeSend: function (xhdr) {
                xhdr.setRequestHeader("Authorization", "Bearer " + myStorage.token); //$("#token").val());
            }
        }).done(function (resp, statusText, xhdr) {

            var myResponse = $.parseJSON(resp);
            var success = myResponse.success; // = true;
            var errormessage = myResponse.errormessage; // = "OK";
            var errorcode = myResponse.errorcode; // = 0;
            var pagecount = myResponse.pagecount;

            if (success == true) {

                var collection = $.parseJSON(myResponse.obj);
                $("#tblArchivioArticoli tbody").empty();
                $.each(collection, function (i, obj) {

                    var tr = '<tr>'
                        + '<td style="width:95%;">' + obj.descrizionereadonly + '</td>'
                        + '<td><button type="button" class="btn btn-primary btn-sm selezioneArchivioArticoli" data-uid="' + obj.uid + '">seleziona</button></td>'
                        + '</tr>';
                    $("#tblArchivioArticoli tbody").append(tr);

                });

                // PAGINAZIONE: STATO DEI BUTTONS
                PageCountOfArchivioArticoli = pagecount;
                $("#btnPagingGoToFirst_ArchivioArticoli").parent().removeClass("disabled");
                $("#btnPagingGoBack_ArchivioArticoli").parent().removeClass("disabled");
                $("#btnPagingGoForward_ArchivioArticoli").parent().removeClass("disabled");
                $("#btnPagingGoToLast_ArchivioArticoli").parent().removeClass("disabled");
                if (CurrentPageIndexOfArchivioArticoli == 0) {
                    $("#btnPagingGoToFirst_ArchivioArticoli").parent().addClass("disabled");
                    $("#btnPagingGoBack_ArchivioArticoli").parent().addClass("disabled");
                }
                if (CurrentPageIndexOfArchivioArticoli == (pagecount - 1)) {
                    $("#btnPagingGoForward_ArchivioArticoli").parent().addClass("disabled");
                    $("#btnPagingGoToLast_ArchivioArticoli").parent().addClass("disabled");
                }

                $("#txtCurrentPageIndex_ArchivioArticoli").text(CurrentPageIndexOfArchivioArticoli + 1);
                $("#txtPageCount_ArchivioArticoli").text(PageCountOfArchivioArticoli);

            } else {
                alert("Login error; Message: " + errormessage + ";errorcode=" + errorcode);
            };

            AjaxMessageStop();

        }).fail(function (xhdr, statusText, errorText) {

            AjaxMessageStop();
            alert("err=" + errorText);

        });
    }

    $("#btnPagingGoToFirst_ArchivioArticoli").click(function () {
        CurrentPageIndexOfArchivioArticoli = 0;
        var strSearch = $("#txtSearchArchivioArticoli").val();
        popolaTblArchivioArticoli(CurrentPageIndexOfArchivioArticoli, strSearch)
    });
    $("#btnPagingGoBack_ArchivioArticoli").click(function () {
        CurrentPageIndexOfArchivioArticoli -= 1;
        var strSearch = $("#txtSearchArchivioArticoli").val();
        popolaTblArchivioArticoli(CurrentPageIndexOfArchivioArticoli, strSearch)
    });
    $("#btnPagingGoForward_ArchivioArticoli").click(function () {
        CurrentPageIndexOfArchivioArticoli += 1;
        if (PageCountOfArchivioArticoli > 1) {
            if (CurrentPageIndexOfArchivioArticoli >= (PageCountOfArchivioArticoli - 1)) {
                CurrentPageIndexOfArchivioArticoli = PageCountOfArchivioArticoli - 1;
            }
        }
        var strSearch = $("#txtSearchArchivioArticoli").val();
        popolaTblArchivioArticoli(CurrentPageIndexOfArchivioArticoli, strSearch)
    });
    $("#btnPagingGoToLast_ArchivioArticoli").click(function () {
        CurrentPageIndexOfArchivioArticoli = PageCountOfArchivioArticoli - 1;
        var strSearch = $("#txtSearchArchivioArticoli").val();
        popolaTblArchivioArticoli(CurrentPageIndexOfArchivioArticoli, strSearch)
    });


    $("#tblArchivioArticoli").on("click", ".selezioneArchivioArticoli", function () {
        var uid = $(this).data("uid");
        getArticolo(uid);
    });


    /* *******************************
        APERTURA MODAL TESTO LIBERO
    ********************************** */
    $("#btnOpenModalTestoLibero").click(function () {

        clearFormTestoLibero();
        //popolaDdlTestoLiberoAliquoteIVA();
        //popolaDdlTestoLiberoUDM();

        //POPOLO DDL UdM
        var optionsUdM = "";
        $.each(myStorage.udmcollection, function (i, obj) {
            optionsUdM += ($("<option />").val(obj.uid).text(obj.descrizionereadonly))[0].outerHTML;
        });
        optionsUdM += ($("<option />").val(EmptyUid).text("--seleziona--").attr('selected', 'selected'))[0].outerHTML;
        $('#ddlTestoLiberoUDM').empty().append(optionsUdM);

        //POPOLO DDL IVA
        var optionsIVA = "";
        $.each(myStorage.aliquotaivacollection, function (i, obj) {
            if (obj.isdefault == true) {
                optionsIVA += ($("<option />").val(obj.uid).text(obj.descrizionereadonly).attr('selected', 'selected'))[0].outerHTML;
            } else {
                optionsIVA += ($("<option />").val(obj.uid).text(obj.descrizionereadonly))[0].outerHTML;
            };
        });
        $('#ddlTestoLiberoAliquoteIVA').empty().append(optionsIVA);


        $('#myModalTestoLibero').modal("show");
    });

    function clearFormTestoLibero() {
        $('#txtTestoLiberoDescrizioneInFattura').val("");
        $('#txtTestoLiberoImportoUnitario').val("");
        //ddlTestoLiberoAliquoteIVA
        $('#txtTestoLiberoQuantita').val("");
        //ddlTestoLiberoUDM
    };


    $("#btnTestoLiberoInsert").click(function () {

        // CHECK VUOTO
        if ($('#txtTestoLiberoDescrizioneInFattura').val() == "") {
            $('#txtTestoLiberoDescrizioneInFattura').removeClass('is-invalid').addClass('is-invalid');
            return
        } else {
            $('#txtTestoLiberoDescrizioneInFattura').removeClass('is-invalid');
        };

        // CHECK VUOTO
        if ($('#txtTestoLiberoImportoUnitario').val() == "") {
            $('#txtTestoLiberoImportoUnitario').removeClass('is-invalid').addClass('is-invalid');
            return
        } else {

            // CHECK NUMERO VALIDO
            var _val = numberEngFormat($('#txtTestoLiberoImportoUnitario').val());
            if (isNaN(parseFloat(_val))) {
                $('#txtTestoLiberoDescrizioneInFattura').removeClass('is-invalid').addClass('is-invalid');
                return
            };

            $('#txtTestoLiberoImportoUnitario').removeClass('is-invalid');
        };


        // CHECK VUOTO
        if ($('#txtTestoLiberoQuantita').val() == "") {
            $('#txtTestoLiberoQuantita').removeClass('is-invalid').addClass('is-invalid');
            return
        } else {

            // CHECK NUMERO VALIDO
            var _val = numberEngFormat($('#txtTestoLiberoQuantita').val());
            if (isNaN(parseFloat(_val))) {
                $('#txtTestoLiberoQuantita').removeClass('is-invalid').addClass('is-invalid');
                return
            };

            $('#txtTestoLiberoQuantita').removeClass('is-invalid');
        };


        // CHECK SE SELEZIONATO
        if ($('#ddlTestoLiberoUDM').val() == EmptyUid) {
            $('#ddlTestoLiberoUDM').removeClass('is-invalid').addClass('is-invalid');
            return
        } else {
            $('#ddlTestoLiberoUDM').removeClass('is-invalid');
        };


        doRefreshInsertRigheFattura();

        var _myObjArticolo = new Entities.Articolo;
        _myObjArticolo.uid = EmptyUid;
        _myObjArticolo.codice = "";
        _myObjArticolo.descrizionebreve = "";
        _myObjArticolo.descrizioneestesa = "";
        _myObjArticolo.descrizioneinfattura = $('#txtTestoLiberoDescrizioneInFattura').val();
        _myObjArticolo.uidtipounitadimisura = $('#ddlTestoLiberoUDM').val();
        _myObjArticolo.prezzodivenditaattuale = numberEngFormat($('#txtTestoLiberoImportoUnitario').val());

        var _qta = numberEngFormat($('#txtTestoLiberoQuantita').val());
        var _uidAliquotaIVA = $('#ddlTestoLiberoAliquoteIVA').val();

        var rifDocumento = {
            'tipoDocumento': 'TESTOLIBERO'
        };
        addRigaFattura(_myObjArticolo, _uidAliquotaIVA, _qta, rifDocumento);

        $('#myModalTestoLibero').modal("hide");
    });


    function getArticolo(uid) {

        AjaxMessageStart();

        $.ajax({
            method: 'GET',
            url: myStorage.ApiUrl + '/Articolo/get/' + uid,
            beforeSend: function (xhdr) {
                xhdr.setRequestHeader("Authorization", "Bearer " + myStorage.token); //$("#token").val());
            }
        }).done(function (resp, statusText, xhdr) {

            var myResponse = $.parseJSON(resp);
            var success = myResponse.success; // = true;
            var errormessage = myResponse.errormessage; // = "OK";
            var errorcode = myResponse.errorcode; // = 0;
            var pagecount = myResponse.pagecount;

            if (success == true) {

                var myArticolo = $.parseJSON(myResponse.obj);
                doRefreshInsertRigheFattura();

                var _myObjArticolo = new Entities.Articolo;

                _myObjArticolo.uid = myArticolo.uid;
                _myObjArticolo.codice = myArticolo.codice;
                _myObjArticolo.descrizionebreve = myArticolo.descrizionebreve;
                _myObjArticolo.descrizioneestesa = myArticolo.descrizioneestesa;
                _myObjArticolo.descrizioneinfattura = myArticolo.descrizioneinfattura;
                _myObjArticolo.uidtipounitadimisura = myArticolo.uidtipounitadimisura;
                _myObjArticolo.prezzodivenditaattuale = myArticolo.prezzodivenditaattuale;

                //IVA DEFAULT 22
                var uidTipoAliquotaIVAdefault = EmptyUid;
                $.each(myStorage.aliquotaivacollection, function (i, obj) {
                    if (obj.isdefault == true) {
                        uidTipoAliquotaIVAdefault = obj.uid;
                    };
                });

                var rifDocumento = {
                    'tipoDocumento': 'TESTOLIBERO'
                };
                addRigaFattura(_myObjArticolo, uidTipoAliquotaIVAdefault, 1, rifDocumento);

                //CHIUDE LA MODALE
                $('#myModalArchivioArticoli').modal("hide");

            } else {
                alert("Login error; Message: " + errormessage + ";errorcode=" + errorcode);
            };

            AjaxMessageStop();

        }).fail(function (xhdr, statusText, errorText) {

            AjaxMessageStop();
            alert("err=" + errorText);

        });

    };

    // AGGIUNGE LA NUOVA RIGA DI FATTURA
    function addRigaFattura(myArticolo, uidTipoAliquotaIVA, qta, rifDocumento) {

        var myObjRigaFattura = new Entities.FatturaCliRiga;

        myObjRigaFattura.uidtemporaneo = getNewUid();
        myObjRigaFattura.uid = EmptyUid;
        myObjRigaFattura.descrizionereadonly = "";
        //myObjRigaFattura.descrizioneinfattura = myArticolo.descrizioneinfattura;

        myObjRigaFattura.quantita = qta;
        myObjRigaFattura.importounitario = parseFloat(myArticolo.prezzodivenditaattuale);
        myObjRigaFattura.uidtipoaliquotaiva = uidTipoAliquotaIVA;
        myObjRigaFattura.uidtipounitadimisura = myArticolo.uidtipounitadimisura;
        myObjRigaFattura.uidarticolo = myArticolo.uid;
        myObjRigaFattura.codicearticolo = myArticolo.codice;


        if (rifDocumento.tipoDocumento == 'DDT') {

            var _riferimentoDDT = ' (Rif. DDT n.' + rifDocumento.numeroDocumento + '/' + rifDocumento.annoDocumento + ' del ' + rifDocumento.descrDataDocumento + ')';
            myObjRigaFattura.descrizioneinfattura = myArticolo.descrizioneinfattura + _riferimentoDDT;
            myObjRigaFattura.uidddt = rifDocumento.uidDocumento;
            myObjRigaFattura.ddtnumerodescr = rifDocumento.numeroDocumento;
            myObjRigaFattura.ddtdatadescr = rifDocumento.descrDataDocumento;

            ////NELLE NOTE A FONDO DOCUMENTO EVITO DI RISCRIVERE 2 VOLTE QUESTO RIFERIMENTO AL DDT
            //if (myObjFattura.note.indexOf(_riferimentoDDT) !== -1) {
            //    myObjFattura.note += _riferimentoDDT;
            //};

        } else {

            myObjRigaFattura.descrizioneinfattura = myArticolo.descrizioneinfattura;
            myObjRigaFattura.uidddt = EmptyUid;
            myObjRigaFattura.ddtnumerodescr = '';
            myObjRigaFattura.ddtdatadescr = '';
        }

        myObjFattura.righe.push(myObjRigaFattura);

        popolaTblRigheFattura(myObjFattura.righe);

    };

    // AGGIUNGE LA RIGA DI FATTURA GIA' ESISTENTE
    //function addRigaFattura2(myRigaFattura) {

    //    var myObjRigaFattura = new Entities.FatturaCliRiga;

    //    myObjRigaFattura.uidtemporaneo = getNewUid();
    //    myObjRigaFattura.uid = myRigaFattura.uid;
    //    myObjRigaFattura.descrizionereadonly = myRigaFattura.descrizionereadonly;
    //    myObjRigaFattura.descrizioneinfattura = myRigaFattura.descrizioneinfattura;

    //    myObjRigaFattura.quantita = parseFloat(myRigaFattura.quantita);
    //    myObjRigaFattura.importounitario = parseFloat(myRigaFattura.importounitario);
    //    myObjRigaFattura.uidtipoaliquotaiva = myRigaFattura.uidtipoaliquotaiva;
    //    myObjRigaFattura.uidtipounitadimisura = myRigaFattura.uidtipounitadimisura;
    //    myObjRigaFattura.uidarticolo = myRigaFattura.uidarticolo;
    //    myObjRigaFattura.codicearticolo = myRigaFattura.codicearticolo;

    //    myObjRigaFattura.uidddt = myRigaFattura.uidddt;
    //    myObjRigaFattura.ddtnumerodescr = myRigaFattura.ddtnumerodescr;
    //    myObjRigaFattura.ddtdatadescr = myRigaFattura.ddtdatadescr;

    //    //  qui popolo solo le textbox; l'oggetto Model in memoria NON è ancora popolato
    //    //  e verrà popolato solo clikkando su ogni step
    //    //myObjFattura.righe.push(myObjRigaFattura);

    //    popolaTblRigheFattura(myObjFattura.righe);

    //};


    // ELIMINA RIGA DI FATTURA
    $("#tblRigheFattura").on("click", ".RigaFatturaRemoved", function () {
        doRefreshInsertRigheFattura();
        var uidRigaTemporaneo = $(this).data("uidtemporaneo");
        removeRigaFattura(uidRigaTemporaneo);
    });

    function removeRigaFattura(uidRigaTemporaneo) {

        var righeFatturaClone = myObjFattura.righe;
        myObjFattura.righe = [];
        $.each(righeFatturaClone, function (i, objRiga) {
            if (objRiga.uidtemporaneo != uidRigaTemporaneo) {
                myObjFattura.righe.push(objRiga);
            }
        });
        popolaTblRigheFattura(myObjFattura.righe);

    };

    function popolaTblRigheFattura(RigheFattura) {

        $("#tblRigheFattura tbody").empty();
        $.each(RigheFattura, function (i, objRiga) {


            //POPOLO DDL UdM
            var optionsUdM = "";
            $.each(myStorage.udmcollection, function (i, obj) {
                if (obj.uid == objRiga.uidtipounitadimisura) {
                    optionsUdM += ($("<option />").val(obj.uid).text(obj.descrizionereadonly).attr('selected', 'selected'))[0].outerHTML;
                } else {
                    optionsUdM += ($("<option />").val(obj.uid).text(obj.descrizionereadonly))[0].outerHTML;
                };
            });

            //POPOLO DDL IVA
            var optionsIVA = "";
            $.each(myStorage.aliquotaivacollection, function (i, obj) {
                if (obj.uid == objRiga.uidtipoaliquotaiva) {
                    optionsIVA += ($("<option />").val(obj.uid).text(obj.descrizionereadonly).attr('selected', 'selected'))[0].outerHTML;
                } else {
                    optionsIVA += ($("<option />").val(obj.uid).text(obj.descrizionereadonly))[0].outerHTML;
                };
            });


            //DEBUG
            //var a4 = Number(objRiga.importounitario).toLocaleString("it-IT", {minimumFractionDigits: 3});

            // ADD RIGA FATTURA
            var tr = '<tr>'
                + '<td>'
                + '     <input type="text" class="form-control CodiceArticolo" placeholder="opzionale" aria-label="Codice Articolo" value="' + objRiga.codicearticolo + '" />'
                + '     <input type="hidden" class="uidArticolo" value="' + objRiga.uidarticolo + '" />'
                + '</td>'
                + '<td>'
                + '    <select class="form-control ddlUdm">' + optionsUdM + '</select>'
                + '</td>'
                + '<td>'
                + '     <input type="text" class="form-control Qta" aria-label="Qta" style="text-align:right;" value="' + Number(objRiga.quantita).toLocaleString("it-IT", { minimumFractionDigits: 0, maximumFractionDigits: 4 }) + '" />'
                + '</td>'
                + '<td>'
                + '    <input type="text" class="form-control Prezzo" aria-label="Prezzo" style="text-align:right;" value="' + Number(objRiga.importounitario).toLocaleString("it-IT", { minimumFractionDigits: 2, maximumFractionDigits: 3 }) + '" />'
                + '</td>'
                + '<td>'
                + '    <select class="form-control ddlIVA">' + optionsIVA + '</select>'
                + '</td>'
                + '<td>'
                + '    <input type="text" class="form-control DescrizioneInFattura" aria-label="Descrizione" value="' + objRiga.descrizioneinfattura + '" />'
                + '</td>'
                + ' <td>'
                + '    <button class="btn btn-danger RigaFatturaRemoved" type="button" title="elimina riga" data-uidtemporaneo="' + objRiga.uidtemporaneo + '"><i class="far fa-trash-alt"></i></button>'
                + '</td>'
                + '</tr>';
            $("#tblRigheFattura tbody").append(tr);
        });

        formattaTextboxWithNumbers();
    };

    function doRefreshInsertRigheFattura() {

        var _isValid = true;
        $('#tblRigheFattura > tbody  > tr').each(function (i, objTableRow) {

            if (!$.isNumeric(numberEngFormat($(objTableRow).find("input.Qta").first().val()))) {
                openPopupMessage('error', "campo Quantita non valido");
                _isValid = false;
            };

            if (!$.isNumeric(numberEngFormat($(objTableRow).find("input.Prezzo").first().val())) & _isValid) {
                openPopupMessage('error', "campo Prezzo non valido");
                _isValid = false;
            };

            if ($(objTableRow).find("input.DescrizioneInFattura").first().val() == "" & _isValid) {
                openPopupMessage('error', "campo Descrizione vuoto");
                _isValid = false;
            };

        });

        // SOLO SE TUTTE LE RIGHE SONO VALIDATE
        // ALLORA FA IL REFRESH DEL MODEL CON GLI INPUT INSERITI DALL'UTENTE DIRETTAMENTE NELLE RIGHE FATTURA
        if (_isValid) {

            myObjFattura.righe = [];
            $('#tblRigheFattura > tbody  > tr').each(function (i, objTableRow) {

                var _uidtemporaneo = $(objTableRow).find("button").first().data("uidtemporaneo");

                var myObjRigaFattura = new Entities.FatturaCliRiga;
                myObjRigaFattura.uidtemporaneo = _uidtemporaneo;
                myObjRigaFattura.uid = EmptyUid;
                myObjRigaFattura.descrizionereadonly = "";
                myObjRigaFattura.descrizioneinfattura = $(objTableRow).find("input.DescrizioneInFattura").first().val();
                myObjRigaFattura.quantita = parseFloat(numberEngFormat($(objTableRow).find("input.Qta").first().val()));
                myObjRigaFattura.importounitario = parseFloat(numberEngFormat($(objTableRow).find("input.Prezzo").first().val()));
                myObjRigaFattura.uidtipoaliquotaiva = $(objTableRow).find("select.ddlIVA").first().val();
                myObjRigaFattura.uidtipounitadimisura = $(objTableRow).find("select.ddlUdm").first().val();
                myObjRigaFattura.uidarticolo = $(objTableRow).find("input.uidArticolo").first().val();
                myObjRigaFattura.codicearticolo = $(objTableRow).find("input.CodiceArticolo").first().val();

                //TO DO ?
                //myObjRigaFattura.uidddt = "";
                //myObjRigaFattura.ddtnumerodescr = "";
                //myObjRigaFattura.ddtdatadescr = "";

                myObjFattura.righe.push(myObjRigaFattura);
            });
        };

        return _isValid;
    };

    function PopolaDdlSezionali(collection) {
        $("#ddlSezionale").empty();
        $.each(collection, function (i, obj) {
            $("#ddlSezionale").append($("<option />").val(obj.uid).text(obj.descrizionereadonly));
        });
    };

    function popolaDdlTipoPagamento(collection) {
        $("#ddlTipoPagamento").empty();
        $.each(collection, function (i, obj) {
            $("#ddlTipoPagamento").append($("<option />").val(obj.uid).text(obj.descrizionereadonly));
        });
    };

    function popolaDdlCondizioniPagamento(collection) {
        $("#ddlCondizioniPagamento").empty();
        $.each(collection, function (i, obj) {
            $("#ddlCondizioniPagamento").append($("<option />").val(obj.uid).text(obj.descrizionereadonly));
        });
    };

    function popolaDdlCoordinateBancarie(collection) {
        $("#ddlCoordinateBancarie").empty();
        $.each(collection, function (i, obj) {
            $("#ddlCoordinateBancarie").append($("<option />").val(obj.uid).text(obj.descrizionereadonly));
        });
    };

    $('#ddlCoordinateBancarie').change(function () {
        $.each(myStorage.coordinatebancariecollection, function (i, obj) {
            if (obj.uid == $('#ddlCoordinateBancarie').val()) {
                $("#txtBancaIntestazioneCC").val(obj.intestazionecc);
                $("#txtBancaIBAN").val(obj.iban);
            };
        });
    });


    function popolaDdlAliquoteIVAsuContributoPrevidenzialeProfessionisti(collection) {
        $("#ddlAliquoteIVAsuContributoPrevidenzialeProfessionisti").empty();
        $.each(collection, function (i, obj) {
            $("#ddlAliquoteIVAsuContributoPrevidenzialeProfessionisti").append($("<option />").val(obj.uid).text(obj.descrizionereadonly));
        });
    };

    function PopolaCollections() {
        // ajax in cascata, ogni fnc richiama la successiva
        popolaSezionaleCollection();
        //Sezionale --> UdM --> AliquotaIVA
    };

    //var SezionaleCollection = [];
    function popolaSezionaleCollection() {

        // COLLECTION GIA' POPOLATA?
        if (myStorage.sezionalecollection.length > 0) {

            PopolaDdlSezionali(myStorage.sezionalecollection);
            // POPOLA IN CASCATA
            popolaUdMCollection();

        } else {

            AjaxMessageStart();

            $.ajax({
                method: 'GET',
                url: myStorage.ApiUrl + "/TipoSezionale/list",
                beforeSend: function (xhdr) {
                    xhdr.setRequestHeader("Authorization", "Bearer " + myStorage.token);
                }
            }).done(function (resp, statusText, xhdr) {


                var myResponse = $.parseJSON(resp);
                var success = myResponse.success; // = true;
                var errormessage = myResponse.errormessage; // = "OK";
                var errorcode = myResponse.errorcode; // = 0;
                var pagecount = myResponse.pagecount;

                if (success == true) {

                    var collection = $.parseJSON(myResponse.obj);

                    //$("#ddlSezionale").empty();
                    //$.each(collection, function (i, obj) {
                    //    $("#ddlSezionale").append($("<option />").val(obj.uid).text(obj.descrizionereadonly));
                    //});
                    myStorage.sezionalecollection = [];
                    $.each(collection, function (i, obj) {
                        var myitem = {
                            'uid': obj.uid,
                            'descrizionereadonly': obj.descrizionereadonly
                        };
                        //SezionaleCollection.push(myitem);
                        myStorage.sezionalecollection.push(myitem)
                    });
                    PopolaDdlSezionali(myStorage.sezionalecollection);

                    // POPOLA IN CASCATA
                    popolaUdMCollection();

                } else {
                    alert("error; Message: " + errormessage + ";errorcode=" + errorcode);
                };

                //AjaxMessageStop();

            }).fail(function (xhdr, statusText, errorText) {

                AjaxMessageStop();
                alert("err=" + errorText);

            });

        };
    }

    //var UdMCollection = [];
    function popolaUdMCollection() {

        // COLLECTION GIA' POPOLATA?
        if (myStorage.udmcollection.length > 0) {

            // POPOLA IN CASCATA
            popolaAliquotaIVACollection();

        } else {

            AjaxMessageStart();

            $.ajax({
                method: 'GET',
                url: myStorage.ApiUrl + '/TipoUnitaDiMisura/list',
                beforeSend: function (xhdr) {
                    xhdr.setRequestHeader("Authorization", "Bearer " + myStorage.token);
                }
            }).done(function (resp, statusText, xhdr) {

                var myResponse = $.parseJSON(resp);
                var success = myResponse.success; // = true;
                var errormessage = myResponse.errormessage; // = "OK";
                var errorcode = myResponse.errorcode; // = 0;
                var pagecount = myResponse.pagecount;

                if (success == true) {

                    var collection = $.parseJSON(myResponse.obj);
                    myStorage.udmcollection = [];
                    $.each(collection, function (i, obj) {

                        var myitem = {
                            'uid': obj.uid,
                            'descrizionereadonly': obj.descrizionereadonly,
                            'descrizione': obj.descrizione,
                            'isannullato': obj.isannullato
                        };
                        //UdMCollection.push(myitem);
                        myStorage.udmcollection.push(myitem)
                    });

                    //POPOLA IN CASCATA
                    popolaAliquotaIVACollection();

                } else {
                    alert("error; Message: " + errormessage + ";errorcode=" + errorcode);
                };

                //AjaxMessageStop();

            }).fail(function (xhdr, statusText, errorText) {

                AjaxMessageStop();
                alert("err=" + errorText);

            });

        };
    };

    //var AliquotaIVACollection = [];
    function popolaAliquotaIVACollection() {

        // COLLECTION GIA' POPOLATA?
        if (myStorage.aliquotaivacollection.length > 0) {

            popolaDdlAliquoteIVAsuContributoPrevidenzialeProfessionisti(myStorage.aliquotaivacollection);

            //POPOLA IN CASCATA
            popolaTipoPagamentoCollection();

        } else {

            AjaxMessageStart();

            $.ajax({
                method: 'GET',
                url: myStorage.ApiUrl + '/TipoAliquotaIVA/list',
                beforeSend: function (xhdr) {
                    xhdr.setRequestHeader("Authorization", "Bearer " + myStorage.token);
                }
            }).done(function (resp, statusText, xhdr) {

                var myResponse = $.parseJSON(resp);
                var success = myResponse.success; // = true;
                var errormessage = myResponse.errormessage; // = "OK";
                var errorcode = myResponse.errorcode; // = 0;
                var pagecount = myResponse.pagecount;

                if (success == true) {

                    var collection = $.parseJSON(myResponse.obj);
                    myStorage.aliquotaivacollection = [];
                    $.each(collection, function (i, obj) {

                        var myitem = {
                            'uid': obj.uid,
                            'descrizionereadonly': obj.descrizionereadonly,
                            'descrizione': obj.descrizione,
                            'isannullato': obj.isannullato,
                            'percaliquotaiva': obj.percaliquotaiva,
                            'isdefault': obj.isdefault,
                            'codicenatura': obj.codicenatura,
                            'codiceiva': obj.codiceiva
                        };
                        myStorage.aliquotaivacollection.push(myitem);
                    });

                    //Default
                    var myitemDefault = {
                        'uid': EmptyUid,
                        'descrizionereadonly': '-- seleziona --',
                        'descrizione': '-- seleziona --',
                        'isannullato': false,
                        'percaliquotaiva': 0,
                        'isdefault': false,
                        'codicenatura': '',
                        'codiceiva': ''
                    };
                    myStorage.aliquotaivacollection.push(myitemDefault);

                    popolaDdlAliquoteIVAsuContributoPrevidenzialeProfessionisti(myStorage.aliquotaivacollection);

                    //POPOLA IN CASCATA
                    popolaTipoPagamentoCollection();

                } else {
                    alert("error; Message: " + errormessage + ";errorcode=" + errorcode);
                };

                //AjaxMessageStop();

            }).fail(function (xhdr, statusText, errorText) {

                AjaxMessageStop();
                alert("err=" + errorText);

            });
        };
    };

    function popolaTipoPagamentoCollection() {

        // COLLECTION GIA' POPOLATA?
        if (myStorage.tipopagamentocollection.length > 0) {

            popolaDdlTipoPagamento(myStorage.tipopagamentocollection);

            //POPOLA IN CASCATA
            popolaCondizioniPagamentoCollection();

        } else {

            AjaxMessageStart();

            $.ajax({
                method: 'GET',
                url: myStorage.ApiUrl + '/TipoPagamento/list',
                beforeSend: function (xhdr) {
                    xhdr.setRequestHeader("Authorization", "Bearer " + myStorage.token);
                }
            }).done(function (resp, statusText, xhdr) {

                var myResponse = $.parseJSON(resp);
                var success = myResponse.success; // = true;
                var errormessage = myResponse.errormessage; // = "OK";
                var errorcode = myResponse.errorcode; // = 0;
                var pagecount = myResponse.pagecount;

                if (success == true) {

                    var collection = $.parseJSON(myResponse.obj);
                    myStorage.tipopagamentocollection = [];
                    $.each(collection, function (i, obj) {

                        var myitem = {
                            'uid': obj.uid,
                            'descrizionereadonly': obj.descrizionereadonly,
                            'descrizione': obj.descrizione,
                            'codice': obj.codice
                        };
                        myStorage.tipopagamentocollection.push(myitem)
                    });
                    //Default item
                    var myDefaultItem = {
                        'uid': EmptyUid,
                        'descrizionereadonly': "--seleziona--",
                        'descrizione': "",
                        'codice': ""
                    };
                    myStorage.tipopagamentocollection.push(myDefaultItem);
                    popolaDdlTipoPagamento(myStorage.tipopagamentocollection);

                    //POPOLA IN CASCATA
                    popolaCondizioniPagamentoCollection();

                } else {
                    alert("error; Message: " + errormessage + ";errorcode=" + errorcode);
                };

                //AjaxMessageStop();

            }).fail(function (xhdr, statusText, errorText) {

                AjaxMessageStop();
                alert("err=" + errorText);

            });
        };
    };

    function popolaCondizioniPagamentoCollection() {

        // COLLECTION GIA' POPOLATA?
        if (myStorage.condizionipagamentocollection.length > 0) {

            popolaDdlCondizioniPagamento(myStorage.condizionipagamentocollection);

            //POPOLA IN CASCATA
            popolaCoordinateBancarieCollection();

        } else {

            AjaxMessageStart();

            $.ajax({
                method: 'GET',
                url: myStorage.ApiUrl + '/TipoCondizionePagamento/list',
                beforeSend: function (xhdr) {
                    xhdr.setRequestHeader("Authorization", "Bearer " + myStorage.token);
                }
            }).done(function (resp, statusText, xhdr) {

                var myResponse = $.parseJSON(resp);
                var success = myResponse.success; // = true;
                var errormessage = myResponse.errormessage; // = "OK";
                var errorcode = myResponse.errorcode; // = 0;
                var pagecount = myResponse.pagecount;

                if (success == true) {

                    var collection = $.parseJSON(myResponse.obj);
                    myStorage.condizionipagamentocollection = [];
                    $.each(collection, function (i, obj) {

                        var myitem = {
                            'uid': obj.uid,
                            'descrizionereadonly': obj.descrizionereadonly,
                            'descrizione': obj.descrizione,
                            'codice': obj.codice,
                            'isannullato': obj.isannullato
                        };
                        myStorage.condizionipagamentocollection.push(myitem)
                    });
                    //Default item
                    var myDefaultItem = {
                        'uid': EmptyUid,
                        'descrizionereadonly': "--seleziona--",
                        'descrizione': "",
                        'codice': "",
                        'isannullato': false
                    };
                    myStorage.condizionipagamentocollection.push(myDefaultItem);
                    popolaDdlCondizioniPagamento(myStorage.condizionipagamentocollection);

                    //POPOLA IN CASCATA
                    popolaCoordinateBancarieCollection();

                } else {
                    alert("error; Message: " + errormessage + ";errorcode=" + errorcode);
                };

                //AjaxMessageStop();

            }).fail(function (xhdr, statusText, errorText) {

                AjaxMessageStop();
                alert("err=" + errorText);

            });
        };
    };

    function popolaCoordinateBancarieCollection() {

        // COLLECTION GIA' POPOLATA?
        if (myStorage.coordinatebancariecollection.length > 0) {

            popolaDdlCoordinateBancarie(myStorage.coordinatebancariecollection);

            // POPOLA IN CASCATA
            popolaEsigibilitaIVA();

        } else {

            AjaxMessageStart();

            $.ajax({
                method: 'GET',
                url: myStorage.ApiUrl + '/TipoCoordinateBancarie/list',
                beforeSend: function (xhdr) {
                    xhdr.setRequestHeader("Authorization", "Bearer " + myStorage.token);
                }
            }).done(function (resp, statusText, xhdr) {

                var myResponse = $.parseJSON(resp);
                var success = myResponse.success; // = true;
                var errormessage = myResponse.errormessage; // = "OK";
                var errorcode = myResponse.errorcode; // = 0;
                var pagecount = myResponse.pagecount;

                if (success == true) {

                    var collection = $.parseJSON(myResponse.obj);
                    myStorage.coordinatebancariecollection = [];
                    $.each(collection, function (i, obj) {

                        var myitem = {
                            'uid': obj.uid,
                            'descrizionereadonly': obj.descrizionereadonly,
                            'descrizione': obj.descrizione,
                            'iban': obj.iban,
                            'isannullato': obj.isannullato,
                            'intestazionecc': obj.intestazionecc
                        };
                        myStorage.coordinatebancariecollection.push(myitem);
                    });
                    //DEFAULT
                    var myitemDefault = {
                        'uid': EmptyUid,
                        'descrizionereadonly': '-- seleziona --',
                        'descrizione': '-- seleziona --',
                        'iban': '',
                        'isannullato': false,
                        'intestazionecc': ''
                    };
                    myStorage.coordinatebancariecollection.push(myitemDefault);

                    popolaDdlCoordinateBancarie(myStorage.coordinatebancariecollection);

                    // POPOLA IN CASCATA
                    popolaEsigibilitaIVA();

                } else {
                    alert("error; Message: " + errormessage + ";errorcode=" + errorcode);
                };

                //AjaxMessageStop();

            }).fail(function (xhdr, statusText, errorText) {

                AjaxMessageStop();
                alert("err=" + errorText);

            });
        };
    };

    function popolaEsigibilitaIVA() {

        AjaxMessageStart();

        $.ajax({
            method: 'GET',
            url: myStorage.ApiUrl + '/TipoEsigibilitaIVA/list',
            beforeSend: function (xhdr) {
                xhdr.setRequestHeader("Authorization", "Bearer " + myStorage.token);
            }
        }).done(function (resp, statusText, xhdr) {

            var myResponse = $.parseJSON(resp);
            var success = myResponse.success; // = true;
            var errormessage = myResponse.errormessage; // = "OK";
            var errorcode = myResponse.errorcode; // = 0;
            var pagecount = myResponse.pagecount;

            if (success == true) {

                var collection = $.parseJSON(myResponse.obj);
                var _collectionTemp = [];
                $.each(collection, function (i, obj) {

                    var myitem = {
                        'uid': obj.uid,
                        'descrizionereadonly': obj.descrizionereadonly,
                        'descrizione': obj.descrizione,
                        'codice': obj.codice
                    };
                    _collectionTemp.push(myitem);
                });
                //DEFAULT
                var myitemDefault = {
                    'uid': EmptyUid,
                    'descrizionereadonly': '-- seleziona --',
                    'descrizione': '-- seleziona --',
                    'codice': ''
                };
                $("#ddlEsigibilitaIVA").empty();
                $.each(_collectionTemp, function (i, obj) {
                    $("#ddlEsigibilitaIVA").append($("<option />").val(obj.uid).text(obj.descrizionereadonly));
                });


                // POPOLA IN CASCATA
                popolaAzienda();

            } else {
                alert("error; Message: " + errormessage + ";errorcode=" + errorcode);
            };
            //AjaxMessageStop();

        }).fail(function (xhdr, statusText, errorText) {

            AjaxMessageStop();
            alert("err=" + errorText);

        });

    }


    function popolaAzienda() {

        // COLLECTION GIA' POPOLATA?
        if (myStorage.azienda.length > 0) {

            // POPOLA IN CASCATA
            popolaDocumento();

        } else {

            AjaxMessageStart();

            $.ajax({
                method: 'GET',
                url: myStorage.ApiUrl + '/Azienda/get',
                beforeSend: function (xhdr) {
                    xhdr.setRequestHeader("Authorization", "Bearer " + myStorage.token);
                }
            }).done(function (resp, statusText, xhdr) {

                var myResponse = $.parseJSON(resp);
                var success = myResponse.success; // = true;
                var errormessage = myResponse.errormessage; // = "OK";
                var errorcode = myResponse.errorcode; // = 0;
                var pagecount = myResponse.pagecount;

                if (success == true) {

                    var obj = $.parseJSON(myResponse.obj);
                    myStorage.azienda = {
                        'uid': obj.uid,
                        'descrizionereadonly': obj.descrizionereadonly,
                        'piva': obj.piva,
                        'cf': obj.cf,
                        'ragionesociale': obj.ragionesociale,
                        'email': obj.email,
                        'pec': obj.pec,
                        'isdefaultfatturaconritenuta': obj.isdefaultfatturaconritenuta,
                        'isiscrittoalboprofessionale': obj.isiscrittoalboprofessionale,
                        //'isvisibleinstampaparcella': obj.isvisibleinstampaparcella,
                        'titolarenome': obj.titolarenome,
                        'titolarecognome': obj.titolarecognome,
                        //titolarecodicefiscale
                        'perccontributoprevidenzialeprofessionisti': obj.perccontributoprevidenzialeprofessionisti,
                        'percritenutaaccontoprofessionisti': obj.percritenutaaccontoprofessionisti
                    };

                    // POPOLA IN CASCATA
                    popolaDocumento();

                } else {
                    alert("error; Message: " + errormessage + ";errorcode=" + errorcode);
                };
                //AjaxMessageStop();

            }).fail(function (xhdr, statusText, errorText) {

                AjaxMessageStop();
                alert("err=" + errorText);

            });
        };
    };


    function popolaDocumento() {

        // ***************************************************
        //  NUOVA FATTURA ? uid=EmptyUid oppure null
        // ***************************************************
        if (getUrlParams("uid") == null | getUrlParams("uid") == EmptyUid) {

            //RICAVO VALORI DEFAULT X NUOVO DOCUMENTO
            var _uidTipoAliquotaIVAdefault = EmptyUid;
            //var _percTipoAliquotaIVAdefault = 0;
            $.each(myStorage.aliquotaivacollection, function (i, obj) {
                if (obj.isdefault) {
                    _uidTipoAliquotaIVAdefault = obj.uid;
                    //_percTipoAliquotaIVAdefault = obj.percaliquotaiva;
                };
            });

            //RICAVO VALORI DEFAULT PRESI DA AZIENDA
            var _PercContributoPrevidenziale = myStorage.azienda.perccontributoprevidenzialeprofessionisti;
            var _PercRitenutaAcconto = myStorage.azienda.percritenutaaccontoprofessionisti; //zero default
            var _cognomeprofessionista = myStorage.azienda.titolarecognome;
            var _nomeprofessionista = myStorage.azienda.titolarenome;

            if (myStorage.azienda.isdefaultfatturaconritenuta == false) {
                _cognomeprofessionista = "";
                _nomeprofessionista = "";
            };

            // default per nuova fattura: B2B
            var _uidtipoesigibilitaiva = "00000000-0000-0000-0000-000000000001"; //"[I]: IVA ad esigibilita immediata";


            // *******************************************************
            // NUOVA FATTURA --> Set valori default per fattura vuota
            // *******************************************************
            myObjFattura.uid = EmptyUid;
            myObjFattura.descrizionereadonly = "";
            myObjFattura.uidtipofatturacliente = "00000000-0000-0000-0000-000000000001";
            myObjFattura.uidtipoformatotrasmissione = "00000000-0000-0000-0000-000000000001";
            myObjFattura.numero = -1;
            myObjFattura.uidtiposezionale = "00000000-0000-0000-0000-000000000001";
            myObjFattura.codicesezionalereadonly = "";

            myObjFattura.datadocumentoaa = 1;
            myObjFattura.datadocumentomm = 1;
            myObjFattura.datadocumentogg = 1;

            myObjFattura.uidsoggetto = EmptyUid;
            myObjFattura.uidtipopagamento = "00000000-0000-0000-0000-000000000002";
            myObjFattura.uidtipocondizionepagamento = EmptyUid;
            myObjFattura.uidtipocoordinatebancarie = EmptyUid;
            myObjFattura.uidtipoesigibilitaiva = _uidtipoesigibilitaiva;

            myObjFattura.datascadenzapagamentoaa = 1;
            myObjFattura.datascadenzapagamentomm = 1;
            myObjFattura.datascadenzapagamentogg = 1;

            myObjFattura.perccontributoprevidenziale = _PercContributoPrevidenziale;
            myObjFattura.uidtipoaliquotaivasucontributoprevidenziale = _uidTipoAliquotaIVAdefault;
            myObjFattura.percritenutaacconto = _PercRitenutaAcconto;
            myObjFattura.importospeseanticipoprofessionistiart15 = 0;

            myObjFattura.opzionalepa_ordinediacquisto_numeroordine = "";

            myObjFattura.opzionalepa_ordinediacquisto_datacontrattoaa = 1;
            myObjFattura.opzionalepa_ordinediacquisto_datacontrattomm = 1;
            myObjFattura.opzionalepa_ordinediacquisto_datacontrattogg = 1;

            myObjFattura.opzionalepa_ordinediacquisto_codicecup = "";
            myObjFattura.opzionalepa_ordinediacquisto_codicecig = "";
            myObjFattura.opzionalepa_ordinediacquisto_codicecommessaconvenzione = "";
            myObjFattura.opzionalepa_daticontratto_numerocontratto = "";

            myObjFattura.opzionalepa_daticontratto_datacontrattoaa = 1;
            myObjFattura.opzionalepa_daticontratto_datacontrattomm = 1;
            myObjFattura.opzionalepa_daticontratto_datacontrattogg = 1;

            myObjFattura.opzionalepa_daticontratto_codicecup = "";
            myObjFattura.opzionalepa_daticontratto_codicecig = "";
            myObjFattura.opzionalepa_daticontratto_codicecommessaconvenzione = "";
            myObjFattura.opzionalepa_datisal_riferimentofase = "";
            myObjFattura.opzionalepa_riferimentonormativo = "";
            myObjFattura.opzionalepa_riferimentoamministrazione = "";
            myObjFattura.opzionalepa_importobollo = 0;
            myObjFattura.opzionalepa_importobollo_addebitoalcliente = false;
            myObjFattura.opzionalepa_visualizzacognomeprofessionista = _cognomeprofessionista;
            myObjFattura.opzionalepa_visualizzanomeprofessionista = _nomeprofessionista;
            myObjFattura.righe = [];
            myObjFattura.allegaticollection = [];


            // POPOLA IN CASCATA
            // ULTIMO
            SetDefaultValues(myObjFattura);

        } else {

            // ***************************************************
            // EDIT FATTURA --> Set valori presi dalla fattura get
            // ***************************************************

            var uidDocumento = EmptyUid;
            if (isGuid(getUrlParams("uid"))) {
                uidDocumento = getUrlParams("uid");
            };

            AjaxMessageStart();

            $.ajax({
                method: 'GET',
                url: myStorage.ApiUrl + '/FatturaCliente/get/' + uidDocumento,
                beforeSend: function (xhdr) {
                    xhdr.setRequestHeader("Authorization", "Bearer " + myStorage.token);
                }
            }).done(function (resp, statusText, xhdr) {

                var myResponse = $.parseJSON(resp);
                var success = myResponse.success; // = true;
                var errormessage = myResponse.errormessage; // = "OK";
                var errorcode = myResponse.errorcode; // = 0;
                var pagecount = myResponse.pagecount;

                if (success == true) {

                    myObjFattura = $.parseJSON(myResponse.obj);

                    // POPOLA IN CASCATA
                    // ULTIMO
                    SetDefaultValues(myObjFattura);

                } else {
                    var _uidoperazione = myResponse.uidoperazione;
                    alert("error; Message: " + errormessage + ";errorcode=" + errorcode + ";uidoperazione=" + _uidoperazione);
                };

                //AjaxMessageStop();

            }).fail(function (xhdr, statusText, errorText) {

                AjaxMessageStop();
                alert("err=" + errorText);

            });

        };


    };

    function SetDefaultValues(myDocumento) {

        isDoneCaricamentoIniziale_Step0 = true;

        // *****************************************
        // Stato degli oggetti maschera all'apertura
        // *****************************************
        $("[name=radioTipiDocumento]").val([myDocumento.uidtipofatturacliente]);

        if (myDocumento.datadocumentoaa == 1) {
            $("#txtDataDocumento").val(moment(new Date()).format("DD/MM/YYYY"));
        } else {
            $("#txtDataDocumento").val(moment(new Date(myDocumento.datadocumentoaa, myDocumento.datadocumentomm - 1, myDocumento.datadocumentogg)).format("DD/MM/YYYY"));
        };
        if (myDocumento.numero == -1) {
            //numerazione auto
            $("[name=radioNumerazioneDocumento]").val(["a"]);
            $('#collapsableNumeroDocumento').collapse('hide');
        } else {
            //numerazione manuale
            $("[name=radioNumerazioneDocumento]").val(["m"]);
            $('#collapsableNumeroDocumento').collapse('show');
            $('#txtNumeroDocumento').val(myDocumento.numero);
        };

        //if (myDocumento.codicesezionalereadonly == "") {
        if (myDocumento.uidtiposezionale == "00000000-0000-0000-0000-000000000001") {
            // NO SEZIONALE
            $("[name=radioSezionale]").val(["n"]);
            $('#collapsableSezionale').collapse('hide');
            //assegno il sezionale VUOTO con uid=00000000-0000-0000-0000-000000000001 ARBITRARIO (é VUOTO MA E' UN SEZIONALE)
            $('#ddlSezionale').val('00000000-0000-0000-0000-000000000001');
        } else {
            // SI' SEZIONALE
            $("[name=radioSezionale]").val(["s"]);
            $('#collapsableSezionale').collapse('show');
            $('#ddlSezionale').val(myDocumento.uidtiposezionale);
        };


        if (myDocumento.uidsoggetto == EmptyUid) {

            myObjCliente.uid = EmptyUid;
            myObjCliente.ragionesociale = "";
            myObjCliente.codiceunivocoipa = "";
            myObjCliente.ispareadonly = false;

            $("#boxDatiClienteSelected").hide();
        } else {

            // POPOLA BOX DATI CLIENTE E VALORIZZA myObjCliente
            popolaBoxDatiClienteSelected(myDocumento.uidsoggetto);

            if (myDocumento.uidtipoformatotrasmissione == "00000000-0000-0000-0000-000000000001") {
                // fatturaPA
                $('#tabSelezioneClientePA').tab('show');
            } else {
                // fatturaB2B
                $('#tabSelezioneClienteDitta').tab('show');
            };

        };

        //RIGHE FATTURA
        var tempRigheCollection = [];
        $.each(myDocumento.righe, function (i, obj) {

            var myObjRigaFattura = new Entities.FatturaCliRiga;

            myObjRigaFattura.uidtemporaneo = getNewUid();
            myObjRigaFattura.uid = obj.uid;
            myObjRigaFattura.descrizionereadonly = obj.descrizionereadonly;
            myObjRigaFattura.descrizioneinfattura = obj.descrizioneinfattura;

            myObjRigaFattura.quantita = parseFloat(obj.quantita);
            myObjRigaFattura.importounitario = parseFloat(obj.importounitario);
            myObjRigaFattura.uidtipoaliquotaiva = obj.uidtipoaliquotaiva;
            myObjRigaFattura.uidtipounitadimisura = obj.uidtipounitadimisura;
            myObjRigaFattura.uidarticolo = obj.uidarticolo;
            myObjRigaFattura.codicearticolo = obj.codicearticolo;

            myObjRigaFattura.uidddt = obj.uidddt;
            myObjRigaFattura.ddtnumerodescr = obj.ddtnumerodescr;
            myObjRigaFattura.ddtdatadescr = obj.ddtdatadescr;

            //  qui popolo solo le textbox; l'oggetto Model in memoria NON è ancora popolato
            //  e verrà popolato solo clikkando su ogni step dall'utente
            //myDocumento.righe.push(myObjRigaFattura);
            tempRigheCollection.push(myObjRigaFattura);
        });
        popolaTblRigheFattura(tempRigheCollection);


        //INFO ACCESSORIE
        $("#ddlTipoPagamento").val(myDocumento.uidtipopagamento);

        if (myDocumento.datascadenzapagamentoaa == 1) {
            $("#txtTipoPagamento_DataScadenzaPagamento").val("");
        } else {
            $("#txtTipoPagamento_DataScadenzaPagamento").val(moment(new Date(myDocumento.datascadenzapagamentoaa, myDocumento.datascadenzapagamentomm - 1, myDocumento.datascadenzapagamentogg)).format("DD/MM/YYYY"));
        };

        $("#ddlCondizioniPagamento").val(myDocumento.uidtipocondizionepagamento);

        //BANCA
        $("#txtBancaIntestazioneCC").val("");
        $("#txtBancaIBAN").val("");
        $("#ddlCoordinateBancarie").val(myDocumento.uidtipocoordinatebancarie);
        $.each(myStorage.coordinatebancariecollection, function (i, obj) {
            if (obj.uid == myDocumento.uidtipocoordinatebancarie) {
                $("#txtBancaIntestazioneCC").val(obj.intestazionecc);
                $("#txtBancaIBAN").val(obj.iban);
            }
        });

        // CAMPI RITENUTA
        $("#txtPercContributoPrevidenzialeProfessionisti").val(Number(parseFloat(myDocumento.perccontributoprevidenziale)).toLocaleString("it-IT", { minimumFractionDigits: 0, maximumFractionDigits: 2 }));
        $("#ddlAliquoteIVAsuContributoPrevidenzialeProfessionisti").val(myDocumento.uidtipoaliquotaivasucontributoprevidenziale);
        //$("#txtPercIVAsuContributoPrevidenzialeProfessionisti").val(percTipoAliquotaIVAdefault);
        $("#txtPercRitenutaAccontoProfessionisti").val(Number(parseFloat(myDocumento.percritenutaacconto)).toLocaleString("it-IT", { minimumFractionDigits: 0, maximumFractionDigits: 2 }));

        // DEFAULT NON VISIBILI
        // VISIBILI SE SONO PROFESSIONISTA CON RITENUTA OPPURE SE COMUNQUE NELLA FATTURA C'E' LA RITENUTA
        // SE SONO PROFESSIONISTA CON RITENUTA OPPURE SE COMUNQUE NELLA FATTURA C'E' LA RITENUTA
        if (myStorage.azienda.isdefaultfatturaconritenuta == true | myDocumento.percritenutaacconto > 0) {
            $('#chkRitenuta').prop('checked', true);
            $('#collapsableRitenuta').collapse('show');
        } else {
            $('#chkRitenuta').prop('checked', false);
            $('#collapsableRitenuta').collapse('hide');
        };

        // Spese Anticipo ART.15
        $('#txtImportoSpeseAnticipoProfessionistiART15').val(Number(parseFloat(myDocumento.importospeseanticipoprofessionistiart15)).toLocaleString("it-IT", { minimumFractionDigits: 2, maximumFractionDigits: 3 }));
        if (myDocumento.importospeseanticipoprofessionistiart15 > 0) {
            $('#chkSpeseAnticipateArt15').prop('checked', true);
            $('#collapsableSpeseAnticipateArt15').collapse('show');
        } else {
            $('#chkSpeseAnticipateArt15').prop('checked', false);
            $('#collapsableSpeseAnticipateArt15').collapse('hide');
        };


        // ****************************
        // Dati opzionali
        // ****************************
        $("#txtDatiOrdineAcquisto_IdDocumento").val(myDocumento.opzionalepa_ordinediacquisto_numeroordine);
        if (myDocumento.opzionalepa_ordinediacquisto_numeroordine != "") {
            $('#chkDatiOrdineAcquisto_visualizzaIdDocumento').prop('checked', true);
            $('#collapsableDatiOrdineAcquisto_visualizzaIdDocumento').collapse('show');
        } else {
            $('#chkDatiOrdineAcquisto_visualizzaIdDocumento').prop('checked', false);
            $('#collapsableDatiOrdineAcquisto_visualizzaIdDocumento').collapse('hide');
        };


        if (myDocumento.opzionalepa_ordinediacquisto_datacontrattoaa == 1) {
            $("#txtDatiOrdineAcquisto_Data").val("");
            $('#chkDatiOrdineAcquisto_visualizzaData').prop('checked', false);
            $('#collapsableDatiOrdineAcquisto_visualizzaData').collapse('hide');
        } else {
            $("#txtDatiOrdineAcquisto_Data").val(moment(new Date(myDocumento.opzionalepa_ordinediacquisto_datacontrattoaa, myDocumento.opzionalepa_ordinediacquisto_datacontrattomm - 1, myDocumento.opzionalepa_ordinediacquisto_datacontrattogg)).format("DD/MM/YYYY"));
            $('#chkDatiOrdineAcquisto_visualizzaData').prop('checked', true);
            $('#collapsableDatiOrdineAcquisto_visualizzaData').collapse('show');
        };


        $("#txtDatiOrdineAcquisto_CodiceCUP").val(myDocumento.opzionalepa_ordinediacquisto_codicecup);
        if (myDocumento.opzionalepa_ordinediacquisto_codicecup != "") {
            $('#chkDatiOrdineAcquisto_visualizzaCodiceCUP').prop('checked', true);
            $('#collapsableDatiOrdineAcquisto_visualizzaCodiceCUP').collapse('show');
        } else {
            $('#chkDatiOrdineAcquisto_visualizzaCodiceCUP').prop('checked', false);
            $('#collapsableDatiOrdineAcquisto_visualizzaCodiceCUP').collapse('hide');
        };

        $("#txtDatiOrdineAcquisto_CodiceCIG").val(myDocumento.opzionalepa_ordinediacquisto_codicecig);
        if (myDocumento.opzionalepa_ordinediacquisto_codicecig != "") {
            $('#chkDatiOrdineAcquisto_visualizzaCodiceCIG').prop('checked', true);
            $('#collapsableDatiOrdineAcquisto_visualizzaCodiceCIG').collapse('show');
        } else {
            $('#chkDatiOrdineAcquisto_visualizzaCodiceCIG').prop('checked', false);
            $('#collapsableDatiOrdineAcquisto_visualizzaCodiceCIG').collapse('hide');
        };

        $("#txtDatiOrdineAcquisto_CodiceCommessaConvenzione").val(myDocumento.opzionalepa_ordinediacquisto_codicecommessaconvenzione);
        if (myDocumento.opzionalepa_ordinediacquisto_codicecommessaconvenzione != "") {
            $('#chkDatiOrdineAcquisto_visualizzaCodiceCommessaConvenzione').prop('checked', true);
            $('#collapsableDatiOrdineAcquisto_visualizzaCodiceCommessaConvenzione').collapse('show');
        } else {
            $('#chkDatiOrdineAcquisto_visualizzaCodiceCommessaConvenzione').prop('checked', false);
            $('#collapsableDatiOrdineAcquisto_visualizzaCodiceCommessaConvenzione').collapse('hide');
        };

        $("#txtDatiContratto_IdDocumento").val(myDocumento.opzionalepa_daticontratto_numerocontratto);
        if (myDocumento.opzionalepa_daticontratto_numerocontratto != "") {
            $('#chkDatiContratto_visualizzaIdDocumento').prop('checked', true);
            $('#collapsableDatiContratto_visualizzaIdDocumento').collapse('show');
        } else {
            $('#chkDatiContratto_visualizzaIdDocumento').prop('checked', false);
            $('#collapsableDatiContratto_visualizzaIdDocumento').collapse('hide');
        };

        if (myDocumento.opzionalepa_daticontratto_datacontrattoaa == 1) {
            $("#txtDatiContratto_Data").val("");
            $('#chkDatiContratto_visualizzaData').prop('checked', false);
            $('#collapsableDatiContratto_visualizzaData').collapse('hide');
        } else {
            $("#txtDatiContratto_Data").val(moment(new Date(myDocumento.opzionalepa_daticontratto_datacontrattoaa, myDocumento.opzionalepa_daticontratto_datacontrattomm - 1, myDocumento.opzionalepa_daticontratto_datacontrattogg)).format("DD/MM/YYYY"));
            $('#chkDatiContratto_visualizzaData').prop('checked', true);
            $('#collapsableDatiContratto_visualizzaData').collapse('show');
        };

        $("#txtDatiContratto_CodiceCUP").val(myDocumento.opzionalepa_daticontratto_codicecup);
        if (myDocumento.opzionalepa_daticontratto_codicecup != "") {
            $('#chkDatiContratto_visualizzaCodiceCUP').prop('checked', true);
            $('#collapsableDatiContratto_visualizzaCodiceCUP').collapse('show');
        } else {
            $('#chkDatiContratto_visualizzaCodiceCUP').prop('checked', false);
            $('#collapsableDatiContratto_visualizzaCodiceCUP').collapse('hide');
        };

        $("#txtDatiContratto_CodiceCIG").val(myDocumento.opzionalepa_daticontratto_codicecig);
        if (myDocumento.opzionalepa_daticontratto_codicecig != "") {
            $('#chkDatiContratto_visualizzaCodiceCIG').prop('checked', true);
            $('#collapsableDatiContratto_visualizzaCodiceCIG').collapse('show');
        } else {
            $('#chkDatiContratto_visualizzaCodiceCIG').prop('checked', false);
            $('#collapsableDatiContratto_visualizzaCodiceCIG').collapse('hide');
        };

        $("#txtDatiContratto_CodiceCommessaConvenzione").val(myDocumento.opzionalepa_daticontratto_codicecommessaconvenzione);
        if (myDocumento.opzionalepa_daticontratto_codicecommessaconvenzione != "") {
            $('#chkDatiContratto_visualizzaCodiceCommessaConvenzione').prop('checked', true);
            $('#collapsableDatiContratto_visualizzaCodiceCommessaConvenzione').collapse('show');
        } else {
            $('#chkDatiContratto_visualizzaCodiceCommessaConvenzione').prop('checked', false);
            $('#collapsableDatiContratto_visualizzaCodiceCommessaConvenzione').collapse('hide');
        };

        $("#txtDatiSAL_RiferimentoFase").val(myDocumento.opzionalepa_datisal_riferimentofase);
        if (myDocumento.opzionalepa_datisal_riferimentofase != "") {
            $('#chkDatiSAL_visualizzaRiferimentoFase').prop('checked', true);
            $('#collapsableDatiSAL_visualizzaRiferimentoFase').collapse('show');
        } else {
            $('#chkDatiSAL_visualizzaRiferimentoFase').prop('checked', false);
            $('#collapsableDatiSAL_visualizzaRiferimentoFase').collapse('hide');
        };

        // Esigibilita IVA FISSO SEMPRE VISIBILE
        $("#ddlEsigibilitaIVA").val(myDocumento.uidtipoesigibilitaiva);
        $('#chkEsigibilitaIVA').prop('checked', true);
        $('#collapsableEsigibilitaIVA').collapse('show');

        $("#txtVisualizzaRiferimentoNormativo").val(myDocumento.opzionalepa_riferimentonormativo);
        if (myDocumento.opzionalepa_riferimentonormativo != "") {
            $('#chkVisualizzaRiferimentoNormativo').prop('checked', true);
            $('#collapsableVisualizzaRiferimentoNormativo').collapse('show');
        } else {
            $('#chkVisualizzaRiferimentoNormativo').prop('checked', false);
            $('#collapsableVisualizzaRiferimentoNormativo').collapse('hide');
        };

        $("#txtVisualizzaRiferimentoAmministrazione").val(myDocumento.opzionalepa_riferimentoamministrazione);
        if (myDocumento.opzionalepa_riferimentoamministrazione != "") {
            $('#chkVisualizzaRiferimentoAmministrazione').prop('checked', true);
            $('#collapsableVisualizzaRiferimentoAmministrazione').collapse('show');
        } else {
            $('#chkVisualizzaRiferimentoAmministrazione').prop('checked', false);
            $('#collapsableVisualizzaRiferimentoAmministrazione').collapse('hide');
        };

        $("#txtImportoBolloFE").val(Number(parseFloat(myDocumento.opzionalepa_importobollo)).toLocaleString("it-IT", { minimumFractionDigits: 2, maximumFractionDigits: 3 }));
        $('#chkIncludiBolloInTotaleFE').prop('checked', (myDocumento.opzionalepa_importobollo_addebitoalcliente));
        if (myDocumento.opzionalepa_importobollo != 0) {
            $('#chkVisualizzaCampiBolloFE').prop('checked', true);
            $('#collapsableVisualizzaCampiBolloFE').collapse('show');
        } else {
            $('#chkVisualizzaCampiBolloFE').prop('checked', false);
            $('#collapsableVisualizzaCampiBolloFE').collapse('hide');
        };


        $("#txtVisualizzaCognomeNome_Cognome").val(myDocumento.opzionalepa_visualizzacognomeprofessionista);
        $("#txtVisualizzaCognomeNome_Nome").val(myDocumento.opzionalepa_visualizzanomeprofessionista);
        if (myDocumento.opzionalepa_visualizzacognomeprofessionista != "") {
            $('#chkVisualizzaCognomeNome').prop('checked', true);
            $('#collapsableVisualizzaCognomeNome').collapse('show');
        } else {
            $('#chkVisualizzaCognomeNome').prop('checked', false);
            $('#collapsableVisualizzaCognomeNome').collapse('hide');
        };


        // ****************************************************************
        // siccome è l'ultima operazione in cascata fermo la rotellina ajax
        // ****************************************************************
        AjaxMessageStop();


    };

    // FOCUS IN: RIMUOVE SEPARATORE MIGLIAIA es. 1234.56
    $("#tblRigheFattura").on("focusin", "input.Qta", function () {
        if ($(this).is(":focus")) {
            var numeroITA = $(this).val().replace(/[^0-9-,]/g, ''); // PERMETTE SOLO I CARATTERI 1-9 e ","
            $(this).val(numeroITA);
        };
    });
    $("#tblRigheFattura").on("focusin", "input.Prezzo", function () {
        if ($(this).is(":focus")) {
            var numeroITA = $(this).val().replace(/[^0-9-,]/g, ''); // PERMETTE SOLO I CARATTERI 1-9 e ","
            $(this).val(numeroITA);
        };
    });

    $("#tblRigheFattura").on("focusout", "input.Qta", function () {
        formattaTextboxWithNumbers();
    });
    $("#tblRigheFattura").on("focusout", "input.Prezzo", function () {
        formattaTextboxWithNumbers();
    });


    function numberEngFormat(numberITA) {
        var numberENG = Number(numberITA.replace(/[^0-9-,]/g, '').replace(',', '.')); // PERMETTE SOLO I CARATTERI 1-9 e ","; POI sostituisco la "," con il "."
        return numberENG;
    };

    //$(document).click(function (event) {
    $("#tblRigheFattura").on("change", "input.Qta", function (e) {
        formattaTextboxWithNumbers();
    });
    $("#tblRigheFattura").on("change", "input.Prezzo", function (e) {
        formattaTextboxWithNumbers();
    });

    function formattaTextboxWithNumbers() {

        $('#tblRigheFattura > tbody  > tr').each(function (i, objTableRow) {

            // **********************
            // PULISCE E FORMATTA QTA
            // **********************
            // 1.234,56 --> 1234,56
            var strQtaITA = $(objTableRow).find("input.Qta").first().val().replace(/[^0-9-,]/g, ''); // AMMETTE SOLO I CARATTERI 1-9 e ","; tutto il resto sostituisce con ''
            // 1234,56 --> 1234.56
            var strQtaENG = numberEngFormat(strQtaITA); //.replace(',', '.');

            if (isNaN(parseFloat(strQtaENG))) {
                //$(this).removeClass('is-invalid').addClass('is-invalid');
                return
            } else {
                var strQtaENG2 = Number(parseFloat(strQtaENG)).toLocaleString("it-IT", { minimumFractionDigits: 0, maximumFractionDigits: 5 });
                $(objTableRow).find("input.Qta").first().val(strQtaENG2);
            };


            // *************************
            // PULISCE E FORMATTA Prezzo
            // *************************
            // 1.234,56 --> 1234,56
            var strPrezzoITA = $(objTableRow).find("input.Prezzo").first().val().replace(/[^0-9-,]/g, ''); // AMMETTE SOLO I CARATTERI 1-9 e ","; tutto il resto sostituisce con ''
            // 1234,56 --> 1234.56
            var strPrezzoENG = numberEngFormat(strPrezzoITA); //.replace(',', '.');

            if (isNaN(parseFloat(strPrezzoENG))) {
                $(this).removeClass('is-invalid').addClass('is-invalid');
                //return
            } else {
                var strPrezzoENG2 = Number(parseFloat(strPrezzoENG)).toLocaleString("it-IT", { minimumFractionDigits: 2, maximumFractionDigits: 4 });
                $(objTableRow).find("input.Prezzo").first().val(strPrezzoENG2);
                //$(this).removeClass('is-invalid');
            };

        });
    };



    /* *******************************
        ARCHIVIO DDT
    ********************************** */
    $("#btnOpenModalArchivioDDT").click(function () {

        CurrentPageIndexOfArchivioDDT = 0;
        var UidSoggetto = myObjFattura.uidsoggetto;

        var datafine = new Date();
        var year = datafine.getFullYear();
        var datainizio = new Date(year - 1, 0, 1);

        popolaTblArchivioDDT(CurrentPageIndexOfArchivioDDT, datainizio, datafine, UidSoggetto)
        $('#myModalArchivioDDT').modal("show");
    });

    var CurrentPageIndexOfArchivioDDT = 0;
    var PageCountOfArchivioDDT = 0;
    function popolaTblArchivioDDT(CurrentPageIndex, datainizio, datafine, UidSoggetto) {

        CurrentPageIndexOfArchivioDDT = CurrentPageIndex;
        var _datainizio = datainizio.toJSON();
        var _datafine = datafine.toJSON();

        AjaxMessageStart();

        $.ajax({
            method: 'GET',
            url: myStorage.ApiUrl + '/DDT/list/CurrentPageIndex/' + CurrentPageIndex + '/DataDocumentoInizio/' + _datainizio + '/DataDocumentoFine/' + _datafine + '/UidSoggetto/' + UidSoggetto + '/showOnlyDDTDaFatturare/true',
            beforeSend: function (xhdr) {
                xhdr.setRequestHeader("Authorization", "Bearer " + myStorage.token);
            }
        }).done(function (resp, statusText, xhdr) {

            var myResponse = $.parseJSON(resp);
            var success = myResponse.success; // = true;
            var errormessage = myResponse.errormessage; // = "OK";
            var errorcode = myResponse.errorcode; // = 0;
            var pagecount = myResponse.pagecount;

            if (success == true) {

                var collection = $.parseJSON(myResponse.obj);
                $("#tblArchivioDDT tbody").empty();
                $.each(collection, function (i, obj) {

                    var tr = '<tr>'
                        + '<td style="width:95%;">' + obj.descrizionereadonly + '</td>'
                        + '<td><button type="button" class="btn btn-primary btn-sm selezioneArchivioDDT" data-uid="' + obj.uid + '">seleziona</button></td>'
                        + '</tr>';
                    $("#tblArchivioDDT tbody").append(tr);

                });
                if (collection.length == 0) {
                    var tr = '<tr>'
                        + '<td style="width:99%;text-align:center;"> nessun elemento trovato</td>'
                        + '<td></td>'
                        + '</tr>';
                    $("#tblArchivioDDT tbody").append(tr);
                }

                // PAGINAZIONE: STATO DEI BUTTONS
                PageCountOfArchivioDDT = pagecount;
                $("#btnPagingGoToFirst_ArchivioDDT").parent().removeClass("disabled");
                $("#btnPagingGoBack_ArchivioDDT").parent().removeClass("disabled");
                $("#btnPagingGoForward_ArchivioDDT").parent().removeClass("disabled");
                $("#btnPagingGoToLast_ArchivioDDT").parent().removeClass("disabled");
                if (CurrentPageIndexOfArchivioDDT == 0) {
                    $("#btnPagingGoToFirst_ArchivioDDT").parent().addClass("disabled");
                    $("#btnPagingGoBack_ArchivioDDT").parent().addClass("disabled");
                }
                if (CurrentPageIndexOfArchivioDDT == (pagecount - 1)) {
                    $("#btnPagingGoForward_ArchivioDDT").parent().addClass("disabled");
                    $("#btnPagingGoToLast_ArchivioDDT").parent().addClass("disabled");
                }

                $("#txtCurrentPageIndex_ArchivioDDT").text(CurrentPageIndexOfArchivioDDT + 1);
                $("#txtPageCount_ArchivioDDT").text(PageCountOfArchivioDDT);

            } else {
                alert("Login error; Message: " + errormessage + ";errorcode=" + errorcode);
            };

            AjaxMessageStop();

        }).fail(function (xhdr, statusText, errorText) {

            AjaxMessageStop();
            alert("err=" + errorText);

        });
    };

    $("#btnPagingGoToFirst_ArchivioDDT").click(function () {
        CurrentPageIndexOfArchivioDDT = 0;
        var strSearch = $("#txtSearchArchivioDDT").val();
        popolaTblArchivioDDT(CurrentPageIndexOfArchivioDDT, strSearch)
    });
    $("#btnPagingGoBack_ArchivioDDT").click(function () {
        CurrentPageIndexOfArchivioDDT -= 1;
        var strSearch = $("#txtSearchArchivioDDT").val();
        popolaTblArchivioDDT(CurrentPageIndexOfArchivioDDT, strSearch)
    });
    $("#btnPagingGoForward_ArchivioDDT").click(function () {
        CurrentPageIndexOfArchivioDDT += 1;
        if (PageCountOfArchivioDDT > 1) {
            if (CurrentPageIndexOfArchivioDDT >= (PageCountOfArchivioDDT - 1)) {
                CurrentPageIndexOfArchivioDDT = PageCountOfArchivioDDT - 1;
            }
        }
        var strSearch = $("#txtSearchArchivioDDT").val();
        popolaTblArchivioDDT(CurrentPageIndexOfArchivioDDT, strSearch)
    });
    $("#btnPagingGoToLast_ArchivioDDT").click(function () {
        CurrentPageIndexOfArchivioDDT = PageCountOfArchivioDDT - 1;
        var strSearch = $("#txtSearchArchivioDDT").val();
        popolaTblArchivioDDT(CurrentPageIndexOfArchivioDDT, strSearch)
    });


    $("#tblArchivioDDT").on("click", ".selezioneArchivioDDT", function () {
        var uid = $(this).data("uid");
        getDDT(uid);
    });

    function getDDT(uid) {

        AjaxMessageStart();

        $.ajax({
            method: 'GET',
            url: myStorage.ApiUrl + '/DDT/get/' + uid,
            beforeSend: function (xhdr) {
                xhdr.setRequestHeader("Authorization", "Bearer " + myStorage.token); //$("#token").val());
            }
        }).done(function (resp, statusText, xhdr) {

            var myResponse = $.parseJSON(resp);
            var success = myResponse.success; // = true;
            var errormessage = myResponse.errormessage; // = "OK";
            var errorcode = myResponse.errorcode; // = 0;
            var pagecount = myResponse.pagecount;

            if (success == true) {

                var myDDT = $.parseJSON(myResponse.obj);
                var _dataDocumento = new Date(myDDT.datadocumentoaa, myDDT.datadocumentomm - 1, myDDT.datadocumentogg);

                var rifDocumento = {
                    'tipoDocumento': 'DDT',
                    'uidDocumento': myDDT.uid,
                    'numeroDocumento': myDDT.numero,
                    'annoDocumento': myDDT.datadocumentoaa, //_dataDocumento.getFullYear(),
                    'descrDataDocumento': moment(_dataDocumento).format("DD/MM/YYYY") //DESCR ITA
                };

                // ********************************************
                //  each riga di DDT convert to riga di fattura
                // ********************************************
                $.each(myDDT.righe, function (indexDDTRiga, myDDTRiga) {

                    var _myObjArticolo = new Entities.Articolo;

                    _myObjArticolo.uid = myDDTRiga.uidarticolo;
                    _myObjArticolo.codice = myDDTRiga.codicearticolo;
                    _myObjArticolo.descrizionebreve = myDDTRiga.descrizionereadonly;
                    _myObjArticolo.descrizioneestesa = myDDTRiga.descrizione;
                    _myObjArticolo.descrizioneinfattura = myDDTRiga.descrizione;
                    _myObjArticolo.uidtipounitadimisura = myDDTRiga.uidtipounitadimisura;

                    var _uidarticolo = myDDTRiga.uidarticolo;
                    if (_uidarticolo != EmptyUid) {

                        // **********************************************************
                        // VALORIZZO IL PREZZO CON UNA CHIAMATA ALL'ARCHIVIO ARTICOLI
                        // **********************************************************
                        $.ajax({
                            async: false, // ATTENIONE CHIAMATA SYNCRONA !!!!!!!!!!!
                            method: 'GET',
                            url: myStorage.ApiUrl + '/Articolo/get/' + _uidarticolo,
                            beforeSend: function (xhdr) {
                                xhdr.setRequestHeader("Authorization", "Bearer " + myStorage.token); //$("#token").val());
                            }
                        }).done(function (resp, statusText, xhdr) {
                            var myResponse = $.parseJSON(resp);
                            var success = myResponse.success;
                            if (success == true) {
                                var myArticolo = $.parseJSON(myResponse.obj);
                                _myObjArticolo.prezzodivenditaattuale = myArticolo.prezzodivenditaattuale;
                            } else {
                                _myObjArticolo.prezzodivenditaattuale = 0;
                            };
                        }).fail(function (xhdr, statusText, errorText) {
                            _myObjArticolo.prezzodivenditaattuale = 0;
                        });
                    };

                    //IVA PRESA DALLA RIGA DEL DDT
                    var uidTipoAliquotaIVAdefault = EmptyUid;
                    $.each(myStorage.aliquotaivacollection, function (i, obj) {
                        if (obj.uid == myDDTRiga.UidTipoUnitaDiMisura) {
                            uidTipoAliquotaIVAdefault = obj.uid;
                        };
                    });

                    // QTA
                    var _qta = myDDTRiga.quantita;

                    addRigaFattura(_myObjArticolo, uidTipoAliquotaIVAdefault, _qta, rifDocumento);
                });

                //CHIUDE LE MODALE
                $('#myModalArchivioDDT').modal("hide");

            } else {
                alert("Login error; Message: " + errormessage + ";errorcode=" + errorcode);
            };

            AjaxMessageStop();

        }).fail(function (xhdr, statusText, errorText) {

            AjaxMessageStop();
            alert("err=" + errorText);

        });

    };

    //Operazioni by Step
    function doOperazioniStep(stepNum) {

        switch (stepNum) {
            case 0:
                // step 0:
                // ****************************************************
                // AVVIA POPOLAMENTO DI TUTTE LE COLLECTIONS ACCESSORIE
                // ****************************************************
                if (isDoneCaricamentoIniziale_Step0 == false) {
                    PopolaCollections();
                };
                break;

            case 1:
                // step 1: tipo documento
                myObjFattura.uidtipofatturacliente = $("input[name='radioTipiDocumento']:checked").val();
                break;

            case 2:
                // step 2: data e num documento

                //ricostruisco data
                var _dataDocumento = $("#txtDataDocumento").val().split("/");
                //var d = parseInt(_dataDocumento[0]),
                //    m = parseInt(_dataDocumento[1]),
                //    y = parseInt(_dataDocumento[2]);
                myObjFattura.datadocumentogg = parseInt(_dataDocumento[0]);
                myObjFattura.datadocumentomm = parseInt(_dataDocumento[1]);
                myObjFattura.datadocumentoaa = parseInt(_dataDocumento[2]);

                // nota: NUMERO DOCUMENTO; per una Nuova Fattura con numerazione automatica inserire 0;
                myObjFattura.numero = $('#txtNumeroDocumento').val();
                if ($("input[name='radioNumerazioneDocumento']:checked").val() == "a" & myObjFattura.uid == EmptyUid) {
                    myObjFattura.numero = 0;
                }
                //sezionale
                myObjFattura.uidtiposezionale = $("#ddlSezionale").val();

                break;

            case 3:
                // step 3: cliente
                //myObjFattura.uidsoggetto = myObjCliente.uid;
                if (myObjCliente.ispareadonly == true) {
                    //fattura verso PA
                    myObjFattura.uidtipoformatotrasmissione = "00000000-0000-0000-0000-000000000001"
                } else {
                    //fattura verso B2B/privati
                    myObjFattura.uidtipoformatotrasmissione = "00000000-0000-0000-0000-000000000002"
                }

                break;
            case 4:
                //righe fatt
                //carica le righe in myObjFattura
                doRefreshInsertRigheFattura();
                break;

            case 5:
                //***********************
                //INFO ACCESSORIE
                //***********************

                // Tipologia di Pagamento
                myObjFattura.uidtipopagamento = $("#ddlTipoPagamento").val();
                // Data Scadenza Pagamento (opzionale se non c'e' passare 01/01/0001)
                //var _datascadenzapagamento = new Date(1, 0, 0001); //default 01/01/0001
                if ($("#txtTipoPagamento_DataScadenzaPagamento").val().trim() == "") {
                    myObjFattura.datascadenzapagamentoaa = 1;
                    myObjFattura.datascadenzapagamentomm = 1;
                    myObjFattura.datascadenzapagamentogg = 1;
                } else {
                    //ricostruisco data
                    var _datascadenzapagamentoString = $("#txtTipoPagamento_DataScadenzaPagamento").val().trim().split("/");
                    var d = parseInt(_datascadenzapagamentoString[0]),
                        m = parseInt(_datascadenzapagamentoString[1]),
                        y = parseInt(_datascadenzapagamentoString[2]);
                    //_datascadenzapagamento = new Date(y, m - 1, d);
                    myObjFattura.datascadenzapagamentoaa = y;
                    myObjFattura.datascadenzapagamentomm = m;
                    myObjFattura.datascadenzapagamentogg = d;
                };

                // Condizioni Pagamento
                myObjFattura.uidtipocondizionepagamento = $("#ddlCondizioniPagamento").val();
                // BANCA
                myObjFattura.uidtipocoordinatebancarie = $("#ddlCoordinateBancarie").val();
                // CAMPI RITENUTA
                myObjFattura.perccontributoprevidenziale = parseFloat(numberEngFormat($("#txtPercContributoPrevidenzialeProfessionisti").val()));
                myObjFattura.uidtipoaliquotaivasucontributoprevidenziale = $("#ddlAliquoteIVAsuContributoPrevidenzialeProfessionisti").val();
                myObjFattura.percritenutaacconto = parseFloat(numberEngFormat($("#txtPercRitenutaAccontoProfessionisti").val()));
                // spese anticipo professionisti art.15
                myObjFattura.importospeseanticipoprofessionistiart15 = parseFloat(numberEngFormat($('#txtImportoSpeseAnticipoProfessionistiART15').val()));

                break;

            case 6:

                // ****************************
                // Dati opzionali
                // ****************************

                // Ordine Acquisto
                myObjFattura.opzionalepa_ordinediacquisto_numeroordine = $("#txtDatiOrdineAcquisto_IdDocumento").val();

                // OrdineAcquisto_Data (opzionale se non c'e' passare 01/01/0001)
                if ($("#txtDatiOrdineAcquisto_Data").val().trim() == "") {
                    myObjFattura.opzionalepa_ordinediacquisto_datacontrattoaa = 1;
                    myObjFattura.opzionalepa_ordinediacquisto_datacontrattomm = 1;
                    myObjFattura.opzionalepa_ordinediacquisto_datacontrattogg = 1;
                } else {
                    //ricostruisco data
                    var _ordinediacquisto_datacontrattoString = $("#txtDatiOrdineAcquisto_Data").val().trim().split("/");
                    var d = parseInt(_ordinediacquisto_datacontrattoString[0]),
                        m = parseInt(_ordinediacquisto_datacontrattoString[1]),
                        y = parseInt(_ordinediacquisto_datacontrattoString[2]);
                    myObjFattura.opzionalepa_ordinediacquisto_datacontrattogg = d;
                    myObjFattura.opzionalepa_ordinediacquisto_datacontrattomm = m;
                    myObjFattura.opzionalepa_ordinediacquisto_datacontrattoaa = y;
                };

                myObjFattura.opzionalepa_ordinediacquisto_codicecup = $("#txtDatiOrdineAcquisto_CodiceCUP").val();
                myObjFattura.opzionalepa_ordinediacquisto_codicecig = $("#txtDatiOrdineAcquisto_CodiceCIG").val();
                myObjFattura.opzionalepa_ordinediacquisto_codicecommessaconvenzione = $("#txtDatiOrdineAcquisto_CodiceCommessaConvenzione").val();

                // Dati Contratto
                myObjFattura.opzionalepa_daticontratto_numerocontratto = $("#txtDatiContratto_IdDocumento").val();

                // daticontratto_datacontratto (opzionale se non c'e' passare 01/01/0001)
                if ($("#txtDatiContratto_Data").val().trim() == "") {
                    myObjFattura.opzionalepa_daticontratto_datacontrattoaa = 1;
                    myObjFattura.opzionalepa_daticontratto_datacontrattomm = 1;
                    myObjFattura.opzionalepa_daticontratto_datacontrattogg = 1;
                } else {
                    //ricostruisco data
                    var _daticontratto_datacontrattoString = $("#txtDatiContratto_Data").val().trim().split("/");
                    var d = parseInt(_daticontratto_datacontrattoString[0]),
                        m = parseInt(_daticontratto_datacontrattoString[1]),
                        y = parseInt(_daticontratto_datacontrattoString[2]);
                    myObjFattura.opzionalepa_daticontratto_datacontrattogg = d;
                    myObjFattura.opzionalepa_daticontratto_datacontrattomm = m;
                    myObjFattura.opzionalepa_daticontratto_datacontrattoaa = y;
                };

                myObjFattura.opzionalepa_daticontratto_codicecup = $("#txtDatiContratto_CodiceCUP").val();
                myObjFattura.opzionalepa_daticontratto_codicecig = $("#txtDatiContratto_CodiceCIG").val();
                myObjFattura.opzionalepa_daticontratto_codicecommessaconvenzione = $("#txtDatiContratto_CodiceCommessaConvenzione").val();

                // SAL
                myObjFattura.opzionalepa_datisal_riferimentofase = $("#txtDatiSAL_RiferimentoFase").val();

                // Esigibilita IVA
                myObjFattura.uidtipoesigibilitaiva = $("#ddlEsigibilitaIVA").val();
                myObjFattura.opzionalepa_riferimentonormativo = $("#txtVisualizzaRiferimentoNormativo").val();
                myObjFattura.opzionalepa_riferimentoamministrazione = $("#txtVisualizzaRiferimentoAmministrazione").val();
                myObjFattura.opzionalepa_importobollo = parseFloat(numberEngFormat($('#txtImportoBolloFE').val()));
                myObjFattura.opzionalepa_importobollo_addebitoalcliente = $('#chkIncludiBolloInTotaleFE').is(':checked'); //true/false

                myObjFattura.opzionalepa_visualizzacognomeprofessionista = $("#txtVisualizzaCognomeNome_Cognome").val();
                myObjFattura.opzionalepa_visualizzanomeprofessionista = $("#txtVisualizzaCognomeNome_Nome").val();

                break;
        }
    };

    // NAVIGAZIONE STEPS
    function GoToStep0() {

        //if (!isValidatedStep0()) {
        //    openPopupMessage('error', 'Attenzione, per procedere devi inserire tutti i campi obbligatori di questo passaggio');
        //    return false;
        //}

        $("#step-0-button").removeClass();
        $("#step-1-button").removeClass();
        $("#step-2-button").removeClass();
        $("#step-3-button").removeClass();
        $("#step-4-button").removeClass();
        $("#step-5-button").removeClass();
        $("#step-6-button").removeClass();
        $("#step-7-button").removeClass();

        $("#step-0-button").addClass("active");

        $("#step-0-content").show("fast");
        $("#step-1-content").hide();
        $("#step-2-content").hide();
        $("#step-3-content").hide();
        $("#step-4-content").hide();
        $("#step-5-content").hide();
        $("#step-6-content").hide();
        $("#step-7-content").hide();

    };

    function GoToStep1() {

        var myStep = validateFormFn(0);
        if (myStep.isLoggedIn == false) {
            $('#myModalLogin').modal("show");
            return;
        };
        if (myStep.isValid == false) {
            openPopupMessage('error', myStep.descrizione);
            return;
        };
        doOperazioniStep(0);

        $("#step-0-button").removeClass();
        $("#step-1-button").removeClass();
        $("#step-2-button").removeClass();
        $("#step-3-button").removeClass();
        $("#step-4-button").removeClass();
        $("#step-5-button").removeClass();
        $("#step-6-button").removeClass();
        $("#step-7-button").removeClass();

        $("#step-0-button").addClass("done");
        $("#step-1-button").addClass("active");

        $("#step-0-content").hide();
        $("#step-1-content").show("fast");
        $("#step-2-content").hide();
        $("#step-3-content").hide();
        $("#step-4-content").hide();
        $("#step-5-content").hide();
        $("#step-6-content").hide();
        $("#step-7-content").hide();

    };

    function GoToStep2() {

        var myStep = validateFormFn(0);
        if (myStep.isLoggedIn == false) {
            $('#myModalLogin').modal("show");
            return;
        };
        if (myStep.isValid == false) {
            openPopupMessage('error', myStep.descrizione);
            return;
        };
        doOperazioniStep(0);

        var myStep = validateFormFn(1);
        if (myStep.isLoggedIn == false) {
            $('#myModalLogin').modal("show");
            return;
        };
        if (myStep.isValid == false) {
            openPopupMessage('error', myStep.descrizione);
            return;
        };
        doOperazioniStep(1);

        $("#step-0-button").removeClass();
        $("#step-1-button").removeClass();
        $("#step-2-button").removeClass();
        $("#step-3-button").removeClass();
        $("#step-4-button").removeClass();
        $("#step-5-button").removeClass();
        $("#step-6-button").removeClass();
        $("#step-7-button").removeClass();

        $("#step-0-button").addClass("done");
        $("#step-1-button").addClass("done");
        $("#step-2-button").addClass("active");

        $("#step-0-content").hide();
        $("#step-1-content").hide();
        $("#step-2-content").show("fast");
        $("#step-3-content").hide();
        $("#step-4-content").hide();
        $("#step-5-content").hide();
        $("#step-6-content").hide();
        $("#step-7-content").hide();
    };

    function GoToStep3() {

        var myStep = validateFormFn(0);
        if (myStep.isLoggedIn == false) {
            $('#myModalLogin').modal("show");
            return;
        };
        if (myStep.isValid == false) {
            openPopupMessage('error', myStep.descrizione);
            return;
        };
        doOperazioniStep(0);

        myStep = validateFormFn(1);
        if (myStep.isLoggedIn == false) {
            $('#myModalLogin').modal("show");
            return;
        };
        if (myStep.isValid == false) {
            openPopupMessage('error', myStep.descrizione);
            return;
        };
        doOperazioniStep(1);


        myStep = validateFormFn(2);
        if (myStep.isLoggedIn == false) {
            $('#myModalLogin').modal("show");
            return;
        };
        if (myStep.isValid == false) {
            openPopupMessage('error', myStep.descrizione);
            return;
        };
        doOperazioniStep(2);


        $("#step-0-button").removeClass();
        $("#step-1-button").removeClass();
        $("#step-2-button").removeClass();
        $("#step-3-button").removeClass();
        $("#step-4-button").removeClass();
        $("#step-5-button").removeClass();
        $("#step-6-button").removeClass();
        $("#step-7-button").removeClass();

        $("#step-0-button").addClass("done");
        $("#step-1-button").addClass("done");
        $("#step-2-button").addClass("done");
        $("#step-3-button").addClass("active");

        $("#step-0-content").hide();
        $("#step-1-content").hide();
        $("#step-2-content").hide();
        $("#step-3-content").show("fast");
        $("#step-4-content").hide();
        $("#step-5-content").hide();
        $("#step-6-content").hide();
        $("#step-7-content").hide();
    };

    function GoToStep4() {


        var myStep = validateFormFn(0);
        if (myStep.isLoggedIn == false) {
            $('#myModalLogin').modal("show");
            return;
        };
        if (myStep.isValid == false) {
            openPopupMessage('error', myStep.descrizione);
            return;
        };
        doOperazioniStep(0);

        myStep = validateFormFn(1);
        if (myStep.isLoggedIn == false) {
            $('#myModalLogin').modal("show");
            return;
        };
        if (myStep.isValid == false) {
            openPopupMessage('error', myStep.descrizione);
            return;
        };
        doOperazioniStep(1);


        myStep = validateFormFn(2);
        if (myStep.isLoggedIn == false) {
            $('#myModalLogin').modal("show");
            return;
        };
        if (myStep.isValid == false) {
            openPopupMessage('error', myStep.descrizione);
            return;
        };
        doOperazioniStep(2);

        myStep = validateFormFn(3);
        if (myStep.isLoggedIn == false) {
            $('#myModalLogin').modal("show");
            return;
        };
        if (myStep.isValid == false) {
            openPopupMessage('error', myStep.descrizione);
            return;
        };
        doOperazioniStep(3);

        $("#step-0-button").removeClass();
        $("#step-1-button").removeClass();
        $("#step-2-button").removeClass();
        $("#step-3-button").removeClass();
        $("#step-4-button").removeClass();
        $("#step-5-button").removeClass();
        $("#step-6-button").removeClass();
        $("#step-7-button").removeClass();

        $("#step-0-button").addClass("done");
        $("#step-1-button").addClass("done");
        $("#step-2-button").addClass("done");
        $("#step-3-button").addClass("done");
        $("#step-4-button").addClass("active");

        $("#step-0-content").hide();
        $("#step-1-content").hide();
        $("#step-2-content").hide();
        $("#step-3-content").hide();
        $("#step-4-content").show("fast");
        $("#step-5-content").hide();
        $("#step-6-content").hide();
        $("#step-7-content").hide();
    };

    function GoToStep5() {

        var myStep = validateFormFn(0);
        if (myStep.isLoggedIn == false) {
            $('#myModalLogin').modal("show");
            return;
        };
        if (myStep.isValid == false) {
            openPopupMessage('error', myStep.descrizione);
            return;
        };
        doOperazioniStep(0);

        myStep = validateFormFn(1);
        if (myStep.isLoggedIn == false) {
            $('#myModalLogin').modal("show");
            return;
        };
        if (myStep.isValid == false) {
            openPopupMessage('error', myStep.descrizione);
            return;
        };
        doOperazioniStep(1);


        myStep = validateFormFn(2);
        if (myStep.isLoggedIn == false) {
            $('#myModalLogin').modal("show");
            return;
        };
        if (myStep.isValid == false) {
            openPopupMessage('error', myStep.descrizione);
            return;
        };
        doOperazioniStep(2);

        myStep = validateFormFn(3);
        if (myStep.isLoggedIn == false) {
            $('#myModalLogin').modal("show");
            return;
        };
        if (myStep.isValid == false) {
            openPopupMessage('error', myStep.descrizione);
            return;
        };
        doOperazioniStep(3);

        myStep = validateFormFn(4);
        if (myStep.isLoggedIn == false) {
            $('#myModalLogin').modal("show");
            return;
        };
        if (myStep.isValid == false) {
            openPopupMessage('error', myStep.descrizione);
            return;
        };
        doOperazioniStep(4);

        // REFRESH INPUT SE MODIFICATI DIRETTAMENTE NELLE RIGHE
        var isOkRefreshRigheFattura = doRefreshInsertRigheFattura();
        if (isOkRefreshRigheFattura == false) {
            return;
        };

        $("#step-0-button").removeClass();
        $("#step-1-button").removeClass();
        $("#step-2-button").removeClass();
        $("#step-3-button").removeClass();
        $("#step-4-button").removeClass();
        $("#step-5-button").removeClass();
        $("#step-6-button").removeClass();
        $("#step-7-button").removeClass();

        $("#step-0-button").addClass("done");
        $("#step-1-button").addClass("done");
        $("#step-2-button").addClass("done");
        $("#step-3-button").addClass("done");
        $("#step-4-button").addClass("done");
        $("#step-5-button").addClass("active");

        $("#step-0-content").hide();
        $("#step-1-content").hide();
        $("#step-2-content").hide();
        $("#step-3-content").hide();
        $("#step-4-content").hide();
        $("#step-5-content").show("fast");
        $("#step-6-content").hide();
        $("#step-7-content").hide();
    };

    function GoToStep6() {

        // REFRESH INPUT SE MODIFICATI DIRETTAMENTE NELLE RIGHE
        var isOkRefreshRigheFattura = doRefreshInsertRigheFattura();
        if (isOkRefreshRigheFattura == false) {
            return;
        };


        var myStep = validateFormFn(0);
        if (myStep.isLoggedIn == false) {
            $('#myModalLogin').modal("show");
            return;
        };
        if (myStep.isValid == false) {
            openPopupMessage('error', myStep.descrizione);
            return;
        };
        doOperazioniStep(0);

        myStep = validateFormFn(1);
        if (myStep.isLoggedIn == false) {
            $('#myModalLogin').modal("show");
            return;
        };
        if (myStep.isValid == false) {
            openPopupMessage('error', myStep.descrizione);
            return;
        };
        doOperazioniStep(1);


        myStep = validateFormFn(2);
        if (myStep.isLoggedIn == false) {
            $('#myModalLogin').modal("show");
            return;
        };
        if (myStep.isValid == false) {
            openPopupMessage('error', myStep.descrizione);
            return;
        };
        doOperazioniStep(2);

        myStep = validateFormFn(3);
        if (myStep.isLoggedIn == false) {
            $('#myModalLogin').modal("show");
            return;
        };
        if (myStep.isValid == false) {
            openPopupMessage('error', myStep.descrizione);
            return;
        };
        doOperazioniStep(3);

        myStep = validateFormFn(4);
        if (myStep.isLoggedIn == false) {
            $('#myModalLogin').modal("show");
            return;
        };
        if (myStep.isValid == false) {
            openPopupMessage('error', myStep.descrizione);
            return;
        };
        doOperazioniStep(4);

        myStep = validateFormFn(5);
        if (myStep.isLoggedIn == false) {
            $('#myModalLogin').modal("show");
            return;
        };
        if (myStep.isValid == false) {
            openPopupMessage('error', myStep.descrizione);
            return;
        };
        doOperazioniStep(5);

        $("#step-0-button").removeClass();
        $("#step-1-button").removeClass();
        $("#step-2-button").removeClass();
        $("#step-3-button").removeClass();
        $("#step-4-button").removeClass();
        $("#step-5-button").removeClass();
        $("#step-6-button").removeClass();
        $("#step-7-button").removeClass();

        $("#step-0-button").addClass("done");
        $("#step-1-button").addClass("done");
        $("#step-2-button").addClass("done");
        $("#step-3-button").addClass("done");
        $("#step-4-button").addClass("done");
        $("#step-5-button").addClass("done");
        $("#step-6-button").addClass("active");

        $("#step-0-content").hide();
        $("#step-1-content").hide();
        $("#step-2-content").hide();
        $("#step-3-content").hide();
        $("#step-4-content").hide();
        $("#step-5-content").hide();
        $("#step-6-content").show("fast");
        $("#step-7-content").hide();

    };

    function GoToStep7() {
        //SALVATAGGIO FINALE

        // REFRESH INPUT SE MODIFICATI DIRETTAMENTE NELLE RIGHE
        var isOkRefreshRigheFattura = doRefreshInsertRigheFattura();
        if (isOkRefreshRigheFattura == false) {
            return;
        };

        var myStep = validateFormFn(0);
        if (myStep.isLoggedIn == false) {
            $('#myModalLogin').modal("show");
            return;
        };
        if (myStep.isValid == false) {
            openPopupMessage('error', myStep.descrizione);
            return;
        };
        doOperazioniStep(0);

        myStep = validateFormFn(1);
        if (myStep.isLoggedIn == false) {
            $('#myModalLogin').modal("show");
            return;
        };
        if (myStep.isValid == false) {
            openPopupMessage('error', myStep.descrizione);
            return;
        };
        doOperazioniStep(1);


        myStep = validateFormFn(2);
        if (myStep.isLoggedIn == false) {
            $('#myModalLogin').modal("show");
            return;
        };
        if (myStep.isValid == false) {
            openPopupMessage('error', myStep.descrizione);
            return;
        };
        doOperazioniStep(2);

        myStep = validateFormFn(3);
        if (myStep.isLoggedIn == false) {
            $('#myModalLogin').modal("show");
            return;
        };
        if (myStep.isValid == false) {
            openPopupMessage('error', myStep.descrizione);
            return;
        };
        doOperazioniStep(3);

        myStep = validateFormFn(4);
        if (myStep.isLoggedIn == false) {
            $('#myModalLogin').modal("show");
            return;
        };
        if (myStep.isValid == false) {
            openPopupMessage('error', myStep.descrizione);
            return;
        };
        doOperazioniStep(4);

        myStep = validateFormFn(5);
        if (myStep.isLoggedIn == false) {
            $('#myModalLogin').modal("show");
            return;
        };
        if (myStep.isValid == false) {
            openPopupMessage('error', myStep.descrizione);
            return;
        };
        doOperazioniStep(5);

        myStep = validateFormFn(6);
        if (myStep.isLoggedIn == false) {
            $('#myModalLogin').modal("show");
            return;
        };
        if (myStep.isValid == false) {
            openPopupMessage('error', myStep.descrizione);
            return;
        };
        doOperazioniStep(6);

        //**************
        // SALVA FINALE
        //**************
        doSave();

    };

    $("#btnVisualizzaRiepilogoDocumento").click(function () {

        // REFRESH INPUT SE MODIFICATI DIRETTAMENTE NELLE RIGHE
        var isOkRefreshRigheFattura = doRefreshInsertRigheFattura();
        if (isOkRefreshRigheFattura == false) {
            return;
        };

        var myStep = validateFormFn(0);
        if (myStep.isLoggedIn == false) {
            $('#myModalLogin').modal("show");
            return;
        };
        if (myStep.isValid == false) {
            openPopupMessage('error', myStep.descrizione);
            return;
        };
        doOperazioniStep(0);

        myStep = validateFormFn(1);
        if (myStep.isLoggedIn == false) {
            $('#myModalLogin').modal("show");
            return;
        };
        if (myStep.isValid == false) {
            openPopupMessage('error', myStep.descrizione);
            return;
        };
        doOperazioniStep(1);


        myStep = validateFormFn(2);
        if (myStep.isLoggedIn == false) {
            $('#myModalLogin').modal("show");
            return;
        };
        if (myStep.isValid == false) {
            openPopupMessage('error', myStep.descrizione);
            return;
        };
        doOperazioniStep(2);

        myStep = validateFormFn(3);
        if (myStep.isLoggedIn == false) {
            $('#myModalLogin').modal("show");
            return;
        };
        if (myStep.isValid == false) {
            openPopupMessage('error', myStep.descrizione);
            return;
        };
        doOperazioniStep(3);

        myStep = validateFormFn(4);
        if (myStep.isLoggedIn == false) {
            $('#myModalLogin').modal("show");
            return;
        };
        if (myStep.isValid == false) {
            openPopupMessage('error', myStep.descrizione);
            return;
        };
        doOperazioniStep(4);

        myStep = validateFormFn(5);
        if (myStep.isLoggedIn == false) {
            $('#myModalLogin').modal("show");
            return;
        };
        if (myStep.isValid == false) {
            openPopupMessage('error', myStep.descrizione);
            return;
        };
        doOperazioniStep(5);

        myStep = validateFormFn(6);
        if (myStep.isLoggedIn == false) {
            $('#myModalLogin').modal("show");
            return;
        };
        if (myStep.isValid == false) {
            openPopupMessage('error', myStep.descrizione);
            return;
        };
        doOperazioniStep(6);

        // ******************************
        // RIEPILOGO DATI PRIMA DEL SALVA
        // ******************************
        var _HeaderDescr = "";
        if (myObjCliente.ispareadonly) {
            _HeaderDescr += "fattura elettronica alla P.A.";
        } else {
            _HeaderDescr += "fattura elettronica B2B a ditta/privato";
        };
        $('#RiepilogoDocumento_Header').empty().append(_HeaderDescr);

        var _DataNumeroDescr = "";
        var _tipoDoc = $("input[name='radioTipiDocumento']:checked").parent().find("strong").text();
        _DataNumeroDescr += "<strong>Tipo documento:</strong> " + _tipoDoc;
        _DataNumeroDescr += "<br /><strong>Data</strong>: " + moment(new Date(myObjFattura.datadocumentoaa, myObjFattura.datadocumentomm - 1, myObjFattura.datadocumentogg)).format("DD/MM/YYYY");
        if (myObjFattura.numero < 1) {
            _DataNumeroDescr += "<br /><strong>Numero</strong>: " + "numerazione automatica (assegnato dopo il salvataggio)";
        }
        else {
            _DataNumeroDescr += "<br /><strong>Numero</strong>: " + myObjFattura.numero;
            var _descrSezionale = $('#ddlSezionale').find(":selected").text();
            if (_descrSezionale != "") {
                _DataNumeroDescr += " / " + _descrSezionale;
            }
        };
        $('#RiepilogoDocumento_DataNumero').empty().append(_DataNumeroDescr);


        var _ClienteDescr = '<strong>' + myObjCliente.ragionesociale + '</strong>';
        _ClienteDescr += '<br />' + myObjCliente.sedelegaleindirizzo;
        _ClienteDescr += '<br />' + myObjCliente.sedelegalecap + ' ' + myObjCliente.sedelegalelocalita + ' ' + myObjCliente.sedelegaleprovincia;
        if (myObjCliente.cf != "") {
            _ClienteDescr += '<br />' + '<strong>c.f.:</strong> ' + myObjCliente.cf;
        };
        if (myObjCliente.piva != "") {
            _ClienteDescr += '<br />' + '<strong>p.iva:</strong> ' + myObjCliente.piva;
        };
        if (myObjCliente.ispareadonly == true) {
            _ClienteDescr += '<br />' + '<strong>codice univoco:</strong> ' + myObjCliente.codiceunivocoipa;
        } else {
            _ClienteDescr += '<br />' + '<strong>pec:</strong> ' + myObjCliente.pec;
        };
        $('#RiepilogoDocumento_Cliente').empty().append(_ClienteDescr);


        var _ModalitaPagamentoDescr = '<strong>Tipo:</strong> ' + $('#ddlTipoPagamento').find(":selected").text();
        if ($('#txtTipoPagamento_DataScadenzaPagamento').val() != "") {
            _ModalitaPagamentoDescr += " con data scadenza pagamento " + $('#txtTipoPagamento_DataScadenzaPagamento').val();
        }
        _ModalitaPagamentoDescr += '<br /><strong>Modalità:</strong> ' + $('#ddlCondizioniPagamento').find(":selected").text();
        _ModalitaPagamentoDescr += '<br /><strong>Banca d\'appoggio:</strong> ' + $('#ddlCoordinateBancarie').find(":selected").text();

        // CAMPI RITENUTA
        var _PercContributoPrevidenzialeProfessionisti = parseFloat(numberEngFormat($("#txtPercContributoPrevidenzialeProfessionisti").val()));
        if (_PercContributoPrevidenzialeProfessionisti > 0) {
            _ModalitaPagamentoDescr += '<br /><strong>Contributo previdenziale:</strong> ' + $("#txtPercContributoPrevidenzialeProfessionisti").val() + '%';
            _ModalitaPagamentoDescr += '<br /><strong>Aliquota iva su contr.previd.:</strong> ' + $('#ddlAliquoteIVAsuContributoPrevidenzialeProfessionisti').find(":selected").text();
        };
        var _PercRitenutaAccontoProfessionisti = parseFloat(numberEngFormat($("#txtPercRitenutaAccontoProfessionisti").val()));
        if (_PercRitenutaAccontoProfessionisti > 0) {
            _ModalitaPagamentoDescr += '<br /><strong>Ritenuta d\'acconto:</strong> ' + $("#txtPercRitenutaAccontoProfessionisti").val() + '%';
        };

        // spese anticipo professionisti art.15
        var _ImportoSpeseAnticipoProfessionistiART15 = parseFloat(numberEngFormat($('#txtImportoSpeseAnticipoProfessionistiART15').val()));
        if (_ImportoSpeseAnticipoProfessionistiART15 > 0) {
            _ModalitaPagamentoDescr += '<br /><strong>importo spese anticipate Art.15:</strong> ' + $("#txtImportoSpeseAnticipoProfessionistiART15").val();
        };
        $('#RiepilogoDocumento_ModalitaPagamento').empty().append(_ModalitaPagamentoDescr);


        var _RigheDescr = "";
        $.each(myObjFattura.righe, function (i, objRiga) {

            //UdM
            var _UdM = "";
            $.each(myStorage.udmcollection, function (i, obj) {
                if (obj.uid == objRiga.uidtipounitadimisura) {
                    _UdM += obj.descrizionereadonly;
                };
            });

            //IVA
            var _IVA = "";
            $.each(myStorage.aliquotaivacollection, function (i, obj) {
                if (obj.uid == objRiga.uidtipoaliquotaiva) {
                    _IVA = obj.percaliquotaiva;
                };
            });

            // ADD RIGA FATTURA
            var tr = '<tr>'
                + '<td>'
                + objRiga.codicearticolo
                + '</td>'
                + '<td>'
                + objRiga.descrizioneinfattura
                + '</td>'
                + '<td>'
                + _UdM
                + '</td>'
                + '<td>'
                + Number(parseFloat(objRiga.quantita)).toLocaleString("it-IT", { minimumFractionDigits: 0, maximumFractionDigits: 4 })
                + '</td>'
                + '<td>'
                + Number(parseFloat(objRiga.importounitario)).toLocaleString("it-IT", { minimumFractionDigits: 2, maximumFractionDigits: 3 })
                + '</td>'
                + '<td>'
                + _IVA
                + '</td>'
                + '</tr>';
            _RigheDescr += tr;
        });
        $('#RiepilogoDocumento_Righe tbody').empty().append(_RigheDescr);


        var _AltroDescr = '<strong>Esigibilità IVA:</strong> ' + $("#ddlEsigibilitaIVA").find(":selected").text();

        if ($("#txtDatiOrdineAcquisto_IdDocumento").val() != "") {
            _AltroDescr += '<br /><strong>Ordine di Acquisto Numero d\'Ordine:</strong> ' + $("#txtDatiOrdineAcquisto_IdDocumento").val();
        };
        if ($("#txtDatiOrdineAcquisto_Data").val() != "") {
            _AltroDescr += '<br /><strong>Ordine di Acquisto Data:</strong> ' + $("#txtDatiOrdineAcquisto_Data").val();
        };
        if ($("#txtDatiOrdineAcquisto_CodiceCUP").val() != "") {
            _AltroDescr += '<br /><strong>Ordine di Acquisto CUP:</strong> ' + $("#txtDatiOrdineAcquisto_CodiceCUP").val();
        };
        if ($("#txtDatiOrdineAcquisto_CodiceCIG").val() != "") {
            _AltroDescr += '<br /><strong>Ordine di Acquisto CIG:</strong> ' + $("#txtDatiOrdineAcquisto_CodiceCIG").val();
        };
        if ($("#txtDatiOrdineAcquisto_CodiceCommessaConvenzione").val() != "") {
            _AltroDescr += '<br /><strong>Ordine di Acquisto Codice Commessa/Convenzione:</strong> ' + $("#txtDatiOrdineAcquisto_CodiceCommessaConvenzione").val();
        };
        if ($("#txtDatiContratto_IdDocumento").val() != "") {
            _AltroDescr += '<br /><strong>Contratto Num. Contratto:</strong> ' + $("#txtDatiContratto_IdDocumento").val();
        };
        if ($("#txtDatiContratto_Data").val() != "") {
            _AltroDescr += '<br /><strong>Contratto Data:</strong> ' + $("#txtDatiContratto_Data").val();
        };
        if ($("#txtDatiContratto_CodiceCUP").val() != "") {
            _AltroDescr += '<br /><strong>Contratto CUP:</strong> ' + $("#txtDatiContratto_CodiceCUP").val();
        };
        if ($("#txtDatiContratto_CodiceCIG").val() != "") {
            _AltroDescr += '<br /><strong>Contratto CIG:</strong> ' + $("#txtDatiContratto_CodiceCIG").val();
        };
        if ($("#txtDatiContratto_CodiceCommessaConvenzione").val() != "") {
            _AltroDescr += '<br /><strong>Contratto Codice Commessa/Convenzione:</strong> ' + $("#txtDatiContratto_CodiceCommessaConvenzione").val();
        };
        if ($("#txtDatiSAL_RiferimentoFase").val() != "") {
            _AltroDescr += '<br /><strong>Fae SAL:</strong> ' + $("#txtDatiSAL_RiferimentoFase").val();
        };
        if ($("#txtVisualizzaRiferimentoNormativo").val() != "") {
            _AltroDescr += '<br /><strong>Riferimento Normativo:</strong> ' + $("#txtVisualizzaRiferimentoNormativo").val();
        };
        if ($("#txtVisualizzaRiferimentoAmministrazione").val() != "") {
            _AltroDescr += '<br /><strong>Riferimento Amministrazione:</strong> ' + $("#txtVisualizzaRiferimentoAmministrazione").val();
        };
        if (parseFloat(numberEngFormat($('#txtImportoBolloFE').val())) > 0) {
            _AltroDescr += '<br /><strong>Importo Bollo:</strong> ' + $('#txtImportoBolloFE').val();
            if ($('#chkIncludiBolloInTotaleFE').is(':checked')) {
                _AltroDescr += ' a carico della PA cliente';
            };
        };
        if ($("#txtVisualizzaCognomeNome_Cognome").val() != "") {
            _AltroDescr += '<br /><strong>Visualizza Cognome Nome professionista:</strong> ' + $("#txtVisualizzaCognomeNome_Cognome").val() + ' ' + $("#txtVisualizzaCognomeNome_Nome").val();
        };
        $('#RiepilogoDocumento_Altro').empty().append(_AltroDescr);


        $('#myModalRiepilogoDocumento').modal("show");
    });

    //SALVA DOCUMENTO
    function doSave() {

        var myObj = {
            "uid": myObjFattura.uid,
            "descrizionereadonly": "",
            "uidtipofatturacliente": myObjFattura.uidtipofatturacliente,
            "uidtipoformatotrasmissione": myObjFattura.uidtipoformatotrasmissione,
            "numero": myObjFattura.numero,
            "uidtiposezionale": myObjFattura.uidtiposezionale,
            "codicesezionalereadonly": "",
            "datadocumentoaa": myObjFattura.datadocumentoaa,
            "datadocumentomm": myObjFattura.datadocumentomm,
            "datadocumentogg": myObjFattura.datadocumentogg,
            "uidsoggetto": myObjFattura.uidsoggetto,
            "righe": myObjFattura.righe,
            "uidtipopagamento": myObjFattura.uidtipopagamento,
            "uidtipocondizionepagamento": myObjFattura.uidtipocondizionepagamento,
            "uidtipocoordinatebancarie": myObjFattura.uidtipocoordinatebancarie,
            "uidtipoesigibilitaiva": myObjFattura.uidtipoesigibilitaiva,
            "allegaticollection": [],
            "datascadenzapagamentoaa": myObjFattura.datascadenzapagamentoaa,
            "datascadenzapagamentomm": myObjFattura.datascadenzapagamentomm,
            "datascadenzapagamentogg": myObjFattura.datascadenzapagamentogg,
            "perccontributoprevidenziale": myObjFattura.perccontributoprevidenziale,
            "uidtipoaliquotaivasucontributoprevidenziale": myObjFattura.uidtipoaliquotaivasucontributoprevidenziale,
            "percritenutaacconto": myObjFattura.percritenutaacconto,
            "importospeseanticipoprofessionistiart15": myObjFattura.importospeseanticipoprofessionistiart15,
            "opzionalepa_ordinediacquisto_numeroordine": myObjFattura.opzionalepa_ordinediacquisto_numeroordine,
            "opzionalepa_ordinediacquisto_datacontrattoaa": myObjFattura.opzionalepa_ordinediacquisto_datacontrattoaa,
            "opzionalepa_ordinediacquisto_datacontrattomm": myObjFattura.opzionalepa_ordinediacquisto_datacontrattomm,
            "opzionalepa_ordinediacquisto_datacontrattogg": myObjFattura.opzionalepa_ordinediacquisto_datacontrattogg,
            "opzionalepa_ordinediacquisto_codicecup": myObjFattura.opzionalepa_ordinediacquisto_codicecup,
            "opzionalepa_ordinediacquisto_codicecig": myObjFattura.opzionalepa_ordinediacquisto_codicecig,
            "opzionalepa_ordinediacquisto_codicecommessaconvenzione": myObjFattura.opzionalepa_ordinediacquisto_codicecommessaconvenzione,
            "opzionalepa_daticontratto_numerocontratto": myObjFattura.opzionalepa_daticontratto_numerocontratto,
            "opzionalepa_daticontratto_datacontrattoaa": myObjFattura.opzionalepa_daticontratto_datacontrattoaa,
            "opzionalepa_daticontratto_datacontrattomm": myObjFattura.opzionalepa_daticontratto_datacontrattomm,
            "opzionalepa_daticontratto_datacontrattogg": myObjFattura.opzionalepa_daticontratto_datacontrattogg,
            "opzionalepa_daticontratto_codicecup": myObjFattura.opzionalepa_daticontratto_codicecup,
            "opzionalepa_daticontratto_codicecig": myObjFattura.opzionalepa_daticontratto_codicecig,
            "opzionalepa_daticontratto_codicecommessaconvenzione": myObjFattura.opzionalepa_daticontratto_codicecommessaconvenzione,
            "opzionalepa_datisal_riferimentofase": myObjFattura.opzionalepa_datisal_riferimentofase,
            "opzionalepa_riferimentonormativo": myObjFattura.opzionalepa_riferimentonormativo,
            "opzionalepa_riferimentoamministrazione": myObjFattura.opzionalepa_riferimentoamministrazione,
            "opzionalepa_importobollo": myObjFattura.opzionalepa_importobollo,
            "opzionalepa_importobollo_addebitoalcliente": myObjFattura.opzionalepa_importobollo_addebitoalcliente,
            "opzionalepa_visualizzacognomeprofessionista": myObjFattura.opzionalepa_visualizzacognomeprofessionista,
            "opzionalepa_visualizzanomeprofessionista": myObjFattura.opzionalepa_visualizzanomeprofessionista
        };
        var myObjStringified = JSON.stringify(myObj);
        var _action = (myObjFattura.uid == EmptyUid ? 'insert' : 'update');

        AjaxMessageStart();

        $.ajax({
            crossDomain: true,
            type: 'POST',
            contentType: "application/json",
            url: myStorage.ApiUrl + '/FatturaCliente/' + _action,
            data: myObjStringified,
            beforeSend: function (xhdr) {
                xhdr.setRequestHeader("Authorization", "Bearer " + myStorage.token);
            }
        }).done(function (resp, statusText, xhdr) {

            var myResponse = $.parseJSON(resp);
            var success = myResponse.success; // = true;
            var errormessage = myResponse.errormessage; // = "OK";
            var errorcode = myResponse.errorcode; // = 0;
            var pagecount = myResponse.pagecount;

            if (success == true) {

                myObjFattura = $.parseJSON(myResponse.obj);

                var _OkMessage = "Salvato con successo il documento n. " + myObjFattura.numero + "/" + myObjFattura.datadocumentoaa;
                if (myObjFattura.codicesezionalereadonly != "") {
                    _OkMessage += "/" + myObjFattura.codicesezionalereadonly;
                };
                openPopupMessage('success', _OkMessage);

                $("#step-0-button").removeClass();
                $("#step-1-button").removeClass();
                $("#step-2-button").removeClass();
                $("#step-3-button").removeClass();
                $("#step-4-button").removeClass();
                $("#step-5-button").removeClass();
                $("#step-6-button").removeClass();
                $("#step-7-button").removeClass();

                $("#step-0-button").addClass("done");
                $("#step-1-button").addClass("done");
                $("#step-2-button").addClass("done");
                $("#step-3-button").addClass("done");
                $("#step-4-button").addClass("done");
                $("#step-5-button").addClass("done");
                $("#step-6-button").addClass("done");
                $("#step-7-button").addClass("active");

                $("#step-0-content").hide();
                $("#step-1-content").hide();
                $("#step-2-content").hide();
                $("#step-3-content").hide();
                $("#step-4-content").hide();
                $("#step-5-content").hide();
                $("#step-6-content").hide();
                $("#step-7-content").show("fast");;

                //DISABLE BUTTON SAVE
                $("#GoToStep7-button").prop('disabled', true);

            } else {
                alert("Login error; Message: " + errormessage + ";errorcode=" + errorcode);
            };

            AjaxMessageStop();

        }).fail(function (xhdr, statusText, errorText) {

            AjaxMessageStop();
            alert("err=" + errorText);
        });
    }

    // Steps click su a href
    $('#step-0-button a').click(function () {
        GoToStep0();
    })
    $('#step-1-button a').click(function () {
        GoToStep1();
    });
    $('#step-2-button a').click(function () {
        GoToStep2();
    });
    $('#step-3-button a').click(function () {
        GoToStep3();
    });
    $('#step-4-button a').click(function () {
        GoToStep4();
    });
    $('#step-5-button a').click(function () {
        GoToStep5();
    });
    $('#step-6-button a').click(function () {
        GoToStep6();
    });
    //$('#step-7-button a').click(function () {
    //    GoToStep7();
    //});

    //Button Steps avanti  >
    $('#GoToStep0-button').click(function () {
        GoToStep0();
    });
    $('#GoToStep1-button').click(function () {
        GoToStep1();
    });
    $('#GoToStep2-button').click(function () {
        GoToStep2();
    });
    $('#GoToStep3-button').click(function () {
        GoToStep3();
    });
    $('#GoToStep4-button').click(function () {
        GoToStep4();
    });
    $('#GoToStep5-button').click(function () {
        GoToStep5();
    });
    $('#GoToStep6-button').click(function () {
        GoToStep6();
    });
    $('#GoToStep7-button').click(function () {
        GoToStep7();
    });

    //Button Steps < indietro
    $('#BackToStep0-button').click(function () {
        GoToStep0();
    });
    $('#BackToStep1-button').click(function () {
        GoToStep1();
    });
    $('#BackToStep2-button').click(function () {
        GoToStep2();
    });
    $('#BackToStep3-button').click(function () {
        GoToStep3();
    });
    $('#BackToStep4-button').click(function () {
        GoToStep4();
    });
    $('#BackToStep5-button').click(function () {
        GoToStep5();
    });
    $('#BackToStep6-button').click(function () {
        GoToStep6();
    });

</script>
